<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>IPCW Cumulative Cost • mets</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="IPCW Cumulative Cost">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mets</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/basic-dutils.html">dUtility data-frame manipulations</a></li>
    <li><a class="dropdown-item" href="../articles/binomial-family.html">Analysis of multivariate binomial data: family analysis</a></li>
    <li><a class="dropdown-item" href="../articles/binomial-twin.html">Analysis of bivariate binomial data: Twin analysis</a></li>
    <li><a class="dropdown-item" href="../articles/binreg-ate.html">Average treatment effect (ATE) for Competing risks and binary outcomes</a></li>
    <li><a class="dropdown-item" href="../articles/binreg-TRS.html">Two-Stage Randomization for for Competing risks and Survival outcomes</a></li>
    <li><a class="dropdown-item" href="../articles/binreg.html">Binomial Regression for Survival and Competing Risks Data</a></li>
    <li><a class="dropdown-item" href="../articles/cifreg.html">Cumulative Incidence Regression</a></li>
    <li><a class="dropdown-item" href="../articles/cooking-survival-data.html">WIP: Cooking survival data, 5 minute recipes</a></li>
    <li><a class="dropdown-item" href="../articles/cumulative-cost.html">IPCW Cumulative Cost</a></li>
    <li><a class="dropdown-item" href="../articles/glm-utility.html">GEE cluster standard errors and predictions for glm objects</a></li>
    <li><a class="dropdown-item" href="../articles/haplo-discrete-ttp.html">Haplotype Discrete Survival Models</a></li>
    <li><a class="dropdown-item" href="../articles/interval-discrete-survival.html">Discrete Interval Censored Survival Models</a></li>
    <li><a class="dropdown-item" href="../articles/marginal-cox.html">Marginal modelling of clustered survival data</a></li>
    <li><a class="dropdown-item" href="../articles/mediation-survival.html">Mediation Analysis for survival data</a></li>
    <li><a class="dropdown-item" href="../articles/phreg_rct.html">Randomization for Cox Type rate models </a></li>
    <li><a class="dropdown-item" href="../articles/quantitative-twin.html">Twin models</a></li>
    <li><a class="dropdown-item" href="../articles/recurrent-events.html">Recurrent events</a></li>
    <li><a class="dropdown-item" href="../articles/rmst-ate.html">Average treatment effect (ATE) for Restricted mean survival and years lost of Competing risks</a></li>
    <li><a class="dropdown-item" href="../articles/survival-ate.html">G-Computation or standardization for the Cox, Fine-Gray and binomial regression models for survival data</a></li>
    <li><a class="dropdown-item" href="../articles/time-to-event-family-studies-arev.html">A practical guide to Human Genetics with Lifetime Data</a></li>
    <li><a class="dropdown-item" href="../articles/twostage-survival.html">Analysis of multivariate survival data</a></li>
    <li><a class="dropdown-item" href="../articles/while-alive.html">While Alive estimands for Recurrent Events</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kkholst/mets/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>IPCW Cumulative Cost</h1>
                        <h4 data-toc-skip class="author">Klaus Holst
&amp; Thomas Scheike</h4>
            
            <h4 data-toc-skip class="date">2026-01-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/kkholst/mets/blob/main/vignettes/cumulative-cost.Rmd" class="external-link"><code>vignettes/cumulative-cost.Rmd</code></a></small>
      <div class="d-none name"><code>cumulative-cost.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>We here describe how to do regression modelling for cumulative cost
<span class="math display">$$\begin{align*}
{\cal U}(t) &amp; = \int_0^t Z(s) dN(s)
\end{align*}$$</span> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N(s)</annotation></semantics></math>
is a counting process that registers the times at which the cost is
realized and accumulated, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Z(t)</annotation></semantics></math>
is the cost (or marks) at the event times. The counting process can be a
mix of random and fixed times. The data would thus be represented in
counting process format with the marks/costs going along with the event
times. There are many additional uses of such cumulative process, for
example, when considering time-lost in a recurrent events setting, that
we return to below.</p>
<p>We can estimate the marginal mean of the cumulative process <span class="math display">$$\begin{align*}
\nu(t) &amp; = E ( {\cal U}(t) )  
\end{align*}$$</span> possibly for strata with standard errors based on
the derived influence function.</p>
<p>We provide semi-parametric regression modelling using the
proportional model <span class="math display">$$\begin{align*}
E ( {\cal U}(t) | X) &amp; = \Lambda_0(t) \exp( X^T \beta).
\end{align*}$$</span></p>
<p>In addition for a fixed time-point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>∈</mo><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mi>τ</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">t \in [0,\tau]</annotation></semantics></math>
we can estimate the mean given covariates <span class="math display">$$\begin{align*}
E ( {\cal U}(t) | X) &amp; = \exp( X^T \beta)
\end{align*}$$</span> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
is some maximum follow-up time.</p>
<ul>
<li>These quantities are estimated in a setting with independent
right-censoring given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>,
and based on IPCW adjusted estimating equations.
<ul>
<li>similarly to the Ghosh-Lin model for recurrent events</li>
</ul>
</li>
<li>A terminal event can be specified.</li>
</ul>
<p>We also estimate the probability of exceeding thresholds over time
<span class="math display">$$\begin{align*}
P ( {\cal U}(t)  &gt; k ) &amp; = \mu_k(t),
\end{align*}$$</span> and in the situation with a terminal this is based
on a derived competing risks data that keeps track of the competing
terminal event.</p>
<p>Regression modelling of this quantity is also possible using
competing risks regression models, using for example, the cifreg
function of mets.</p>
</div>
<div class="section level2">
<h2 id="hf-action-data">HF-action data<a class="anchor" aria-label="anchor" href="#hf-action-data"></a>
</h2>
<p>Considering the HF-action data we simulate a severity score for each
event.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kkholst.github.io/mets/" class="external-link">mets</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">hfactioncpx12</span><span class="op">)</span></span>
<span><span class="va">hf</span> <span class="op">&lt;-</span> <span class="va">hfactioncpx12</span></span>
<span><span class="va">hf</span><span class="op">$</span><span class="va">severity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="op">(</span><span class="fl">5</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">741</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="va">hf</span><span class="op">$</span><span class="va">id</span><span class="op">]</span></span>
<span></span>
<span><span class="va">proc_design</span> <span class="op">&lt;-</span> <span class="fu">mets</span><span class="fu">:::</span><span class="va">proc_design</span></span>
<span><span class="co">## marginal mean using formula  </span></span>
<span><span class="va">outNZ</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recurrentMarginal</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span>             <span class="op">+</span><span class="fu"><a href="../reference/recreg.html">marks</a></span><span class="op">(</span><span class="va">severity</span><span class="op">)</span>,<span class="va">hf</span>,cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">outNZ</span>,se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">outNZ</span>,times<span class="op">=</span><span class="fl">3</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;     new.time     mean        se  CI-2.5% CI-97.5% strata</span></span>
<span><span class="co">#&gt; 682        3 10.24832 0.6186346 9.104797 11.53546      0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;     new.time     mean        se  CI-2.5% CI-97.5% strata</span></span>
<span><span class="co">#&gt; 601        3 9.454503 0.6950555 8.185815 10.91982      1</span></span>
<span></span>
<span><span class="va">outN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recurrentMarginal</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">hf</span>,</span>
<span>               cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">outN</span>,se<span class="op">=</span><span class="cn">TRUE</span>,add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="cumulative-cost_files/figure-html/unnamed-chunk-2-1.png" class="r-plt" alt="" width="600px"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">outN</span>,times<span class="op">=</span><span class="fl">3</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;     new.time     mean        se  CI-2.5% CI-97.5% strata</span></span>
<span><span class="co">#&gt; 682        3 2.118496 0.1138572 1.906692 2.353829      0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;     new.time     mean        se  CI-2.5% CI-97.5% strata</span></span>
<span><span class="co">#&gt; 601        3 1.924062 0.1216577 1.699801 2.177912      1</span></span></code></pre></div>
<p>For comparison we also compute the IPCW estimates with and without
marks at time 3, using the linear model, and note that they are
identical. Standard errors are however based on different formula that
are asymptotically equivalent, and we note that they are very
similar.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outNZ3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recregIPCW</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="op">-</span><span class="fl">1</span><span class="op">+</span><span class="va">treatment</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="../reference/recreg.html">marks</a></span><span class="op">(</span><span class="va">severity</span><span class="op">)</span>,data<span class="op">=</span><span class="va">hf</span>,</span>
<span>          cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">2</span>,time<span class="op">=</span><span class="fl">3</span>,cens.model<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span>,model<span class="op">=</span><span class="st">"lin"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">outNZ3</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  741   1281</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  741 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;            Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span><span class="co">#&gt; treatment0 10.24832  0.61860  9.03588 11.46075       0</span></span>
<span><span class="co">#&gt; treatment1  9.45450  0.69499  8.09234 10.81667       0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="http://kkholst.github.io/lava/reference/iid.html" class="external-link">iid</a></span><span class="op">(</span><span class="va">outNZ3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;            [,1]        [,2]</span></span>
<span><span class="co">#&gt; 1 -0.0051841554  0.00000000</span></span>
<span><span class="co">#&gt; 2  0.0102241902  0.00000000</span></span>
<span><span class="co">#&gt; 3  0.0000000000 -0.03026973</span></span>
<span><span class="co">#&gt; 4 -0.0139508255  0.00000000</span></span>
<span><span class="co">#&gt; 5 -0.0004765366  0.00000000</span></span>
<span><span class="co">#&gt; 6 -0.0341093932  0.00000000</span></span>
<span></span>
<span><span class="va">outN3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recregIPCW</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="op">-</span><span class="fl">1</span><span class="op">+</span><span class="va">treatment</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">hf</span>,cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">2</span>,time<span class="op">=</span><span class="fl">3</span>,</span>
<span>         cens.model<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span>,model<span class="op">=</span><span class="st">"lin"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">outN3</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  741   1281</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  741 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;            Estimate Std.Err    2.5%   97.5% P-value</span></span>
<span><span class="co">#&gt; treatment0  2.11850 0.11385 1.89535 2.34164       0</span></span>
<span><span class="co">#&gt; treatment1  1.92406 0.12165 1.68564 2.16248       0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="http://kkholst.github.io/lava/reference/iid.html" class="external-link">iid</a></span><span class="op">(</span><span class="va">outN3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;            [,1]        [,2]</span></span>
<span><span class="co">#&gt; 1  0.0004542472 0.000000000</span></span>
<span><span class="co">#&gt; 2  0.0009756994 0.000000000</span></span>
<span><span class="co">#&gt; 3  0.0000000000 0.009301496</span></span>
<span><span class="co">#&gt; 4 -0.0029668336 0.000000000</span></span>
<span><span class="co">#&gt; 5 -0.0001120764 0.000000000</span></span>
<span><span class="co">#&gt; 6 -0.0070693971 0.000000000</span></span></code></pre></div>
<p>We also apply the semiparametric proportional cost model with IPCW
adjustment:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">propNZ</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recreg</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">treatment</span><span class="op">+</span><span class="fu"><a href="../reference/recreg.html">marks</a></span><span class="op">(</span><span class="va">severity</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">hf</span>,cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">propNZ</span><span class="op">)</span> </span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     n events</span></span>
<span><span class="co">#&gt;  2132   1391</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  741 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;             Estimate      S.E.   dU^-1/2 P-value</span></span>
<span><span class="co">#&gt; treatment1 -0.102856  0.090464  0.024319  0.2555</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;            Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; treatment1  0.90226 0.75566 1.0773</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">propNZ</span>,main<span class="op">=</span><span class="st">"Baselines"</span><span class="op">)</span></span>
<span>     </span>
<span><span class="va">GL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recreg</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">treatment</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,<span class="va">hf</span>,cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">GL</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     n events</span></span>
<span><span class="co">#&gt;  2132   1391</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  741 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;             Estimate      S.E.   dU^-1/2 P-value</span></span>
<span><span class="co">#&gt; treatment1 -0.110404  0.078656  0.053776  0.1604</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;            Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; treatment1  0.89547 0.76754 1.0447</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">GL</span>,add<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="cumulative-cost_files/figure-html/unnamed-chunk-4-1.png" class="r-plt" alt="" width="600px">
Those treated have 14 % lower cumulative severity and 11% lower number
of expected events.</p>
</div>
<div class="section level2">
<h2 id="exceed-threshold">Exceed threshold<a class="anchor" aria-label="anchor" href="#exceed-threshold"></a>
</h2>
<p>Finally, we also estimate the probability of exceeding a cumulative
severity at 1,5,10</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ooNZ</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prob.exceed.recurrent.html">prob.exceed.recurrent</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="../reference/recreg.html">marks</a></span><span class="op">(</span><span class="va">severity</span><span class="op">)</span>,data<span class="op">=</span><span class="va">hf</span>,</span>
<span>                  cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">2</span>,exceed<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ooNZ</span>,strata<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ooNZ</span>,strata<span class="op">=</span><span class="fl">2</span>,add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="cumulative-cost_files/figure-html/unnamed-chunk-5-1.png" class="r-plt" alt="" width="600px"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ooNZ</span>,times<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`0`</span></span>
<span><span class="co">#&gt; $`0`$prob</span></span>
<span><span class="co">#&gt;            times           </span></span>
<span><span class="co">#&gt;                3 2.99865085</span></span>
<span><span class="co">#&gt; N&lt;1            3 0.05046407</span></span>
<span><span class="co">#&gt; exceed&gt;=1      3 0.94953593</span></span>
<span><span class="co">#&gt; exceed&gt;=5      3 0.90305672</span></span>
<span><span class="co">#&gt; exceed&gt;=10     3 0.78544505</span></span>
<span><span class="co">#&gt; exceed&gt;=20     3 0.49877769</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`0`$se</span></span>
<span><span class="co">#&gt;            times           </span></span>
<span><span class="co">#&gt;                3 2.99865085</span></span>
<span><span class="co">#&gt; N&lt;1            3 0.01999300</span></span>
<span><span class="co">#&gt; exceed&gt;=1      3 0.01999300</span></span>
<span><span class="co">#&gt; exceed&gt;=5      3 0.02693354</span></span>
<span><span class="co">#&gt; exceed&gt;=10     3 0.03918605</span></span>
<span><span class="co">#&gt; exceed&gt;=20     3 0.05133898</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`0`$lower</span></span>
<span><span class="co">#&gt;      times           </span></span>
<span><span class="co">#&gt; [1,]     3 2.99865085</span></span>
<span><span class="co">#&gt; [2,]     3 0.08885207</span></span>
<span><span class="co">#&gt; [3,]     3 0.91114793</span></span>
<span><span class="co">#&gt; [4,]     3 0.85178123</span></span>
<span><span class="co">#&gt; [5,]     3 0.71227737</span></span>
<span><span class="co">#&gt; [6,]     3 0.40765541</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`0`$upper</span></span>
<span><span class="co">#&gt;      times           </span></span>
<span><span class="co">#&gt; [1,]     3 2.99865085</span></span>
<span><span class="co">#&gt; [2,]     3 0.01045872</span></span>
<span><span class="co">#&gt; [3,]     3 0.98954128</span></span>
<span><span class="co">#&gt; [4,]     3 0.95741889</span></span>
<span><span class="co">#&gt; [5,]     3 0.86612878</span></span>
<span><span class="co">#&gt; [6,]     3 0.61026834</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`1`</span></span>
<span><span class="co">#&gt; $`1`$prob</span></span>
<span><span class="co">#&gt;            times           </span></span>
<span><span class="co">#&gt;                3 2.99865085</span></span>
<span><span class="co">#&gt; N&lt;1            3 0.01705929</span></span>
<span><span class="co">#&gt; exceed&gt;=1      3 0.98294071</span></span>
<span><span class="co">#&gt; exceed&gt;=5      3 0.96772447</span></span>
<span><span class="co">#&gt; exceed&gt;=10     3 0.74154673</span></span>
<span><span class="co">#&gt; exceed&gt;=20     3 0.51833754</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`1`$se</span></span>
<span><span class="co">#&gt;            times            </span></span>
<span><span class="co">#&gt;                3 2.998650853</span></span>
<span><span class="co">#&gt; N&lt;1            3 0.008885007</span></span>
<span><span class="co">#&gt; exceed&gt;=1      3 0.008885007</span></span>
<span><span class="co">#&gt; exceed&gt;=5      3 0.012103895</span></span>
<span><span class="co">#&gt; exceed&gt;=10     3 0.043163511</span></span>
<span><span class="co">#&gt; exceed&gt;=20     3 0.055744489</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`1`$lower</span></span>
<span><span class="co">#&gt;      times           </span></span>
<span><span class="co">#&gt; [1,]     3 2.99865085</span></span>
<span><span class="co">#&gt; [2,]     3 0.03432023</span></span>
<span><span class="co">#&gt; [3,]     3 0.96567977</span></span>
<span><span class="co">#&gt; [4,]     3 0.94428969</span></span>
<span><span class="co">#&gt; [5,]     3 0.66159512</span></span>
<span><span class="co">#&gt; [6,]     3 0.41982703</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`1`$upper</span></span>
<span><span class="co">#&gt;      times          </span></span>
<span><span class="co">#&gt; [1,]     3 2.9986509</span></span>
<span><span class="co">#&gt; [2,]     3 0.0000000</span></span>
<span><span class="co">#&gt; [3,]     3 1.0000000</span></span>
<span><span class="co">#&gt; [4,]     3 0.9917408</span></span>
<span><span class="co">#&gt; [5,]     3 0.8311602</span></span>
<span><span class="co">#&gt; [6,]     3 0.6399631</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cumulative-time-lost-for-recurrent-events">Cumulative time lost for recurrent events<a class="anchor" aria-label="anchor" href="#cumulative-time-lost-for-recurrent-events"></a>
</h2>
<p>The cumulative time lost for recurrent events has been defined as
<span class="math display">$$\begin{align*}
  {\cal M}(t) = E[ \int_0^\tau (\tau-s) dN(s) ] = \int_0^\tau \mu(s) ds
\end{align*}$$</span> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu(t) = E( N(t) )</annotation></semantics></math>
is the marginal mean of the recurrent events at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hf</span><span class="op">$</span><span class="va">lost5</span> <span class="op">&lt;-</span> <span class="fl">5</span><span class="op">-</span><span class="va">hf</span><span class="op">$</span><span class="va">time</span></span>
<span></span>
<span><span class="va">RecLost</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recregIPCW</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="op">-</span><span class="fl">1</span><span class="op">+</span><span class="va">treatment</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="../reference/recreg.html">marks</a></span><span class="op">(</span><span class="va">lost5</span><span class="op">)</span>,data<span class="op">=</span><span class="va">hf</span>,</span>
<span>           cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">2</span>,time<span class="op">=</span><span class="fl">5</span>,cens.model<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span>,model<span class="op">=</span><span class="st">"lin"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">RecLost</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  741   1391</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  741 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;            Estimate Std.Err    2.5%   97.5% P-value</span></span>
<span><span class="co">#&gt; treatment0  8.58300 0.42951 7.74118 9.42482       0</span></span>
<span><span class="co">#&gt; treatment1  7.66234 0.46400 6.75292 8.57177       0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="http://kkholst.github.io/lava/reference/iid.html" class="external-link">iid</a></span><span class="op">(</span><span class="va">RecLost</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;            [,1]       [,2]</span></span>
<span><span class="co">#&gt; 1  0.0016920221 0.00000000</span></span>
<span><span class="co">#&gt; 2  0.0073388996 0.00000000</span></span>
<span><span class="co">#&gt; 3  0.0000000000 0.02120478</span></span>
<span><span class="co">#&gt; 4 -0.0095548150 0.00000000</span></span>
<span><span class="co">#&gt; 5 -0.0005696809 0.00000000</span></span>
<span><span class="co">#&gt; 6 -0.0201750011 0.00000000</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sessioninfo">SessionInfo<a class="anchor" aria-label="anchor" href="#sessioninfo"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] mets_1.3.9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] cli_3.6.5              knitr_1.51             rlang_1.1.7           </span></span>
<span><span class="co">#&gt;  [4] xfun_0.55              textshaping_1.0.4      jsonlite_2.0.0        </span></span>
<span><span class="co">#&gt;  [7] listenv_0.10.0         future.apply_1.20.1    lava_1.8.2            </span></span>
<span><span class="co">#&gt; [10] htmltools_0.5.9        ragg_1.5.0             sass_0.4.10           </span></span>
<span><span class="co">#&gt; [13] rmarkdown_2.30         grid_4.5.2             evaluate_1.0.5        </span></span>
<span><span class="co">#&gt; [16] jquerylib_0.1.4        fastmap_1.2.0          numDeriv_2016.8-1.1   </span></span>
<span><span class="co">#&gt; [19] yaml_2.3.12            mvtnorm_1.3-3          lifecycle_1.0.5       </span></span>
<span><span class="co">#&gt; [22] timereg_2.0.7          compiler_4.5.2         codetools_0.2-20      </span></span>
<span><span class="co">#&gt; [25] fs_1.6.6               htmlwidgets_1.6.4      Rcpp_1.1.1            </span></span>
<span><span class="co">#&gt; [28] future_1.68.0          lattice_0.22-7         systemfonts_1.3.1     </span></span>
<span><span class="co">#&gt; [31] digest_0.6.39          R6_2.6.1               parallelly_1.46.1     </span></span>
<span><span class="co">#&gt; [34] parallel_4.5.2         splines_4.5.2          Matrix_1.7-4          </span></span>
<span><span class="co">#&gt; [37] bslib_0.9.0            tools_4.5.2            RcppArmadillo_15.2.3-1</span></span>
<span><span class="co">#&gt; [40] globals_0.18.0         survival_3.8-3         pkgdown_2.2.0         </span></span>
<span><span class="co">#&gt; [43] cachem_1.1.0           desc_1.4.3</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Klaus K. Holst, Thomas Scheike.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
