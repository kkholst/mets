<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Average treatment effect (ATE) for Competing risks and binary outcomes • mets</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Average treatment effect (ATE) for Competing risks and binary outcomes">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mets</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basic-dutils.html">dUtility data-frame manipulations</a>
    </li>
    <li>
      <a href="../articles/binomial-family.html">Analysis of multivariate binomial data: family analysis</a>
    </li>
    <li>
      <a href="../articles/binomial-twin.html">Analysis of bivariate binomial data: Twin analysis</a>
    </li>
    <li>
      <a href="../articles/binreg-ate.html">Average treatment effect (ATE) for Competing risks and binary outcomes</a>
    </li>
    <li>
      <a href="../articles/binreg-TRS.html">Two-Stage Randomization for for Competing risks and Survival outcomes</a>
    </li>
    <li>
      <a href="../articles/binreg.html">Binomial Regression for Survival and Competing Risks Data</a>
    </li>
    <li>
      <a href="../articles/cifreg.html">Cumulative Incidence Regression</a>
    </li>
    <li>
      <a href="../articles/cooking-survival-data.html">WIP: Cooking survival data, 5 minute recipes</a>
    </li>
    <li>
      <a href="../articles/glm-utility.html">GEE cluster standard errors and predictions for glm objects</a>
    </li>
    <li>
      <a href="../articles/haplo-discrete-ttp.html">Haplotype Discrete Survival Models</a>
    </li>
    <li>
      <a href="../articles/interval-discrete-survival.html">Discrete Interval Censored Survival Models</a>
    </li>
    <li>
      <a href="../articles/marginal-cox.html">Marginal modelling of clustered survival data</a>
    </li>
    <li>
      <a href="../articles/mediation-survival.html">Mediation Analysis for survival data</a>
    </li>
    <li>
      <a href="../articles/phreg_rct.html">Two-Stage Randomization for Cox Type rate models </a>
    </li>
    <li>
      <a href="../articles/quantitative-twin.html">Twin models</a>
    </li>
    <li>
      <a href="../articles/recurrent-events.html">Recurrent events</a>
    </li>
    <li>
      <a href="../articles/rmst-ate.html">Average treatment effect (ATE) for Restricted mean survival and years lost of Competing risks</a>
    </li>
    <li>
      <a href="../articles/survival-ate.html">G-Computation or standardization for the Cox, Fine-Gray and binomial regression models for survival data</a>
    </li>
    <li>
      <a href="../articles/time-to-event-family-studies-arev.html">A practical guide to Human Genetics with Lifetime Data</a>
    </li>
    <li>
      <a href="../articles/twostage-survival.html">Analysis of multivariate survival data</a>
    </li>
    <li>
      <a href="../articles/while-alive.html">While Alive estimands for Recurrent Events</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kkholst/mets/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Average treatment effect (ATE) for Competing
risks and binary outcomes</h1>
                        <h4 data-toc-skip class="author">Klaus Holst
&amp; Thomas Scheike</h4>
            
            <h4 data-toc-skip class="date">2025-08-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/kkholst/mets/blob/main/vignettes/binreg-ate.Rmd" class="external-link"><code>vignettes/binreg-ate.Rmd</code></a></small>
      <div class="hidden name"><code>binreg-ate.Rmd</code></div>

    </div>

    
    
<p>The binregATE function can fit a logistic link model with IPCW
adjustment for a specific time-point, and can thus be used for
describing survival or competing risks data. The function can be used
for large data and is completely scalable, that is, linear in the data.
A nice feature is that influcence functions are computed and are
available.</p>
<p>In addition and to summarize</p>
<ul>
<li>the censoring weights can be strata dependent</li>
<li>predictions can be computed with standard errors</li>
<li>computation time is linear in data
<ul>
<li>including standard errors</li>
</ul>
</li>
<li>clusters can be given and then cluster corrected standard errors are
computed</li>
</ul>
<div class="section level2">
<h2 id="average-treatment-for-competing-risks-data">Average treatment for Competing risks data<a class="anchor" aria-label="anchor" href="#average-treatment-for-competing-risks-data"></a>
</h2>
<p>The binreg function does direct binomial regression for one
time-point,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
fitting the model
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>≤</mo><mi>t</mi><mo>,</mo><mi>ϵ</mi><mo>=</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mtext mathvariant="normal">expit</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>X</mi><mi>T</mi></msup><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
P(T \leq t, \epsilon=1 | X )  &amp; = \mbox{expit}( X^T \beta),
\end{align*}</annotation></semantics></math> for possible right censored
data. The estimation procedure is based on IPCW adjusted estimating
equation (EE)
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>U</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo></mtd><mtd columnalign="left" style="text-align: left"><mi>X</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Δ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>≤</mo><mi>t</mi><mo>,</mo><mi>ϵ</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><msub><mi>G</mi><mi>c</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>∧</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mtext mathvariant="normal">expit</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>X</mi><mi>T</mi></msup><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
 U(\beta) = &amp;  X \left( \Delta(t) I(T \leq t, \epsilon=1 )/G_c(T \wedge t) - \mbox{expit}( X^T beta) \right) = 0 
\end{align*}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>G</mi><mi>c</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>C</mi><mo>&gt;</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">G_c(t)=P(C &gt; t)</annotation></semantics></math>,
the censoring survival distribution, and with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>C</mi><mo>&gt;</mo><mi>T</mi><mo>∧</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Delta(t) = I( C &gt; T \wedge t)</annotation></semantics></math>
the indicator of being uncensored at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.</p>
<p>The function logitIPCW instead considers the EE the EE
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>U</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo></mtd><mtd columnalign="left" style="text-align: left"><mi>X</mi><mfrac><mrow><mi>Δ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msub><mi>G</mi><mi>c</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>∧</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>≤</mo><mi>t</mi><mo>,</mo><mi>ϵ</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mtext mathvariant="normal">expit</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>X</mi><mi>T</mi></msup><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
 U(\beta) = &amp;  X  \frac{\Delta(t)}{G_c(T \wedge t)} \left( I(T \leq t, \epsilon=1 ) - \mbox{expit}( X^T beta) \right) = 0.
\end{align*}</annotation></semantics></math> The two score equations are
quite similar, and exactly the same when the censoring model is
fully-nonparametric given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>.</p>
<ul>
<li>It seems that the binreg estimating equations most often is
preferable to use, and the estimating equation used is also augmented in
the default implementation (see the binreg vignette).</li>
</ul>
<p>Additional functions logitATE, and binregATE computes the average
treatment effect. We demonstrate their use below.</p>
<p>The functions binregATE (recommended) and logitATE also works when
there is no censoring and we thus have simple binary outcome.</p>
<p>Variance is based on sandwich formula with IPCW adjustment, and
naive.var is variance under a known censoring model. The influence
functions are stored in the output. Further, the standard errors can be
cluster corrected by specifying the relevant cluster for the working
outcome model.</p>
<ul>
<li>We estimate the average treatment effect of our binary response
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>≤</mo><mi>t</mi><mo>,</mo><mi>ϵ</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">I(T \leq t, \epsilon=1)</annotation></semantics></math><ul>
<li>Using a working logistic model for the resonse (possibly with a
cluster specification)</li>
<li>Using a working logistic model for treatment given covariates
<ul>
<li>The binregATE can also handle a factor with more than two levels and
then uses the mlogit multinomial regression function (of mets).</li>
</ul>
</li>
<li>Using a working model for censoring given covariates, this must be a
stratified Kaplan-Meier.</li>
</ul>
</li>
</ul>
<p>If there are no censoring then the censoring weights are simply set
to 1.</p>
<p>The average treatment effect is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
 E(Y(1) - Y(0)) 
\end{align*}</annotation></semantics></math> using counterfactual
outcomes.</p>
<p>We compute the simple G-estimator
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mo>∑</mo><msub><mi>m</mi><mi>a</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\sum  m_a(X_i) 
\end{align*}</annotation></semantics></math> to estimate the risk
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">E(Y(a))</annotation></semantics></math>.</p>
<p>The DR-estimator instead uses the estimating equations that are
double robust wrt</p>
<ul>
<li>A working logistic model for the resonse</li>
<li>A working logistic model for treatment given covariates</li>
</ul>
<p>This is estimated using the estimator
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mo>∑</mo><mrow><mo stretchy="true" form="prefix">[</mo><mfrac><mrow><msub><mi>A</mi><mi>i</mi></msub><msub><mi>Y</mi><mi>i</mi></msub></mrow><mrow><msub><mi>π</mi><mi>A</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>−</mo><mfrac><mrow><msub><mi>A</mi><mi>i</mi></msub><mo>−</mo><msub><mi>π</mi><mi>A</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msub><mi>π</mi><mi>A</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><msub><mi>m</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>−</mo><mrow><mo stretchy="true" form="prefix">[</mo><mfrac><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>A</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>Y</mi><mi>i</mi></msub></mrow><mrow><mn>1</mn><mo>−</mo><msub><mi>π</mi><mi>A</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>+</mo><mfrac><mrow><msub><mi>A</mi><mi>i</mi></msub><mo>−</mo><msub><mi>π</mi><mi>A</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mn>1</mn><mo>−</mo><msub><mi>π</mi><mi>A</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><msub><mi>m</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\sum \left[ \frac{A_i Y_i}{\pi_A(X_i)}-\frac{A_i - \pi_A(X_i)}{\pi_A(X_i)} m_1(X_i) \right]
   - \left[ \frac{(1-A_i) Y_i}{1-\pi_A(X_i)}+\frac{A_i - \pi_A(X_i)}{1-\pi_A(X_i)} m_0(X_i) \right]
\end{align*}</annotation></semantics></math> where</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>A</mi><mi>i</mi></msub><annotation encoding="application/x-tex">A_i</annotation></semantics></math>
is treatment indicator</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>A</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi_A(X_i) = P(A_i=1|X_i)</annotation></semantics></math>
is treatment model</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Y_i</annotation></semantics></math>
outcome, that in case of censoring is censoring adjusted
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Y</mi><mo accent="true">̃</mo></mover><mi>i</mi></msub><mi>Δ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><msub><mi>G</mi><mi>c</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>T</mi><mi>i</mi></msub><mo>−</mo><mo>∧</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\tilde Y_i \Delta(t) /G_c(T_i- \wedge t)</annotation></semantics></math>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Y</mi><mo accent="true">̃</mo></mover><mi>i</mi></msub><mo>=</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>T</mi><mi>i</mi></msub><mo>≤</mo><mi>t</mi><mo>,</mo><msub><mi>ϵ</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\tilde Y_i = I(T_i \leq t, \epsilon_i=1)</annotation></semantics></math>
oucome before censoring.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mi>j</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>j</mi><mo>,</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">m_j(X_i)=P(Y_i=1| A_i=j,X_i)</annotation></semantics></math>
is outcome model, using binomial regression.</li>
</ul>
<p>The standard errors are then based on an iid decomposition using
taylor-expansions for the parameters of the treatment-model and the
outcome-model, and the censoring probability.</p>
<p>We need that the censoring model is correct, so it can be important
to use a sufficiently large censorng model as we also illustrate
below.</p>
<ul>
<li>The censoring model can be specified by strata (used for phreg</li>
</ul>
<p>We also compute standard marginalization for average treatment effect
(called differenceG)
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mo>∑</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>m</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>m</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\sum \left[  m_1(X_i) - m_0(X_i) \right]
\end{align*}</annotation></semantics></math> and again standard errors
are based on the related influcence functions and are also returned.</p>
<p>For large data where there are more than 2 treatment groups the
computations can be memory extensive when there are many covariates due
to the multinomial-regression model used for the propensity scores.
Otherwise the function (binregATE) will run for large data.</p>
<p>The ATE functions need that the treatment that is given as the first
variable on the right hand side of the outcome model is a factor. The
variable is also indentified from the left hand side of the treatment
model (treat.model), that per default assumes that treatment does not
depend on any covariates.</p>
</div>
<div class="section level2">
<h2 id="average-treatment-effect">Average treatment effect<a class="anchor" aria-label="anchor" href="#average-treatment-effect"></a>
</h2>
<p>First we simulate some data that mimics that of Kumar et al 2012.
This is data from multiple myeloma patients treated with allogeneic stem
cell transplantation from the Center for International Blood and Marrow
Transplant Research (CIBMTR) Kumar et al (2012), “Trends in allogeneic
stem cell transplantation for multiple myeloma: a CIBMTR analysis”. The
data used in this paper consist of patients transplanted from 1995 to
2005, and we compared the outcomes between transplant periods: 2001-2005
(N=488) versus 1995-2000 (N=375). The two competing events were relapse
(cause 2) and treatment-related mortality (TRM, cause 1) defined as
death without relapse. considered the following risk covariates:
transplant time period (gp (main interest of the study): 1 for
transplanted in 2001-2005 versus 0 for transplanted in 1995-2000), donor
type (dnr: 1 for Unrelated or other related donor (N=280) versus 0 for
HLA-identical sibling (N=584)), prior autologous transplant (preauto: 1
for Auto+Allo transplant (N=399) versus 0 for allogeneic transplant
alone (N=465)) and time to transplant (ttt24: 1 for more than 24 months
(N=289) versus 0 for less than or equal to 24 months (N=575))).</p>
<p>We here generate similar data by assuming that the two cumlative
incidence curves are logistic and we have censoring that depends on the
covariates via a Cox model. All this is wrapped in the kumarsim
function. The simulation does not deal with possible violations of the
bound that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mn>1</mn></msub><mo>+</mo><msub><mi>F</mi><mn>2</mn></msub><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">F_1+F_2 &lt; 1</annotation></semantics></math>.
But as we increase the sample size we still see that we recover the
parameters of cause 2.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">###install.packages("mets")</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kkholst.github.io/mets/" class="external-link">mets</a></span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">###</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">400</span></span>
<span><span class="va">kumar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/binregATE.html">kumarsim</a></span><span class="op">(</span><span class="va">n</span>,depcens<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">kumar</span><span class="op">$</span><span class="va">cause</span> <span class="op">&lt;-</span> <span class="va">kumar</span><span class="op">$</span><span class="va">status</span></span>
<span><span class="va">kumar</span><span class="op">$</span><span class="va">ttt24</span> <span class="op">&lt;-</span> <span class="va">kumar</span><span class="op">[</span>,<span class="fl">6</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/dtable.html">dtable</a></span><span class="op">(</span><span class="va">kumar</span>,<span class="op">~</span><span class="va">cause</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; cause</span></span>
<span><span class="co">#&gt;   0   1   2 </span></span>
<span><span class="co">#&gt; 122 126 152</span></span>
<span><span class="fu"><a href="../reference/drelevel.html">dfactor</a></span><span class="op">(</span><span class="va">kumar</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">gp.f</span><span class="op">~</span><span class="va">gp</span></span>
<span><span class="va">kumar</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">400</span></span>
<span><span class="va">kumar</span><span class="op">$</span><span class="va">idc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">400</span>,<span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">kumar</span><span class="op">$</span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">400</span>,<span class="fl">400</span><span class="op">)</span></span>
<span><span class="va">kumar</span><span class="op">$</span><span class="va">id2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">400</span>,<span class="fl">400</span><span class="op">)</span></span>
<span><span class="va">kumar2</span> <span class="op">&lt;-</span> <span class="va">kumar</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">kumar</span><span class="op">$</span><span class="va">id2</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">kumar</span><span class="op">$</span><span class="va">int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">kumar</span><span class="op">$</span><span class="va">gp</span>,<span class="va">kumar</span><span class="op">$</span><span class="va">dnr</span><span class="op">)</span></span>
<span><span class="va">kumar2</span><span class="op">$</span><span class="va">int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">kumar2</span><span class="op">$</span><span class="va">gp</span>,<span class="va">kumar2</span><span class="op">$</span><span class="va">dnr</span><span class="op">)</span></span>
<span><span class="va">clust</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/binregATE.html">binregATE</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">cause</span><span class="op">)</span><span class="op">~</span><span class="va">gp.f</span><span class="op">+</span><span class="va">dnr</span><span class="op">+</span><span class="va">preauto</span><span class="op">+</span><span class="va">ttt24</span>,<span class="va">kumar2</span>,cause<span class="op">=</span><span class="fl">2</span>,</span>
<span>    treat.model<span class="op">=</span><span class="va">gp.f</span><span class="op">~</span><span class="va">dnr</span><span class="op">+</span><span class="va">preauto</span><span class="op">+</span><span class="va">ttt24</span>,time<span class="op">=</span><span class="fl">40</span>,cens.model<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">gp</span>,<span class="va">dnr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">b2</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400    144</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  400 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept) -1.074326  0.214347 -1.494439 -0.654214  0.0000</span></span>
<span><span class="co">#&gt; gp.f1        0.669400  0.259837  0.160129  1.178670  0.0100</span></span>
<span><span class="co">#&gt; dnr          0.238437  0.263384 -0.277787  0.754661  0.3653</span></span>
<span><span class="co">#&gt; preauto      0.587886  0.275985  0.046965  1.128806  0.0332</span></span>
<span><span class="co">#&gt; ttt24        0.085280  0.275382 -0.454458  0.625018  0.7568</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; (Intercept)  0.34153 0.22437 0.5199</span></span>
<span><span class="co">#&gt; gp.f1        1.95306 1.17366 3.2500</span></span>
<span><span class="co">#&gt; dnr          1.26926 0.75746 2.1269</span></span>
<span><span class="co">#&gt; preauto      1.80018 1.04809 3.0920</span></span>
<span><span class="co">#&gt; ttt24        1.08902 0.63479 1.8683</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment effects (G-formula) :</span></span>
<span><span class="co">#&gt;            Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; treat0    -0.684331  0.183487 -1.043959 -0.324702  0.0002</span></span>
<span><span class="co">#&gt; treat1    -0.014931  0.171518 -0.351101  0.321239  0.9306</span></span>
<span><span class="co">#&gt; treat:1-0  0.669400  0.259837  0.160129  1.178670  0.0100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment effects (double robust) :</span></span>
<span><span class="co">#&gt;           Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span><span class="co">#&gt; treat0    0.317773 0.040256 0.238872 0.396673  0.0000</span></span>
<span><span class="co">#&gt; treat1    0.496173 0.043239 0.411427 0.580920  0.0000</span></span>
<span><span class="co">#&gt; treat:1-0 0.178401 0.058844 0.063068 0.293734  0.0024</span></span>
<span></span>
<span><span class="va">b5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/binregATE.html">binregATE</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">cause</span><span class="op">)</span><span class="op">~</span><span class="va">int</span><span class="op">+</span><span class="va">preauto</span><span class="op">+</span><span class="va">ttt24</span>,<span class="va">kumar</span>,cause<span class="op">=</span><span class="fl">2</span>,</span>
<span>        treat.model<span class="op">=</span><span class="va">int</span><span class="op">~</span><span class="va">preauto</span><span class="op">+</span><span class="va">ttt24</span>,cens.code<span class="op">=</span><span class="fl">0</span>,time<span class="op">=</span><span class="fl">60</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">b5</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400    150</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  400 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept) -1.067627  0.285570 -1.627333 -0.507921  0.0002</span></span>
<span><span class="co">#&gt; int1.0       0.846566  0.320929  0.217557  1.475575  0.0083</span></span>
<span><span class="co">#&gt; int0.1       0.619052  0.494731 -0.350604  1.588707  0.2108</span></span>
<span><span class="co">#&gt; int1.1       0.896555  0.410239  0.092501  1.700609  0.0289</span></span>
<span><span class="co">#&gt; preauto      0.373155  0.273876 -0.163631  0.909942  0.1730</span></span>
<span><span class="co">#&gt; ttt24        0.468170  0.300260 -0.120328  1.056668  0.1189</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; (Intercept)  0.34382 0.19645 0.6017</span></span>
<span><span class="co">#&gt; int1.0       2.33163 1.24304 4.3735</span></span>
<span><span class="co">#&gt; int0.1       1.85717 0.70426 4.8974</span></span>
<span><span class="co">#&gt; int1.1       2.45115 1.09691 5.4773</span></span>
<span><span class="co">#&gt; preauto      1.45231 0.84906 2.4842</span></span>
<span><span class="co">#&gt; ttt24        1.59707 0.88663 2.8768</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment effects (G-formula) :</span></span>
<span><span class="co">#&gt;                Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; treat0.0      -0.724432  0.269297 -1.252245 -0.196620  0.0071</span></span>
<span><span class="co">#&gt; treat1.0       0.122134  0.173553 -0.218023  0.462290  0.4816</span></span>
<span><span class="co">#&gt; treat0.1      -0.105381  0.420091 -0.928745  0.717983  0.8019</span></span>
<span><span class="co">#&gt; treat1.1       0.172123  0.292009 -0.400204  0.744450  0.5556</span></span>
<span><span class="co">#&gt; treat:1.0-0.0  0.846566  0.320929  0.217557  1.475575  0.0083</span></span>
<span><span class="co">#&gt; treat:0.1-0.0  0.619052  0.494731 -0.350604  1.588707  0.2108</span></span>
<span><span class="co">#&gt; treat:1.1-0.0  0.896555  0.410239  0.092501  1.700609  0.0289</span></span>
<span><span class="co">#&gt; treat:0.1-1.0 -0.227514  0.462117 -1.133247  0.678219  0.6225</span></span>
<span><span class="co">#&gt; treat:1.1-1.0  0.049989  0.342303 -0.620913  0.720891  0.8839</span></span>
<span><span class="co">#&gt; treat:1.1-0.1  0.277504  0.515530 -0.732917  1.287924  0.5904</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment effects (double robust) :</span></span>
<span><span class="co">#&gt;                Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; treat0.0       0.354351  0.057164  0.242312  0.466391  0.0000</span></span>
<span><span class="co">#&gt; treat1.0       0.464900  0.079669  0.308752  0.621048  0.0000</span></span>
<span><span class="co">#&gt; treat0.1       0.597978  0.616708 -0.610748  1.806704  0.3322</span></span>
<span><span class="co">#&gt; treat1.1       0.545436  0.637030 -0.703121  1.793992  0.3919</span></span>
<span><span class="co">#&gt; treat:1.0-0.0  0.110549  0.097618 -0.080779  0.301876  0.2574</span></span>
<span><span class="co">#&gt; treat:0.1-0.0  0.243627  0.624019 -0.979428  1.466681  0.6962</span></span>
<span><span class="co">#&gt; treat:1.1-0.0  0.191084  0.642422 -1.068039  1.450207  0.7661</span></span>
<span><span class="co">#&gt; treat:0.1-1.0  0.133078  0.629442 -1.100606  1.366762  0.8326</span></span>
<span><span class="co">#&gt; treat:1.1-1.0  0.080536  0.625281 -1.144992  1.306064  0.8975</span></span>
<span><span class="co">#&gt; treat:1.1-0.1 -0.052542  0.596654 -1.221962  1.116877  0.9298</span></span></code></pre></div>
<p>We note that the estimates found using the large censoring model are
very different from those using the simple Kaplan-Meier weights that are
severely biased for these data. This is due to a stong censoring
dependence.</p>
<p>The average treatment is around
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.17</mn><mo>=</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">0.17 = E(Y(1) - Y(0))</annotation></semantics></math>
at time 60 for the transplant period, under the standard causal
assumptions. The 1/0 treatment variable used for the causal computation
is found as the right hand side (rhs) of the treat.model or as the first
argument on the rhs of the response model.</p>
</div>
<div class="section level2">
<h2 id="average-treatment-effect-for-binary-or-continuous-responses">Average treatment effect for binary or continuous responses<a class="anchor" aria-label="anchor" href="#average-treatment-effect-for-binary-or-continuous-responses"></a>
</h2>
<p>In the binary case a binary outcome is specified instead of the
survival outcome, and as a consequence no-censoring adjustment is
done</p>
<ul>
<li>the binary/numeric outcome must be a variable in the data-frame</li>
</ul>
<p>Running the code (can also use binregATE koding cause without
censorings values, so setting cens.code=2, and time large)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kumar</span><span class="op">$</span><span class="va">cause2</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">*</span><span class="op">(</span><span class="va">kumar</span><span class="op">$</span><span class="va">cause</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/binregATE.html">logitATE</a></span><span class="op">(</span><span class="va">cause2</span><span class="op">~</span><span class="va">gp.f</span><span class="op">+</span><span class="va">dnr</span><span class="op">+</span><span class="va">preauto</span><span class="op">+</span><span class="va">ttt24</span>,<span class="va">kumar</span>,treat.model<span class="op">=</span><span class="va">gp.f</span><span class="op">~</span><span class="va">dnr</span><span class="op">+</span><span class="va">preauto</span><span class="op">+</span><span class="va">ttt24</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">b3</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400    400</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  400 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;                Estimate     Std.Err        2.5%       97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept) -1.07282963  0.19388190 -1.45283117 -0.69282808  0.0000</span></span>
<span><span class="co">#&gt; gp.f1        0.26229718  0.23212023 -0.19265012  0.71724448  0.2585</span></span>
<span><span class="co">#&gt; dnr          0.47162640  0.24030425  0.00063871  0.94261408  0.0497</span></span>
<span><span class="co">#&gt; preauto      0.26934293  0.24156220 -0.20411028  0.74279614  0.2648</span></span>
<span><span class="co">#&gt; ttt24        0.40066829  0.24437556 -0.07829902  0.87963559  0.1011</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; (Intercept)  0.34204 0.23391 0.5002</span></span>
<span><span class="co">#&gt; gp.f1        1.29991 0.82477 2.0488</span></span>
<span><span class="co">#&gt; dnr          1.60260 1.00064 2.5667</span></span>
<span><span class="co">#&gt; preauto      1.30910 0.81537 2.1018</span></span>
<span><span class="co">#&gt; ttt24        1.49282 0.92469 2.4100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment effects (G-formula) :</span></span>
<span><span class="co">#&gt;           Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span><span class="co">#&gt; treat0    -0.65978  0.17273 -0.99833 -0.32122  0.0001</span></span>
<span><span class="co">#&gt; treat1    -0.39748  0.14485 -0.68139 -0.11357  0.0061</span></span>
<span><span class="co">#&gt; treat:1-0  0.26230  0.23212 -0.19265  0.71724  0.2585</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment effects (double robust) :</span></span>
<span><span class="co">#&gt;            Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; treat0     0.340232  0.040085  0.261667  0.418798   0.000</span></span>
<span><span class="co">#&gt; treat1     0.398325  0.034951  0.329823  0.466828   0.000</span></span>
<span><span class="co">#&gt; treat:1-0  0.058093  0.052008 -0.043842  0.160027   0.264</span></span>
<span></span>
<span><span class="co">###library(targeted)</span></span>
<span><span class="co">###b3a &lt;- ate(cause2~gp.f|dnr+preauto+ttt24| dnr+preauto+ttt24,kumar,family=binomial)</span></span>
<span><span class="co">###summary(b3a)</span></span>
<span></span>
<span><span class="co">## calculate also relative risk</span></span>
<span><span class="fu"><a href="https://kkholst.github.io/lava/reference/estimate.default.html" class="external-link">estimate</a></span><span class="op">(</span>coef<span class="op">=</span><span class="va">b3</span><span class="op">$</span><span class="va">riskDR</span>,vcov<span class="op">=</span><span class="va">b3</span><span class="op">$</span><span class="va">var.riskDR</span>,f<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;        Estimate Std.Err   2.5% 97.5%   P-value</span></span>
<span><span class="co">#&gt; treat0   0.8542  0.1228 0.6135 1.095 3.506e-12</span></span></code></pre></div>
<p>Or with continuous response using normal estimating equations</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/binregATE.html">normalATE</a></span><span class="op">(</span><span class="va">time</span><span class="op">~</span><span class="va">gp.f</span><span class="op">+</span><span class="va">dnr</span><span class="op">+</span><span class="va">preauto</span><span class="op">+</span><span class="va">ttt24</span>,<span class="va">kumar</span>,treat.model<span class="op">=</span><span class="va">gp.f</span><span class="op">~</span><span class="va">dnr</span><span class="op">+</span><span class="va">preauto</span><span class="op">+</span><span class="va">ttt24</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">b3</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400    400</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  400 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept)  27.80015   3.30304  21.32631  34.27399  0.0000</span></span>
<span><span class="co">#&gt; gp.f1       -16.06100   3.25515 -22.44098  -9.68102  0.0000</span></span>
<span><span class="co">#&gt; dnr          -6.51649   3.16550 -12.72075  -0.31223  0.0395</span></span>
<span><span class="co">#&gt; preauto       1.66745   2.93033  -4.07590   7.41080  0.5693</span></span>
<span><span class="co">#&gt; ttt24        -1.12151   3.27807  -7.54640   5.30338  0.7323</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment effects (G-formula) :</span></span>
<span><span class="co">#&gt;           Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span><span class="co">#&gt; treat0     26.2456   2.9998  20.3660  32.1251       0</span></span>
<span><span class="co">#&gt; treat1     10.1846   1.0464   8.1336  12.2355       0</span></span>
<span><span class="co">#&gt; treat:1-0 -16.0610   3.2552 -22.4410  -9.6810       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment effects (double robust) :</span></span>
<span><span class="co">#&gt;           Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span><span class="co">#&gt; treat0     28.0289   3.2124  21.7328  34.3251       0</span></span>
<span><span class="co">#&gt; treat1     10.7094   1.0007   8.7481  12.6707       0</span></span>
<span><span class="co">#&gt; treat:1-0 -17.3195   3.3652 -23.9153 -10.7238       0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sessioninfo">SessionInfo<a class="anchor" aria-label="anchor" href="#sessioninfo"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.1 (2025-06-13)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] mets_1.3.7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] cli_3.6.5           knitr_1.50          rlang_1.1.6        </span></span>
<span><span class="co">#&gt;  [4] xfun_0.53           textshaping_1.0.1   jsonlite_2.0.0     </span></span>
<span><span class="co">#&gt;  [7] listenv_0.9.1       future.apply_1.20.0 lava_1.8.1         </span></span>
<span><span class="co">#&gt; [10] htmltools_0.5.8.1   ragg_1.4.0          sass_0.4.10        </span></span>
<span><span class="co">#&gt; [13] rmarkdown_2.29      grid_4.5.1          evaluate_1.0.5     </span></span>
<span><span class="co">#&gt; [16] jquerylib_0.1.4     fastmap_1.2.0       numDeriv_2016.8-1.1</span></span>
<span><span class="co">#&gt; [19] yaml_2.3.10         mvtnorm_1.3-3       lifecycle_1.0.4    </span></span>
<span><span class="co">#&gt; [22] timereg_2.0.7       compiler_4.5.1      codetools_0.2-20   </span></span>
<span><span class="co">#&gt; [25] fs_1.6.6            Rcpp_1.1.0          future_1.67.0      </span></span>
<span><span class="co">#&gt; [28] lattice_0.22-7      systemfonts_1.2.3   digest_0.6.37      </span></span>
<span><span class="co">#&gt; [31] R6_2.6.1            parallelly_1.45.1   parallel_4.5.1     </span></span>
<span><span class="co">#&gt; [34] splines_4.5.1       Matrix_1.7-3        bslib_0.9.0        </span></span>
<span><span class="co">#&gt; [37] tools_4.5.1         globals_0.18.0      survival_3.8-3     </span></span>
<span><span class="co">#&gt; [40] pkgdown_2.1.3       cachem_1.1.0        desc_1.4.3</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Klaus K. Holst, Thomas Scheike.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
