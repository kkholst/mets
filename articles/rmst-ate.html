<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Average treatment effect (ATE) for Restricted mean survival and years lost of Competing risks • mets</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Average treatment effect (ATE) for Restricted mean survival and years lost of Competing risks">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mets</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basic-dutils.html">dUtility data-frame manipulations</a>
    </li>
    <li>
      <a href="../articles/binomial-family.html">Analysis of multivariate binomial data: family analysis</a>
    </li>
    <li>
      <a href="../articles/binomial-twin.html">Analysis of bivariate binomial data: Twin analysis</a>
    </li>
    <li>
      <a href="../articles/binreg-ate.html">Average treatment effect (ATE) for Competing risks and binary outcomes</a>
    </li>
    <li>
      <a href="../articles/binreg-TRS.html">Two-Stage Randomization for for Competing risks and Survival outcomes</a>
    </li>
    <li>
      <a href="../articles/binreg.html">Binomial Regression for Survival and Competing Risks Data</a>
    </li>
    <li>
      <a href="../articles/cifreg.html">Cumulative Incidence Regression</a>
    </li>
    <li>
      <a href="../articles/cooking-survival-data.html">WIP: Cooking survival data, 5 minute recipes</a>
    </li>
    <li>
      <a href="../articles/glm-utility.html">GEE cluster standard errors and predictions for glm objects</a>
    </li>
    <li>
      <a href="../articles/haplo-discrete-ttp.html">Haplotype Discrete Survival Models</a>
    </li>
    <li>
      <a href="../articles/interval-discrete-survival.html">Discrete Interval Censored Survival Models</a>
    </li>
    <li>
      <a href="../articles/marginal-cox.html">Marginal modelling of clustered survival data</a>
    </li>
    <li>
      <a href="../articles/mediation-survival.html">Mediation Analysis for survival data</a>
    </li>
    <li>
      <a href="../articles/phreg_rct.html">Two-Stage Randomization for Cox Type rate models </a>
    </li>
    <li>
      <a href="../articles/quantitative-twin.html">Twin models</a>
    </li>
    <li>
      <a href="../articles/recurrent-events.html">Recurrent events</a>
    </li>
    <li>
      <a href="../articles/rmst-ate.html">Average treatment effect (ATE) for Restricted mean survival and years lost of Competing risks</a>
    </li>
    <li>
      <a href="../articles/survival-ate.html">G-Computation or standardization for the Cox, Fine-Gray and binomial regression models for survival data</a>
    </li>
    <li>
      <a href="../articles/time-to-event-family-studies-arev.html">A practical guide to Human Genetics with Lifetime Data</a>
    </li>
    <li>
      <a href="../articles/twostage-survival.html">Analysis of multivariate survival data</a>
    </li>
    <li>
      <a href="../articles/while-alive.html">While Alive estimands for Recurrent Events</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kkholst/mets/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Average treatment effect (ATE) for Restricted
mean survival and years lost of Competing risks</h1>
                        <h4 data-toc-skip class="author">Klaus Holst
&amp; Thomas Scheike</h4>
            
            <h4 data-toc-skip class="date">2025-08-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/kkholst/mets/blob/main/vignettes/rmst-ate.Rmd" class="external-link"><code>vignettes/rmst-ate.Rmd</code></a></small>
      <div class="hidden name"><code>rmst-ate.Rmd</code></div>

    </div>

    
    
<p>The resmeanATE or resmeanIPCW/rmstIPCW functions can fit an
exponential/linear link model with IPCW adjustment for a specific
time-point for the resticted mean survival or years lost for competing
risks. The function can be used for large data and is completely
scalable, that is, linear in the data. The function can thus be used for
large data. A nice feature is that influcence functions are computed and
are available.</p>
<p>In addition and to summarize</p>
<ul>
<li>the censoring weights can be strata dependent</li>
<li>predictions can be computed with standard errors</li>
<li>computation time is linear in data
<ul>
<li>including standard errors</li>
</ul>
</li>
<li>clusters can be given and then cluster corrected standard errors are
computed</li>
</ul>
<div class="section level2">
<h2 id="rmst">RMST<a class="anchor" aria-label="anchor" href="#rmst"></a>
</h2>
<p>Regression for rmst outcome
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>∧</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>e</mi><mi>x</mi><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>X</mi><mi>T</mi></msup><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">E(T \wedge t | X) = exp(X^T \beta)</annotation></semantics></math>
based on IPCW adjustment for censoring, thus solving the estimating
equation
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><msup><mi>X</mi><mi>T</mi></msup><mrow><mo stretchy="true" form="prefix">[</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>∧</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mfrac><mrow><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>C</mi><mo>&gt;</mo><mi>T</mi><mo>∧</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msub><mi>G</mi><mi>C</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>∧</mo><mi>t</mi><mo>,</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>−</mo><mi>e</mi><mi>x</mi><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>X</mi><mi>T</mi></msup><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mn>0</mn><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
 &amp; X^T [ (T \wedge t) \frac{I(C &gt; T \wedge t)}{G_C(T \wedge t,X)} - exp(X^T \beta) ] = 0 .
\end{align*}</annotation></semantics></math> This is done with the
resmeanIPCW function. For fully saturated model with full censoring
model this is equal to the integrals of the Kaplan-Meier estimators as
illustrated below.</p>
<p>We can also compute the integral of the Kaplan-Meier or Cox based
survival estimator to get the RMST (with the resmean.phreg function)
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∫</mo><mn>0</mn><mi>t</mi></msubsup><mi>S</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="false" form="prefix">|</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>s</mi></mrow><annotation encoding="application/x-tex"> \int_0^t S(s|X) ds </annotation></semantics></math>.</p>
<p>For competing risks the years lost can be computed via cumulative
incidence functions (cif.yearslost) or as IPCW estimator since<br><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ϵ</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><mi>T</mi><mo>∧</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="prefix">|</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>∫</mo><mn>0</mn><mi>t</mi></msubsup><msub><mi>F</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>s</mi><mi>.</mi></mrow><annotation encoding="application/x-tex"> E( I(\epsilon=1) ( t - T \wedge t ) | X) = \int_0^t F_1(s) ds. </annotation></semantics></math>
For fully saturated model with full censoring model these estimators are
equivalent as illustrated below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">101</span><span class="op">)</span></span>
<span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">bmt</span><span class="op">)</span>; <span class="va">bmt</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">bmt</span><span class="op">$</span><span class="va">time</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bmt</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">0.001</span></span>
<span></span>
<span>     <span class="co"># E( min(T;t) | X ) = exp( a+b X) with IPCW estimation </span></span>
<span>     <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resmeanIPCW.html">resmeanIPCW</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">cause</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span><span class="op">~</span><span class="va">tcell</span><span class="op">+</span><span class="va">platelet</span><span class="op">+</span><span class="va">age</span>,<span class="va">bmt</span>,</span>
<span>                     time<span class="op">=</span><span class="fl">50</span>,cens.model<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">platelet</span><span class="op">)</span>,model<span class="op">=</span><span class="st">"exp"</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  408    245</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  408 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept)  3.014321  0.065114  2.886700  3.141941  0.0000</span></span>
<span><span class="co">#&gt; tcell        0.106526  0.138268 -0.164473  0.377525  0.4410</span></span>
<span><span class="co">#&gt; platelet     0.247103  0.097337  0.056325  0.437880  0.0111</span></span>
<span><span class="co">#&gt; age         -0.185936  0.043566 -0.271324 -0.100548  0.0000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;             Estimate     2.5%   97.5%</span></span>
<span><span class="co">#&gt; (Intercept) 20.37524 17.93403 23.1488</span></span>
<span><span class="co">#&gt; tcell        1.11241  0.84834  1.4587</span></span>
<span><span class="co">#&gt; platelet     1.28031  1.05794  1.5494</span></span>
<span><span class="co">#&gt; age          0.83033  0.76237  0.9043</span></span>
<span>     </span>
<span>      <span class="co">### same as Kaplan-Meier for full censoring model </span></span>
<span>     <span class="va">bmt</span><span class="op">$</span><span class="va">int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">bmt</span>,<span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">tcell</span>,<span class="va">platelet</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resmeanIPCW.html">resmeanIPCW</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">cause</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span><span class="op">~</span><span class="op">-</span><span class="fl">1</span><span class="op">+</span><span class="va">int</span>,<span class="va">bmt</span>,time<span class="op">=</span><span class="fl">30</span>,</span>
<span>                                  cens.model<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">platelet</span>,<span class="va">tcell</span><span class="op">)</span>,model<span class="op">=</span><span class="st">"lin"</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://kkholst.github.io/lava/reference/estimate.default.html" class="external-link">estimate</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#&gt;                        Estimate Std.Err  2.5% 97.5%   P-value</span></span>
<span><span class="co">#&gt; inttcell=0, platelet=0    13.60  0.8316 11.97 15.23 3.826e-60</span></span>
<span><span class="co">#&gt; inttcell=0, platelet=1    18.90  1.2696 16.41 21.39 3.997e-50</span></span>
<span><span class="co">#&gt; inttcell=1, platelet=0    16.19  2.4061 11.48 20.91 1.705e-11</span></span>
<span><span class="co">#&gt; inttcell=1, platelet=1    17.77  2.4536 12.96 22.58 4.463e-13</span></span>
<span>     <span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">cause</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">tcell</span>,<span class="va">platelet</span><span class="op">)</span>,data<span class="op">=</span><span class="va">bmt</span><span class="op">)</span></span>
<span>     <span class="va">rm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resmean.phreg.html">resmean.phreg</a></span><span class="op">(</span><span class="va">out1</span>,times<span class="op">=</span><span class="fl">30</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rm1</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     strata times    rmean  se.rmean    lower    upper</span></span>
<span><span class="co">#&gt; tcell=0, platelet=0      0    30 13.60295 0.8315418 12.06700 15.33439</span></span>
<span><span class="co">#&gt; tcell=0, platelet=1      1    30 18.90127 1.2693263 16.57021 21.56026</span></span>
<span><span class="co">#&gt; tcell=1, platelet=0      2    30 16.19121 2.4006185 12.10806 21.65131</span></span>
<span><span class="co">#&gt; tcell=1, platelet=1      3    30 17.76610 2.4421987 13.57008 23.25956</span></span>
<span><span class="co">#&gt;                     years.lost</span></span>
<span><span class="co">#&gt; tcell=0, platelet=0   16.39705</span></span>
<span><span class="co">#&gt; tcell=0, platelet=1   11.09873</span></span>
<span><span class="co">#&gt; tcell=1, platelet=0   13.80879</span></span>
<span><span class="co">#&gt; tcell=1, platelet=1   12.23390</span></span>
<span>     </span>
<span>     <span class="co">## competing risks years-lost for cause 1  </span></span>
<span>     <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resmeanIPCW.html">resmeanIPCW</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">cause</span><span class="op">)</span><span class="op">~</span><span class="op">-</span><span class="fl">1</span><span class="op">+</span><span class="va">int</span>,<span class="va">bmt</span>,time<span class="op">=</span><span class="fl">30</span>,cause<span class="op">=</span><span class="fl">1</span>,</span>
<span>                                 cens.model<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">platelet</span>,<span class="va">tcell</span><span class="op">)</span>,model<span class="op">=</span><span class="st">"lin"</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://kkholst.github.io/lava/reference/estimate.default.html" class="external-link">estimate</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#&gt;                        Estimate Std.Err   2.5%  97.5%   P-value</span></span>
<span><span class="co">#&gt; inttcell=0, platelet=0   12.105  0.8508 10.438 13.773 6.162e-46</span></span>
<span><span class="co">#&gt; inttcell=0, platelet=1    6.884  1.1741  4.583  9.185 4.536e-09</span></span>
<span><span class="co">#&gt; inttcell=1, platelet=0    7.261  2.3533  2.648 11.873 2.033e-03</span></span>
<span><span class="co">#&gt; inttcell=1, platelet=1    5.780  2.0925  1.679  9.882 5.737e-03</span></span>
<span>     <span class="co">## same as integrated cumulative incidence </span></span>
<span>     <span class="va">rmc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resmean.phreg.html">cif.yearslost</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">cause</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">tcell</span>,<span class="va">platelet</span><span class="op">)</span>,data<span class="op">=</span><span class="va">bmt</span>,times<span class="op">=</span><span class="fl">30</span>,cause<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rmc1</span><span class="op">)</span></span>
<span><span class="co">#&gt; $estimate</span></span>
<span><span class="co">#&gt;                     strata times    intF_1   intF_2 se.intF_1 se.intF_2</span></span>
<span><span class="co">#&gt; tcell=0, platelet=0      0    30 12.105125 4.291930 0.8508102 0.6161439</span></span>
<span><span class="co">#&gt; tcell=0, platelet=1      1    30  6.884171 4.214556 1.1740988 0.9057028</span></span>
<span><span class="co">#&gt; tcell=1, platelet=0      2    30  7.260755 6.548034 2.3532867 1.9703340</span></span>
<span><span class="co">#&gt; tcell=1, platelet=1      3    30  5.780369 6.453535 2.0924946 2.0815225</span></span>
<span><span class="co">#&gt;                     total.years.lost lower_intF_1 upper_intF_1 lower_intF_2</span></span>
<span><span class="co">#&gt; tcell=0, platelet=0         16.39705    10.547328    13.893001     3.239330</span></span>
<span><span class="co">#&gt; tcell=0, platelet=1         11.09873     4.928092     9.616665     2.765857</span></span>
<span><span class="co">#&gt; tcell=1, platelet=0         13.80879     3.846790    13.704561     3.630616</span></span>
<span><span class="co">#&gt; tcell=1, platelet=1         12.23390     2.843285    11.751429     3.429661</span></span>
<span><span class="co">#&gt;                     upper_intF_2</span></span>
<span><span class="co">#&gt; tcell=0, platelet=0     5.686565</span></span>
<span><span class="co">#&gt; tcell=0, platelet=1     6.422055</span></span>
<span><span class="co">#&gt; tcell=1, platelet=0    11.809770</span></span>
<span><span class="co">#&gt; tcell=1, platelet=1    12.143507</span></span>
<span></span>
<span>     <span class="co">## plotting the years lost for different horizon's and the two causes </span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rm1</span>,years.lost<span class="op">=</span><span class="cn">TRUE</span>,se<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>     <span class="co">## cause refers to column of cumhaz for the different causes</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rmc1</span>,cause<span class="op">=</span><span class="fl">1</span>,se<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rmc1</span>,cause<span class="op">=</span><span class="fl">2</span>,se<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="rmst-ate_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Based on the output from the IPCW estimators we can derive any
measure of interest</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://kkholst.github.io/lava/reference/estimate.default.html" class="external-link">estimate</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#&gt;                        Estimate Std.Err   2.5%  97.5%   P-value</span></span>
<span><span class="co">#&gt; inttcell=0, platelet=0   12.105  0.8508 10.438 13.773 6.162e-46</span></span>
<span><span class="co">#&gt; inttcell=0, platelet=1    6.884  1.1741  4.583  9.185 4.536e-09</span></span>
<span><span class="co">#&gt; inttcell=1, platelet=0    7.261  2.3533  2.648 11.873 2.033e-03</span></span>
<span><span class="co">#&gt; inttcell=1, platelet=1    5.780  2.0925  1.679  9.882 5.737e-03</span></span>
<span></span>
<span><span class="va">measures</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="va">ratio1</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>; <span class="va">ratio2</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>; <span class="va">dif1</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">-</span><span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>; <span class="va">dif2</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">-</span><span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span> <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dif1</span>,<span class="va">dif2</span>,<span class="va">ratio1</span>,<span class="va">ratio2</span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span> <span class="va">labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dif4-1"</span>,<span class="st">"dif3-1"</span>,<span class="st">"ratio 1/2"</span>,<span class="st">"ratio 2/1"</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://kkholst.github.io/lava/reference/estimate.default.html" class="external-link">estimate</a></span><span class="op">(</span><span class="va">out</span>,f<span class="op">=</span><span class="va">measures</span>,labels<span class="op">=</span><span class="va">labs</span><span class="op">)</span></span>
<span><span class="co">#&gt;           Estimate Std.Err     2.5%    97.5%   P-value</span></span>
<span><span class="co">#&gt; dif4-1     -6.3248  2.2589 -10.7520 -1.89748 5.111e-03</span></span>
<span><span class="co">#&gt; dif3-1     -4.8444  2.5024  -9.7489  0.06018 5.288e-02</span></span>
<span><span class="co">#&gt; ratio 1/2   1.7584  0.3244   1.1227  2.39414 5.924e-08</span></span>
<span><span class="co">#&gt; ratio 2/1   0.5687  0.1049   0.3631  0.77431 5.924e-08</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="average-treatment-effect">Average treatment effect<a class="anchor" aria-label="anchor" href="#average-treatment-effect"></a>
</h2>
<p>Computes average treatment effect for restricted mean survival and
years lost in competing risks situation</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="../reference/drelevel.html">dfactor</a></span><span class="op">(</span><span class="va">bmt</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tcell</span><span class="op">~</span><span class="va">tcell</span></span>
<span> <span class="va">bmt</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">bmt</span><span class="op">$</span><span class="va">cause</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="fl">1</span></span>
<span> <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resmeanATE.html">resmeanATE</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">event</span><span class="op">)</span><span class="op">~</span><span class="va">tcell</span><span class="op">+</span><span class="va">platelet</span>,data<span class="op">=</span><span class="va">bmt</span>,time<span class="op">=</span><span class="fl">40</span>,treat.model<span class="op">=</span><span class="va">tcell</span><span class="op">~</span><span class="va">platelet</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  408    241</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  408 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept)  2.852670  0.062493  2.730187  2.975153  0.0000</span></span>
<span><span class="co">#&gt; tcell1       0.021401  0.122907 -0.219493  0.262295  0.8618</span></span>
<span><span class="co">#&gt; platelet     0.303489  0.090758  0.125606  0.481372  0.0008</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;             Estimate     2.5%   97.5%</span></span>
<span><span class="co">#&gt; (Intercept) 17.33400 15.33575 19.5926</span></span>
<span><span class="co">#&gt; tcell1       1.02163  0.80293  1.2999</span></span>
<span><span class="co">#&gt; platelet     1.35458  1.13383  1.6183</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment effects (G-formula) :</span></span>
<span><span class="co">#&gt;           Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span><span class="co">#&gt; treat0    19.26223  0.95926 17.38212 21.14234  0.0000</span></span>
<span><span class="co">#&gt; treat1    19.67890  2.22777 15.31255 24.04526  0.0000</span></span>
<span><span class="co">#&gt; treat:1-0  0.41667  2.41067 -4.30815  5.14150  0.8628</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment effects (double robust) :</span></span>
<span><span class="co">#&gt;           Estimate Std.Err    2.5%   97.5% P-value</span></span>
<span><span class="co">#&gt; treat0     19.3262  1.0516 17.2650 21.3873  0.0000</span></span>
<span><span class="co">#&gt; treat1     21.5621  3.8018 14.1106 29.0135  0.0000</span></span>
<span><span class="co">#&gt; treat:1-0   2.2359  4.1993 -5.9946 10.4664  0.5944</span></span>
<span> </span>
<span> <span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resmeanATE.html">resmeanATE</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">cause</span><span class="op">)</span><span class="op">~</span><span class="va">tcell</span><span class="op">+</span><span class="va">platelet</span>,data<span class="op">=</span><span class="va">bmt</span>,cause<span class="op">=</span><span class="fl">1</span>,time<span class="op">=</span><span class="fl">40</span>,</span>
<span>            treat.model<span class="op">=</span><span class="va">tcell</span><span class="op">~</span><span class="va">platelet</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out1</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  408    157</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  408 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept)  2.806295  0.069619  2.669845  2.942745  0.0000</span></span>
<span><span class="co">#&gt; tcell1      -0.374065  0.247669 -0.859488  0.111358  0.1310</span></span>
<span><span class="co">#&gt; platelet    -0.491736  0.164946 -0.815025 -0.168447  0.0029</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;             Estimate     2.5%   97.5%</span></span>
<span><span class="co">#&gt; (Intercept) 16.54849 14.43773 18.9678</span></span>
<span><span class="co">#&gt; tcell1       0.68793  0.42338  1.1178</span></span>
<span><span class="co">#&gt; platelet     0.61156  0.44263  0.8450</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment effects (G-formula) :</span></span>
<span><span class="co">#&gt;           Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span><span class="co">#&gt; treat0    14.53185  0.95707 12.65604 16.40767  0.0000</span></span>
<span><span class="co">#&gt; treat1     9.99693  2.37814  5.33587 14.65800  0.0000</span></span>
<span><span class="co">#&gt; treat:1-0 -4.53492  2.57516 -9.58213  0.51229  0.0782</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment effects (double robust) :</span></span>
<span><span class="co">#&gt;             Estimate    Std.Err       2.5%      97.5% P-value</span></span>
<span><span class="co">#&gt; treat0     14.520356   0.957707  12.643285  16.397428  0.0000</span></span>
<span><span class="co">#&gt; treat1      9.456750   2.405120   4.742802  14.170697  0.0001</span></span>
<span><span class="co">#&gt; treat:1-0  -5.063606   2.585664 -10.131415   0.004202  0.0502</span></span>
<span></span>
<span> <span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resmeanATE.html">resmeanATE</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">cause</span><span class="op">)</span><span class="op">~</span><span class="va">tcell</span><span class="op">+</span><span class="va">platelet</span>,data<span class="op">=</span><span class="va">bmt</span>,cause<span class="op">=</span><span class="fl">2</span>,time<span class="op">=</span><span class="fl">40</span>,</span>
<span>            treat.model<span class="op">=</span><span class="va">tcell</span><span class="op">~</span><span class="va">platelet</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out2</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  408     84</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  408 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;               Estimate    Std.Err       2.5%      97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept)  1.8266090  0.1312181  1.5694263  2.0837918  0.0000</span></span>
<span><span class="co">#&gt; tcell1       0.4751558  0.2403839  0.0040121  0.9462996  0.0481</span></span>
<span><span class="co">#&gt; platelet    -0.0090724  0.2168469 -0.4340845  0.4159397  0.9666</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; (Intercept)  6.21278 4.80389 8.0349</span></span>
<span><span class="co">#&gt; tcell1       1.60826 1.00402 2.5762</span></span>
<span><span class="co">#&gt; platelet     0.99097 0.64786 1.5158</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment effects (G-formula) :</span></span>
<span><span class="co">#&gt;           Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span><span class="co">#&gt; treat0     6.19518  0.71372  4.79631  7.59405  0.0000</span></span>
<span><span class="co">#&gt; treat1     9.96349  2.09256  5.86216 14.06482  0.0000</span></span>
<span><span class="co">#&gt; treat:1-0  3.76831  2.21654 -0.57602  8.11264  0.0891</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment effects (double robust) :</span></span>
<span><span class="co">#&gt;           Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span><span class="co">#&gt; treat0     6.21830  0.71424  4.81842  7.61818  0.0000</span></span>
<span><span class="co">#&gt; treat1    10.38142  2.22242  6.02556 14.73728  0.0000</span></span>
<span><span class="co">#&gt; treat:1-0  4.16312  2.33581 -0.41500  8.74123  0.0747</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sessioninfo">SessionInfo<a class="anchor" aria-label="anchor" href="#sessioninfo"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.1 (2025-06-13)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] mets_1.3.7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] cli_3.6.5           knitr_1.50          rlang_1.1.6        </span></span>
<span><span class="co">#&gt;  [4] xfun_0.53           textshaping_1.0.1   jsonlite_2.0.0     </span></span>
<span><span class="co">#&gt;  [7] listenv_0.9.1       future.apply_1.20.0 lava_1.8.1         </span></span>
<span><span class="co">#&gt; [10] htmltools_0.5.8.1   ragg_1.4.0          sass_0.4.10        </span></span>
<span><span class="co">#&gt; [13] rmarkdown_2.29      grid_4.5.1          evaluate_1.0.5     </span></span>
<span><span class="co">#&gt; [16] jquerylib_0.1.4     fastmap_1.2.0       numDeriv_2016.8-1.1</span></span>
<span><span class="co">#&gt; [19] yaml_2.3.10         mvtnorm_1.3-3       lifecycle_1.0.4    </span></span>
<span><span class="co">#&gt; [22] timereg_2.0.7       compiler_4.5.1      codetools_0.2-20   </span></span>
<span><span class="co">#&gt; [25] fs_1.6.6            Rcpp_1.1.0          future_1.67.0      </span></span>
<span><span class="co">#&gt; [28] lattice_0.22-7      systemfonts_1.2.3   digest_0.6.37      </span></span>
<span><span class="co">#&gt; [31] R6_2.6.1            parallelly_1.45.1   parallel_4.5.1     </span></span>
<span><span class="co">#&gt; [34] splines_4.5.1       Matrix_1.7-3        bslib_0.9.0        </span></span>
<span><span class="co">#&gt; [37] tools_4.5.1         globals_0.18.0      survival_3.8-3     </span></span>
<span><span class="co">#&gt; [40] pkgdown_2.1.3       cachem_1.1.0        desc_1.4.3</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Klaus K. Holst, Thomas Scheike.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
