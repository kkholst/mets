<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Mediation Analysis for survival data • mets</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mediation Analysis for survival data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mets</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/basic-dutils.html">dUtility data-frame manipulations</a></li>
    <li><a class="dropdown-item" href="../articles/binomial-family.html">Analysis of multivariate binomial data: family analysis</a></li>
    <li><a class="dropdown-item" href="../articles/binomial-twin.html">Analysis of bivariate binomial data: Twin analysis</a></li>
    <li><a class="dropdown-item" href="../articles/binreg-ate.html">Average treatment effect (ATE) for Competing risks and binary outcomes</a></li>
    <li><a class="dropdown-item" href="../articles/binreg-TRS.html">Two-Stage Randomization for for Competing risks and Survival outcomes</a></li>
    <li><a class="dropdown-item" href="../articles/binreg.html">Binomial Regression for Survival and Competing Risks Data</a></li>
    <li><a class="dropdown-item" href="../articles/cifreg.html">Cumulative Incidence Regression</a></li>
    <li><a class="dropdown-item" href="../articles/cooking-survival-data.html">WIP: Cooking survival data, 5 minute recipes</a></li>
    <li><a class="dropdown-item" href="../articles/cumulative-cost.html">IPCW Cumulative Cost</a></li>
    <li><a class="dropdown-item" href="../articles/glm-utility.html">GEE cluster standard errors and predictions for glm objects</a></li>
    <li><a class="dropdown-item" href="../articles/haplo-discrete-ttp.html">Haplotype Discrete Survival Models</a></li>
    <li><a class="dropdown-item" href="../articles/interval-discrete-survival.html">Discrete Interval Censored Survival Models</a></li>
    <li><a class="dropdown-item" href="../articles/marginal-cox.html">Marginal modelling of clustered survival data</a></li>
    <li><a class="dropdown-item" href="../articles/mediation-survival.html">Mediation Analysis for survival data</a></li>
    <li><a class="dropdown-item" href="../articles/phreg_rct.html">Randomization for Cox Type rate models </a></li>
    <li><a class="dropdown-item" href="../articles/quantitative-twin.html">Twin models</a></li>
    <li><a class="dropdown-item" href="../articles/recurrent-events.html">Recurrent events</a></li>
    <li><a class="dropdown-item" href="../articles/rmst-ate.html">Average treatment effect (ATE) for Restricted mean survival and years lost of Competing risks</a></li>
    <li><a class="dropdown-item" href="../articles/survival-ate.html">G-Computation or standardization for the Cox, Fine-Gray and binomial regression models for survival data</a></li>
    <li><a class="dropdown-item" href="../articles/time-to-event-family-studies-arev.html">A practical guide to Human Genetics with Lifetime Data</a></li>
    <li><a class="dropdown-item" href="../articles/twostage-survival.html">Analysis of multivariate survival data</a></li>
    <li><a class="dropdown-item" href="../articles/while-alive.html">While Alive estimands for Recurrent Events</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kkholst/mets/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Mediation Analysis for survival data</h1>
                        <h4 data-toc-skip class="author">Klaus Holst
&amp; Thomas Scheike</h4>
            
            <h4 data-toc-skip class="date">2026-01-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/kkholst/mets/blob/main/vignettes/mediation-survival.Rmd" class="external-link"><code>vignettes/mediation-survival.Rmd</code></a></small>
      <div class="d-none name"><code>mediation-survival.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Fit</p>
<ul>
<li>binomial-regression IPCW, binreg</li>
<li>additive Lin-Ying model, aalenMets</li>
<li>cox model phreg</li>
<li>standard logistic regression via binreg</li>
</ul>
<p>in the context of mediation analysis using mediation weights as in
the medFlex package. We thus fit natural effects models, that for
example on the binary scale might state that
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">logit</mtext><mo stretchy="false" form="prefix">(</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>M</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>x</mi><mo>*</mo></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>β</mi><mn>0</mn></msub><mo>+</mo><msub><mi>β</mi><mn>1</mn></msub><mi>x</mi><mo>+</mo><msub><mi>β</mi><mn>2</mn></msub><msup><mi>x</mi><mo>*</mo></msup><mo>+</mo><msubsup><mi>β</mi><mn>3</mn><mi>T</mi></msubsup><mi>Z</mi><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\mbox{logit}(P(Y(x,M(x^*))=1| Z)  = \beta_0+ \beta_1 x + \beta_2 x^* + \beta_3^T Z,
\end{align*}</annotation></semantics></math> in this case the the
Natural Direct Effect (NDE) for fixed covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msubsup><mtext mathvariant="normal">OR</mtext><mrow><mn>1</mn><mo>,</mo><mn>0</mn><mo stretchy="false" form="prefix">|</mo><mi>Z</mi></mrow><mtext mathvariant="normal">NDE</mtext></msubsup><mo>=</mo><mfrac><mrow><mtext mathvariant="normal">odds</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mi>M</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="prefix">|</mo><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mtext mathvariant="normal">odds</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>M</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="prefix">|</mo><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>β</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
 \mbox{OR}_{1,0|Z}^{\mbox{NDE}} = \frac{\mbox{odds}(Y(1,M(x))|Z)}{\mbox{odds}(Y(0,M(x))|Z)}  = \exp(\beta_1),
\end{align*}</annotation></semantics></math> and the Natural Inderect
Effect (NIE) for fixed covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msubsup><mtext mathvariant="normal">OR</mtext><mrow><mn>1</mn><mo>,</mo><mn>0</mn><mo stretchy="false" form="prefix">|</mo><mi>Z</mi></mrow><mtext mathvariant="normal">NIE</mtext></msubsup><mo>=</mo><mfrac><mrow><mtext mathvariant="normal">odds</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>M</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="prefix">|</mo><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mtext mathvariant="normal">odds</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>M</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="prefix">|</mo><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>β</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
 \mbox{OR}_{1,0|Z}^{\mbox{NIE}} = \frac{\mbox{odds}(Y(x,M(1))|Z)}{\mbox{odds}(Y(x,M(0))|Z)} = \exp(\beta_2).
\end{align*}</annotation></semantics></math> See the medFlex package for
additional discussion of the parametrization.</p>
<p>The mediator can be</p>
<ul>
<li>binomial using glm-binomial.</li>
<li>multnomial via the mlogit function of mets</li>
</ul>
<p>Both mediator and exposure must be coded as factors.</p>
<p>In the below example these are</p>
<ul>
<li>mediator: gp.f</li>
<li>exposure : dnr.f</li>
</ul>
<p>and the outcome model is concerned with the risk/hazard of
cause=2.</p>
<p>The key is that the standard errors are computed using the i.i.d
influence functions and a Taylor expansion to deal with the uncertainty
from the mediation weights.</p>
</div>
<div class="section level2">
<h2 id="simulated-data">Simulated Data<a class="anchor" aria-label="anchor" href="#simulated-data"></a>
</h2>
<p>First we simulate some data that mimics that of Kumar et al 2012.
This is data from multiple myeloma patients treated with allogeneic stem
cell transplantation from the Center for International Blood and Marrow
Transplant Research (CIBMTR) Kumar et al (2012), “Trends in allogeneic
stem cell transplantation for multiple myeloma: a CIBMTR analysis”. The
data used in this paper consist of patients transplanted from 1995 to
2005, and we compared the outcomes between transplant periods: 2001-2005
(N=488) versus 1995-2000 (N=375). The two competing events were relapse
(cause 2) and treatment-related mortality (TRM, cause 1)) defined as
death without relapse. considered the following risk covariates:
transplant time period (gp (main interest of the study): 1 for
transplanted in 2001-2005 versus 0 for transplanted in 1995-2000), donor
type (dnr: 1 for Unrelated or other related donor (N=280) versus 0 for
HLA-identical sibling (N=584)), prior autologous transplant (preauto: 1
for Auto+Allo transplant (N=399) versus 0 for allogeneic transplant
alone (N=465)) and time to transplant (ttt24: 1 for more than 24 months
(N=289) versus 0 for less than or equal to 24 months (N=575))).</p>
<p>The interest is then on the effect of the period (gp) and the
possible mediation via the amount of unrealted or related donors (dnr).
A somewhat artificial example ! All adjusted for other important
counfounders.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kkholst.github.io/mets/" class="external-link">mets</a></span><span class="op">)</span></span>
<span> <span class="va">runb</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>warn<span class="op">=</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span> <span class="co"># to control output in simulatins for p-values below.</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span>; <span class="va">k.boot</span> <span class="op">&lt;-</span> <span class="fl">10</span>; </span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/binregATE.html">kumarsimRCT</a></span><span class="op">(</span><span class="va">n</span>,rho1<span class="op">=</span><span class="fl">0.5</span>,rho2<span class="op">=</span><span class="fl">0.5</span>,rct<span class="op">=</span><span class="fl">2</span>,censpar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>          beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.67</span>, <span class="fl">0.59</span>, <span class="fl">0.55</span>, <span class="fl">0.25</span>, <span class="fl">0.98</span>, <span class="fl">0.18</span>, <span class="fl">0.45</span>, <span class="fl">0.31</span><span class="op">)</span>,</span>
<span>    treatmodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.18</span>, <span class="fl">0.56</span>, <span class="fl">0.56</span>, <span class="fl">0.54</span><span class="op">)</span>,restrict<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/drelevel.html">dfactor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">dnr.f</span><span class="op">~</span><span class="va">dnr</span></span>
<span><span class="fu"><a href="../reference/drelevel.html">dfactor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">gp.f</span><span class="op">~</span><span class="va">gp</span></span>
<span><span class="fu"><a href="../reference/dcut.html">drename</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ttt24</span><span class="op">~</span><span class="st">"ttt24*"</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">ftime</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mediation-weights">Mediation Weights<a class="anchor" aria-label="anchor" href="#mediation-weights"></a>
</h2>
<p>Then compute the mediation weights based on a mediation model</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weightmodel</span> <span class="op">&lt;-</span> <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">gp.f</span><span class="op">~</span><span class="va">dnr.f</span><span class="op">+</span><span class="va">preauto</span><span class="op">+</span><span class="va">ttt24</span>,data<span class="op">=</span><span class="va">dat</span>,family<span class="op">=</span><span class="va">binomial</span><span class="op">)</span></span>
<span><span class="va">wdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/medweight.html">medweight</a></span><span class="op">(</span><span class="va">fit</span>,data<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="binomial-regression">Binomial Regression<a class="anchor" aria-label="anchor" href="#binomial-regression"></a>
</h2>
<p>A simple multvariate regression of the probaibility of relapse at 50
months with both exposure and mediator (given the other covariates)</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aaMss2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/binreg.html">binreg</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">gp</span><span class="op">+</span><span class="va">dnr</span><span class="op">+</span><span class="va">preauto</span><span class="op">+</span><span class="va">ttt24</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">dat</span>,time<span class="op">=</span><span class="fl">50</span>,cause<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aaMss2</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  200     97</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  200 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;             Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept) -1.01508  0.31869 -1.63971 -0.39046  0.0014</span></span>
<span><span class="co">#&gt; gp           1.08533  0.34216  0.41471  1.75594  0.0015</span></span>
<span><span class="co">#&gt; dnr          0.51969  0.35757 -0.18113  1.22051  0.1461</span></span>
<span><span class="co">#&gt; preauto      0.39417  0.35936 -0.31017  1.09851  0.2727</span></span>
<span><span class="co">#&gt; ttt24        0.50469  0.38681 -0.25344  1.26283  0.1920</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; (Intercept)  0.36237 0.19404 0.6767</span></span>
<span><span class="co">#&gt; gp           2.96041 1.51394 5.7889</span></span>
<span><span class="co">#&gt; dnr          1.68151 0.83433 3.3889</span></span>
<span><span class="co">#&gt; preauto      1.48316 0.73332 2.9997</span></span>
<span><span class="co">#&gt; ttt24        1.65648 0.77612 3.5354</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="binomial-regression-ipcw-mediation-analysis">Binomial regression IPCW Mediation Analysis<a class="anchor" aria-label="anchor" href="#binomial-regression-ipcw-mediation-analysis"></a>
</h2>
<p>We first look at the probability of relapse at 50 months</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### binomial regression ###########################################################</span></span>
<span><span class="va">aaMss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/binreg.html">binreg</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">dnr.f0</span><span class="op">+</span><span class="va">dnr.f1</span><span class="op">+</span><span class="va">preauto</span><span class="op">+</span><span class="va">ttt24</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">wdata</span>,</span>
<span>        time<span class="op">=</span><span class="fl">50</span>,weights<span class="op">=</span><span class="va">wdata</span><span class="op">$</span><span class="va">weights</span>,cause<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aaMss</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400    194</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  200 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept) -0.535534  0.256218 -1.037712 -0.033356  0.0366</span></span>
<span><span class="co">#&gt; dnr.f01      0.375817  0.348618 -0.307462  1.059095  0.2810</span></span>
<span><span class="co">#&gt; dnr.f11      0.275383  0.071199  0.135836  0.414931  0.0001</span></span>
<span><span class="co">#&gt; preauto      0.588221  0.350437 -0.098624  1.275066  0.0932</span></span>
<span><span class="co">#&gt; ttt24        0.266179  0.363603 -0.446469  0.978827  0.4641</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; (Intercept)  0.58536 0.35426 0.9672</span></span>
<span><span class="co">#&gt; dnr.f01      1.45618 0.73531 2.8838</span></span>
<span><span class="co">#&gt; dnr.f11      1.31704 1.14549 1.5143</span></span>
<span><span class="co">#&gt; preauto      1.80078 0.90608 3.5789</span></span>
<span><span class="co">#&gt; ttt24        1.30497 0.63988 2.6613</span></span>
<span></span>
<span><span class="va">ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediatorSurv.html">mediatorSurv</a></span><span class="op">(</span><span class="va">aaMss</span>,<span class="va">fit</span>,data<span class="op">=</span><span class="va">dat</span>,wdata<span class="op">=</span><span class="va">wdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ll</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400    194</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  200 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept) -0.535534  0.254832 -1.034995 -0.036073  0.0356</span></span>
<span><span class="co">#&gt; dnr.f01      0.375817  0.317732 -0.246927  0.998560  0.2369</span></span>
<span><span class="co">#&gt; dnr.f11      0.275383  0.117175  0.045726  0.505041  0.0188</span></span>
<span><span class="co">#&gt; preauto      0.588221  0.346523 -0.090951  1.267394  0.0896</span></span>
<span><span class="co">#&gt; ttt24        0.266179  0.366361 -0.451875  0.984233  0.4675</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; (Intercept)  0.58536 0.35523 0.9646</span></span>
<span><span class="co">#&gt; dnr.f01      1.45618 0.78120 2.7144</span></span>
<span><span class="co">#&gt; dnr.f11      1.31704 1.04679 1.6571</span></span>
<span><span class="co">#&gt; preauto      1.80078 0.91306 3.5516</span></span>
<span><span class="co">#&gt; ttt24        1.30497 0.63643 2.6758</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">runb</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span> <span class="va">bll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediatorSurv.html">BootmediatorSurv</a></span><span class="op">(</span><span class="va">aaMss</span>,<span class="va">fit</span>,data<span class="op">=</span><span class="va">dat</span>,k.boot<span class="op">=</span><span class="va">k.boot</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bll</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<p>So the NDE is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1.40</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>0.72</mn><mo>,</mo><mn>2.76</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">1.40 (0.72,2.76)</annotation></semantics></math>
and the NIE is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1.32</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>1.05</mn><mo>,</mo><mn>1.66</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">1.32 (1.05,1.66)</annotation></semantics></math>.</p>
</div>
<div class="section level2">
<h2 id="mediation-analysis">Mediation Analysis<a class="anchor" aria-label="anchor" href="#mediation-analysis"></a>
</h2>
<p>We here also illustrate how to use the other models mentioned
above.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### lin-ying model ################################################################</span></span>
<span><span class="va">aaMss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aalenMets.html">aalenMets</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span><span class="op">/</span><span class="fl">100</span>,<span class="va">status</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span><span class="op">~</span><span class="va">dnr.f0</span><span class="op">+</span><span class="va">dnr.f1</span><span class="op">+</span><span class="va">preauto</span><span class="op">+</span><span class="va">ttt24</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">wdata</span>,</span>
<span>           weights<span class="op">=</span><span class="va">wdata</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span></span>
<span><span class="va">ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediatorSurv.html">mediatorSurv</a></span><span class="op">(</span><span class="va">aaMss</span>,<span class="va">fit</span>,data<span class="op">=</span><span class="va">dat</span>,wdata<span class="op">=</span><span class="va">wdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ll</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400    196</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;          Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; dnr.f01  1.169592  0.739323 -0.279454  2.618637  0.1137</span></span>
<span><span class="co">#&gt; dnr.f11  0.206757  0.131289 -0.050565  0.464078  0.1153</span></span>
<span><span class="co">#&gt; preauto  0.617537  0.504302 -0.370877  1.605950  0.2207</span></span>
<span><span class="co">#&gt; ttt24    0.457736  0.517822 -0.557175  1.472648  0.3767</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">runb</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span> <span class="va">bll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediatorSurv.html">BootmediatorSurv</a></span><span class="op">(</span><span class="va">aaMss</span>,<span class="va">fit</span>,data<span class="op">=</span><span class="va">dat</span>,k.boot<span class="op">=</span><span class="va">k.boot</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bll</span><span class="op">)</span><span class="op">}</span></span>
<span></span>
<span><span class="co">### cox model ###############################################################################</span></span>
<span><span class="va">aaMss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span><span class="op">~</span><span class="va">dnr.f0</span><span class="op">+</span><span class="va">dnr.f1</span><span class="op">+</span><span class="va">preauto</span><span class="op">+</span><span class="va">ttt24</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">wdata</span>,</span>
<span>           weights<span class="op">=</span><span class="va">wdata</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aaMss</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400    196</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;         Estimate     S.E.  dU^-1/2 P-value</span></span>
<span><span class="co">#&gt; dnr.f01 0.414565 0.213724 0.157231  0.0524</span></span>
<span><span class="co">#&gt; dnr.f11 0.100656 0.039308 0.144971  0.0104</span></span>
<span><span class="co">#&gt; preauto 0.284460 0.232166 0.162375  0.2205</span></span>
<span><span class="co">#&gt; ttt24   0.185561 0.226044 0.160886  0.4117</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;         Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; dnr.f01  1.51371 0.99568 2.3013</span></span>
<span><span class="co">#&gt; dnr.f11  1.10590 1.02389 1.1945</span></span>
<span><span class="co">#&gt; preauto  1.32904 0.84318 2.0949</span></span>
<span><span class="co">#&gt; ttt24    1.20389 0.77300 1.8750</span></span>
<span><span class="va">ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediatorSurv.html">mediatorSurv</a></span><span class="op">(</span><span class="va">aaMss</span>,<span class="va">fit</span>,data<span class="op">=</span><span class="va">dat</span>,wdata<span class="op">=</span><span class="va">wdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ll</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400    196</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;            Estimate     Std.Err        2.5%       97.5% P-value</span></span>
<span><span class="co">#&gt; dnr.f01  0.41456472  0.20869639  0.00552731  0.82360212  0.0470</span></span>
<span><span class="co">#&gt; dnr.f11  0.10065575  0.05121458  0.00027702  0.20103448  0.0494</span></span>
<span><span class="co">#&gt; preauto  0.28445952  0.23037280 -0.16706288  0.73598192  0.2169</span></span>
<span><span class="co">#&gt; ttt24    0.18556110  0.22549763 -0.25640614  0.62752835  0.4106</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;         Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; dnr.f01  1.51371 1.00554 2.2787</span></span>
<span><span class="co">#&gt; dnr.f11  1.10590 1.00028 1.2227</span></span>
<span><span class="co">#&gt; preauto  1.32904 0.84615 2.0875</span></span>
<span><span class="co">#&gt; ttt24    1.20389 0.77383 1.8730</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">runb</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span> <span class="va">bll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediatorSurv.html">BootmediatorSurv</a></span><span class="op">(</span><span class="va">aaMss</span>,<span class="va">fit</span>,data<span class="op">=</span><span class="va">dat</span>,k.boot<span class="op">=</span><span class="va">k.boot</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bll</span><span class="op">)</span><span class="op">}</span></span>
<span></span>
<span><span class="co">### Fine-Gray #############################################################3</span></span>
<span><span class="va">aaMss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cifreg.html">cifreg</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">dnr.f0</span><span class="op">+</span><span class="va">dnr.f1</span><span class="op">+</span><span class="va">preauto</span><span class="op">+</span><span class="va">ttt24</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">wdata</span>,</span>
<span>        weights<span class="op">=</span><span class="va">wdata</span><span class="op">$</span><span class="va">weights</span>,propodds<span class="op">=</span><span class="cn">NULL</span>,cause<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aaMss</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400    196</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  200 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;         Estimate    S.E. dU^-1/2 P-value</span></span>
<span><span class="co">#&gt; dnr.f01  0.18943 0.21986 0.15855  0.3889</span></span>
<span><span class="co">#&gt; dnr.f11  0.18730 0.04083 0.14503  0.0000</span></span>
<span><span class="co">#&gt; preauto  0.41452 0.22783 0.16098  0.0688</span></span>
<span><span class="co">#&gt; ttt24    0.17304 0.22892 0.16308  0.4497</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;         Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; dnr.f01  1.20856 0.78545 1.8596</span></span>
<span><span class="co">#&gt; dnr.f11  1.20599 1.11324 1.3065</span></span>
<span><span class="co">#&gt; preauto  1.51364 0.96849 2.3656</span></span>
<span><span class="co">#&gt; ttt24    1.18892 0.75910 1.8621</span></span>
<span><span class="va">ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediatorSurv.html">mediatorSurv</a></span><span class="op">(</span><span class="va">aaMss</span>,<span class="va">fit</span>,data<span class="op">=</span><span class="va">dat</span>,wdata<span class="op">=</span><span class="va">wdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ll</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400    196</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  200 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;          Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; dnr.f01  0.189426  0.233939 -0.269087  0.647939  0.4181</span></span>
<span><span class="co">#&gt; dnr.f11  0.187298  0.047733  0.093744  0.280853  0.0001</span></span>
<span><span class="co">#&gt; preauto  0.414517  0.230676 -0.037600  0.866634  0.0723</span></span>
<span><span class="co">#&gt; ttt24    0.173042  0.230810 -0.279338  0.625422  0.4534</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;         Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; dnr.f01  1.20856 0.76408 1.9116</span></span>
<span><span class="co">#&gt; dnr.f11  1.20599 1.09828 1.3243</span></span>
<span><span class="co">#&gt; preauto  1.51364 0.96310 2.3789</span></span>
<span><span class="co">#&gt; ttt24    1.18892 0.75628 1.8690</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">runb</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span> <span class="va">bll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediatorSurv.html">BootmediatorSurv</a></span><span class="op">(</span><span class="va">aaMss</span>,<span class="va">fit</span>,data<span class="op">=</span><span class="va">dat</span>,k.boot<span class="op">=</span><span class="va">k.boot</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bll</span><span class="op">)</span><span class="op">}</span></span>
<span></span>
<span><span class="co">### logit model  #############################################################3</span></span>
<span><span class="va">aaMss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cifreg.html">cifreg</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">dnr.f0</span><span class="op">+</span><span class="va">dnr.f1</span><span class="op">+</span><span class="va">preauto</span><span class="op">+</span><span class="va">ttt24</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">wdata</span>,</span>
<span>        weights<span class="op">=</span><span class="va">wdata</span><span class="op">$</span><span class="va">weights</span>,cause<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aaMss</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400    196</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  200 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;         Estimate     S.E.  dU^-1/2 P-value</span></span>
<span><span class="co">#&gt; dnr.f01 0.357168 0.339848 0.158937  0.2933</span></span>
<span><span class="co">#&gt; dnr.f11 0.272392 0.064166 0.145076  0.0000</span></span>
<span><span class="co">#&gt; preauto 0.657010 0.326082 0.160361  0.0439</span></span>
<span><span class="co">#&gt; ttt24   0.191333 0.353606 0.167443  0.5884</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;         Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; dnr.f01  1.42928 0.73424 2.7822</span></span>
<span><span class="co">#&gt; dnr.f11  1.31310 1.15792 1.4891</span></span>
<span><span class="co">#&gt; preauto  1.92902 1.01806 3.6551</span></span>
<span><span class="co">#&gt; ttt24    1.21086 0.60549 2.4215</span></span>
<span><span class="va">ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediatorSurv.html">mediatorSurv</a></span><span class="op">(</span><span class="va">aaMss</span>,<span class="va">fit</span>,data<span class="op">=</span><span class="va">dat</span>,wdata<span class="op">=</span><span class="va">wdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ll</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400    196</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  200 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;          Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; dnr.f01  0.357168  0.351089 -0.330953  1.045289  0.3090</span></span>
<span><span class="co">#&gt; dnr.f11  0.272392  0.068131  0.138857  0.405927  0.0001</span></span>
<span><span class="co">#&gt; preauto  0.657010  0.328207  0.013736  1.300284  0.0453</span></span>
<span><span class="co">#&gt; ttt24    0.191333  0.356086 -0.506583  0.889250  0.5910</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;         Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; dnr.f01  1.42928 0.71824 2.8442</span></span>
<span><span class="co">#&gt; dnr.f11  1.31310 1.14896 1.5007</span></span>
<span><span class="co">#&gt; preauto  1.92902 1.01383 3.6703</span></span>
<span><span class="co">#&gt; ttt24    1.21086 0.60255 2.4333</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">runb</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span> <span class="va">bll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediatorSurv.html">BootmediatorSurv</a></span><span class="op">(</span><span class="va">aaMss</span>,<span class="va">fit</span>,data<span class="op">=</span><span class="va">dat</span>,k.boot<span class="op">=</span><span class="va">k.boot</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bll</span><span class="op">)</span><span class="op">}</span></span>
<span></span>
<span><span class="co">### binomial outcome  ############################</span></span>
<span><span class="va">aaMss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/binreg.html">binreg</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">ftime</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">dnr.f0</span><span class="op">+</span><span class="va">dnr.f1</span><span class="op">+</span><span class="va">preauto</span><span class="op">+</span><span class="va">ttt24</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">wdata</span>,</span>
<span>        time<span class="op">=</span><span class="fl">50</span>,weights<span class="op">=</span><span class="va">wdata</span><span class="op">$</span><span class="va">weights</span>,cens.weights<span class="op">=</span><span class="fl">1</span>,cause<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aaMss</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400    196</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  200 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept) -0.674433  0.235285 -1.135583 -0.213284  0.0042</span></span>
<span><span class="co">#&gt; dnr.f01      0.221834  0.318264 -0.401952  0.845620  0.4858</span></span>
<span><span class="co">#&gt; dnr.f11      0.262722  0.060281  0.144572  0.380871  0.0000</span></span>
<span><span class="co">#&gt; preauto      0.578077  0.319091 -0.047331  1.203484  0.0700</span></span>
<span><span class="co">#&gt; ttt24        0.214442  0.328183 -0.428784  0.857669  0.5135</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; (Intercept)  0.50944 0.32123 0.8079</span></span>
<span><span class="co">#&gt; dnr.f01      1.24836 0.66901 2.3294</span></span>
<span><span class="co">#&gt; dnr.f11      1.30046 1.15555 1.4636</span></span>
<span><span class="co">#&gt; preauto      1.78261 0.95377 3.3317</span></span>
<span><span class="co">#&gt; ttt24        1.23917 0.65130 2.3577</span></span>
<span><span class="va">ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediatorSurv.html">mediatorSurv</a></span><span class="op">(</span><span class="va">aaMss</span>,<span class="va">fit</span>,data<span class="op">=</span><span class="va">dat</span>,wdata<span class="op">=</span><span class="va">wdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ll</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400    196</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  200 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept) -0.674433  0.235022 -1.135069 -0.213798  0.0041</span></span>
<span><span class="co">#&gt; dnr.f01      0.221834  0.286717 -0.340122  0.783789  0.4391</span></span>
<span><span class="co">#&gt; dnr.f11      0.262722  0.107508  0.052011  0.473432  0.0145</span></span>
<span><span class="co">#&gt; preauto      0.578077  0.315260 -0.039822  1.195975  0.0667</span></span>
<span><span class="co">#&gt; ttt24        0.214442  0.329107 -0.430596  0.859480  0.5147</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; (Intercept)  0.50944 0.32140 0.8075</span></span>
<span><span class="co">#&gt; dnr.f01      1.24836 0.71168 2.1898</span></span>
<span><span class="co">#&gt; dnr.f11      1.30046 1.05339 1.6055</span></span>
<span><span class="co">#&gt; preauto      1.78261 0.96096 3.3068</span></span>
<span><span class="co">#&gt; ttt24        1.23917 0.65012 2.3619</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">runb</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span> <span class="va">bll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediatorSurv.html">BootmediatorSurv</a></span><span class="op">(</span><span class="va">aaMss</span>,<span class="va">fit</span>,data<span class="op">=</span><span class="va">dat</span>,k.boot<span class="op">=</span><span class="va">k.boot</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bll</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="multinomial-regression">Multinomial regression<a class="anchor" aria-label="anchor" href="#multinomial-regression"></a>
</h2>
<p>Also works with mediator with more than two levels</p>
<ul>
<li>meditor: wmi in 4 categories</li>
<li>exposure: age in 4 categories</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kkholst.github.io/mets/" class="external-link">mets</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">tTRACE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dcut.html">dcut</a></span><span class="op">(</span><span class="va">tTRACE</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">.</span> </span>
<span></span>
<span><span class="va">weightmodel</span> <span class="op">&lt;-</span> <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlogit.html">mlogit</a></span><span class="op">(</span><span class="va">wmicat.4</span> <span class="op">~</span><span class="va">agecat.4</span><span class="op">+</span><span class="va">vf</span><span class="op">+</span><span class="va">chf</span>,data<span class="op">=</span><span class="va">tTRACE</span>,family<span class="op">=</span><span class="va">binomial</span><span class="op">)</span></span>
<span><span class="va">wdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/medweight.html">medweight</a></span><span class="op">(</span><span class="va">fit</span>,data<span class="op">=</span><span class="va">tTRACE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">aaMss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/binreg.html">binreg</a></span><span class="op">(</span><span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">agecat.40</span><span class="op">+</span> <span class="va">agecat.41</span><span class="op">+</span> <span class="va">vf</span><span class="op">+</span><span class="va">chf</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">wdata</span>,</span>
<span>        time<span class="op">=</span><span class="fl">7</span>,weights<span class="op">=</span><span class="va">wdata</span><span class="op">$</span><span class="va">weights</span>,cause<span class="op">=</span><span class="fl">9</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aaMss</span><span class="op">)</span></span>
<span><span class="va">MultMed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mediatorSurv.html">mediatorSurv</a></span><span class="op">(</span><span class="va">aaMss</span>,<span class="va">fit</span>,data<span class="op">=</span><span class="va">tTRACE</span>,wdata<span class="op">=</span><span class="va">wdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">MultMed</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">MultMed</span><span class="op">)</span></span>
<span><span class="co">#&gt;     n events</span></span>
<span><span class="co">#&gt;  4000   2016</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  1000 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;                       Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept)          -1.839306  0.174541 -2.181401 -1.497211  0.0000</span></span>
<span><span class="co">#&gt; agecat.40(60.1,68.6]  0.916646  0.223488  0.478618  1.354674  0.0000</span></span>
<span><span class="co">#&gt; agecat.40(68.6,75.6]  1.363830  0.222418  0.927898  1.799762  0.0000</span></span>
<span><span class="co">#&gt; agecat.40(75.6,96.3]  2.277415  0.249815  1.787786  2.767044  0.0000</span></span>
<span><span class="co">#&gt; agecat.41(60.1,68.6]  0.121100  0.053334  0.016567  0.225633  0.0232</span></span>
<span><span class="co">#&gt; agecat.41(68.6,75.6]  0.119374  0.053193  0.015118  0.223631  0.0248</span></span>
<span><span class="co">#&gt; agecat.41(75.6,96.3]  0.095356  0.053874 -0.010234  0.200947  0.0767</span></span>
<span><span class="co">#&gt; vf                    0.712461  0.293627  0.136962  1.287960  0.0152</span></span>
<span><span class="co">#&gt; chf                   1.166578  0.154721  0.863331  1.469825  0.0000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;                      Estimate    2.5%   97.5%</span></span>
<span><span class="co">#&gt; (Intercept)           0.15893 0.11288  0.2238</span></span>
<span><span class="co">#&gt; agecat.40(60.1,68.6]  2.50089 1.61384  3.8755</span></span>
<span><span class="co">#&gt; agecat.40(68.6,75.6]  3.91114 2.52919  6.0482</span></span>
<span><span class="co">#&gt; agecat.40(75.6,96.3]  9.75144 5.97621 15.9115</span></span>
<span><span class="co">#&gt; agecat.41(60.1,68.6]  1.12874 1.01671  1.2531</span></span>
<span><span class="co">#&gt; agecat.41(68.6,75.6]  1.12679 1.01523  1.2506</span></span>
<span><span class="co">#&gt; agecat.41(75.6,96.3]  1.10005 0.98982  1.2226</span></span>
<span><span class="co">#&gt; vf                    2.03900 1.14678  3.6254</span></span>
<span><span class="co">#&gt; chf                   3.21099 2.37105  4.3485</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sessioninfo">SessionInfo<a class="anchor" aria-label="anchor" href="#sessioninfo"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] mets_1.3.9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] cli_3.6.5              knitr_1.51             rlang_1.1.7           </span></span>
<span><span class="co">#&gt;  [4] xfun_0.55              textshaping_1.0.4      jsonlite_2.0.0        </span></span>
<span><span class="co">#&gt;  [7] listenv_0.10.0         future.apply_1.20.1    lava_1.8.2            </span></span>
<span><span class="co">#&gt; [10] htmltools_0.5.9        ragg_1.5.0             sass_0.4.10           </span></span>
<span><span class="co">#&gt; [13] rmarkdown_2.30         grid_4.5.2             evaluate_1.0.5        </span></span>
<span><span class="co">#&gt; [16] jquerylib_0.1.4        fastmap_1.2.0          numDeriv_2016.8-1.1   </span></span>
<span><span class="co">#&gt; [19] yaml_2.3.12            mvtnorm_1.3-3          lifecycle_1.0.5       </span></span>
<span><span class="co">#&gt; [22] timereg_2.0.7          compiler_4.5.2         codetools_0.2-20      </span></span>
<span><span class="co">#&gt; [25] fs_1.6.6               htmlwidgets_1.6.4      Rcpp_1.1.1            </span></span>
<span><span class="co">#&gt; [28] future_1.68.0          lattice_0.22-7         systemfonts_1.3.1     </span></span>
<span><span class="co">#&gt; [31] digest_0.6.39          R6_2.6.1               parallelly_1.46.1     </span></span>
<span><span class="co">#&gt; [34] parallel_4.5.2         splines_4.5.2          Matrix_1.7-4          </span></span>
<span><span class="co">#&gt; [37] bslib_0.9.0            tools_4.5.2            RcppArmadillo_15.2.3-1</span></span>
<span><span class="co">#&gt; [40] globals_0.18.0         survival_3.8-3         pkgdown_2.2.0         </span></span>
<span><span class="co">#&gt; [43] cachem_1.1.0           desc_1.4.3</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Klaus K. Holst, Thomas Scheike.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
