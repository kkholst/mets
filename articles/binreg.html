<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Binomial Regression for Survival and Competing Risks Data â€¢ mets</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Binomial Regression for Survival and Competing Risks Data">
<meta property="og:description" content="mets">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mets</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basic-dutils.html">dUtility data-frame manipulations</a>
    </li>
    <li>
      <a href="../articles/binomial-family.html">Analysis of multivariate binomial data: family analysis</a>
    </li>
    <li>
      <a href="../articles/binomial-twin.html">Analysis of bivariate binomial data: Twin analysis</a>
    </li>
    <li>
      <a href="../articles/binreg-TRS.html">Two-Stage Randomization for for Competing risks and Survival outcomes</a>
    </li>
    <li>
      <a href="../articles/binreg-ate.html">Average treatment effect (ATE) for Competing risks and binary outcomes</a>
    </li>
    <li>
      <a href="../articles/binreg.html">Binomial Regression for Survival and Competing Risks Data</a>
    </li>
    <li>
      <a href="../articles/cifreg.html">Cumulative Incidence Regression</a>
    </li>
    <li>
      <a href="../articles/glm-utility.html">GEE cluster standard errors and predictions for glm objects</a>
    </li>
    <li>
      <a href="../articles/haplo-discrete-ttp.html">Haplotype Discrete Survival Models</a>
    </li>
    <li>
      <a href="../articles/interval-discrete-survival.html">Discrete Interval Censored Survival Models</a>
    </li>
    <li>
      <a href="../articles/marginal-cox.html">Marginal modelling of clustered survival data</a>
    </li>
    <li>
      <a href="../articles/mediation-survival.html">Mediation Analysis for survival data</a>
    </li>
    <li>
      <a href="../articles/quantitative-twin.html">Twin models</a>
    </li>
    <li>
      <a href="../articles/recurrent-events.html">Recurrent events</a>
    </li>
    <li>
      <a href="../articles/rmst-ate.html">Average treatment effect (ATE) for Restricted mean survival and years lost of Competing risks</a>
    </li>
    <li>
      <a href="../articles/survival-ate.html">G-Computation or standardization for the Cox, Fine-Gray and binomial regression models for survival data</a>
    </li>
    <li>
      <a href="../articles/time-to-event-family-studies-arev.html">A practical guide to Human Genetics with Lifetime Data</a>
    </li>
    <li>
      <a href="../articles/twostage-survival.html">Analysis of multivariate survival data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kkholst/mets/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="binreg_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Binomial Regression for Survival and Competing Risks Data</h1>
                        <h4 data-toc-skip class="author">Klaus Holst &amp; Thomas Scheike</h4>
            
            <h4 data-toc-skip class="date">2023-11-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/kkholst/mets/blob/HEAD/vignettes/binreg.Rmd" class="external-link"><code>vignettes/binreg.Rmd</code></a></small>
      <div class="hidden name"><code>binreg.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="binomial-regression-for-censored-data">Binomial Regression for censored data<a class="anchor" aria-label="anchor" href="#binomial-regression-for-censored-data"></a>
</h2>
<p>The binreg function does direct binomial regression for one time-point, <span class="math inline">\(t\)</span>, fitting the model <span class="math display">\[\begin{align*}
P(T \leq t, \epsilon=1 | X )  &amp; = \mbox{expit}( X^T \beta) 
\end{align*}\]</span> the estimation is based on IPCW weighted EE <span class="math display">\[\begin{align*}
 U(\beta) = &amp;  X ( \Delta(t) I(T \leq t, \epsilon=1 )/G_c(T_i- \wedge t) - \mbox{expit}( X^T \beta)) = 0 
\end{align*}\]</span> for IPCW adjusted responses and with <span class="math inline">\(\Delta\)</span> indicator of death and <span class="math inline">\(G_c\)</span> censoring survival distribution. With <span class="math inline">\(\Delta(t) = I( C_i &gt; T_i \wedge t)\)</span>.</p>
<p>The function logitIPCW instead considers <span class="math display">\[\begin{align*}
 U(\beta) = &amp;  X  \Delta(t) /G_c(T_i- \wedge t) ( I(T \leq t, \epsilon=1 ) - \mbox{expit}( X^T \beta)) = 0.
\end{align*}\]</span> The two score equations are quite similar, and exactly the same when the censoring model is fully-nonparametric.</p>
<p>Additional functions logitATE, and binregATE computes the average treatment effect, the average effect on treated (ATT), and the average effect on non-treated (ATC). We demonstrate this in another vignette.</p>
<p>The function logitATE also works when there is no censoring and we thus have simple binary outcome.</p>
<p>Variance is based on sandwich formula with IPCW adjustment, and naive.var is variance under known censoring model. The influence functions are stored in the output.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kkholst.github.io/mets/" class="external-link">mets</a></span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>warn<span class="op">=</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span> <span class="co"># to control output in simulatins for p-values below.</span></span>
<span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">bmt</span><span class="op">)</span></span>
<span> <span class="va">bmt</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">bmt</span><span class="op">$</span><span class="va">time</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bmt</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">0.01</span></span>
<span> <span class="co"># logistic regresion with IPCW binomial regression </span></span>
<span> <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/binreg.html">binreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">cause</span><span class="op">)</span><span class="op">~</span><span class="va">tcell</span><span class="op">+</span><span class="va">platelet</span>,<span class="va">bmt</span>,time<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  408    160</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  408 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept) -0.178126  0.127204 -0.427442  0.071189  0.1614</span></span>
<span><span class="co">#&gt; tcell       -0.426691  0.348043 -1.108843  0.255460  0.2202</span></span>
<span><span class="co">#&gt; platelet    -0.441989  0.242406 -0.917095  0.033117  0.0683</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; (Intercept)  0.83684 0.65218 1.0738</span></span>
<span><span class="co">#&gt; tcell        0.65266 0.32994 1.2911</span></span>
<span><span class="co">#&gt; platelet     0.64276 0.39968 1.0337</span></span></code></pre></div>
<p>We can also compute predictions using the estimates</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">out</span>,<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>tcell<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,platelet<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;        pred         se     lower     upper</span></span>
<span><span class="co">#&gt; 1 0.3497553 0.04858060 0.2545373 0.4449732</span></span>
<span><span class="co">#&gt; 2 0.2598388 0.07039666 0.1218613 0.3978162</span></span></code></pre></div>
<p>Further the censoring model can depend on strata</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">outs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/binreg.html">binreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">cause</span><span class="op">)</span><span class="op">~</span><span class="va">tcell</span><span class="op">+</span><span class="va">platelet</span>,<span class="va">bmt</span>,time<span class="op">=</span><span class="fl">50</span>,cens.model<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">tcell</span>,<span class="va">platelet</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">outs</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  408    160</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  408 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept) -0.180697  0.127414 -0.430424  0.069030  0.1561</span></span>
<span><span class="co">#&gt; tcell       -0.365928  0.350632 -1.053154  0.321299  0.2967</span></span>
<span><span class="co">#&gt; platelet    -0.433494  0.240270 -0.904415  0.037428  0.0712</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; (Intercept)  0.83469 0.65023 1.0715</span></span>
<span><span class="co">#&gt; tcell        0.69355 0.34884 1.3789</span></span>
<span><span class="co">#&gt; platelet     0.64824 0.40478 1.0381</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="absolute-risk-differences-and-ratio">Absolute risk differences and ratio<a class="anchor" aria-label="anchor" href="#absolute-risk-differences-and-ratio"></a>
</h2>
<p>Now for illustrations I wish to consider the absolute risk difference depending on tcell</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">outs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/binreg.html">binreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">cause</span><span class="op">)</span><span class="op">~</span><span class="va">tcell</span>,<span class="va">bmt</span>,time<span class="op">=</span><span class="fl">50</span>,cens.model<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">tcell</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">outs</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  408    160</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  408 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;             Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept) -0.30054  0.11153 -0.51914 -0.08194  0.0070</span></span>
<span><span class="co">#&gt; tcell       -0.51741  0.33981 -1.18342  0.14860  0.1278</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; (Intercept)  0.74042 0.59503 0.9213</span></span>
<span><span class="co">#&gt; tcell        0.59606 0.30623 1.1602</span></span></code></pre></div>
<p>the risk difference is</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ps</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">outs</span>,<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>tcell<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ps</span></span>
<span><span class="co">#&gt;        pred         se     lower     upper</span></span>
<span><span class="co">#&gt; 1 0.4254253 0.02726306 0.3719897 0.4788609</span></span>
<span><span class="co">#&gt; 2 0.3061988 0.06819019 0.1725461 0.4398516</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">ps</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1192264</span></span></code></pre></div>
<p>Getting the standard errors are easy enough since the two-groups are independent. In the case where we in addition had adjusted for other covariates, however, we would need the to apply the delta-theorem thus using the relevant covariances along the lines of</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>tcell<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">outs</span>,<span class="va">dd</span><span class="op">)</span></span>
<span></span>
<span><span class="va">riskdifratio</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>,<span class="va">contrast</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="va">outs</span><span class="op">$</span><span class="va">coef</span> <span class="op">&lt;-</span> <span class="va">p</span></span>
<span>   <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">outs</span>,<span class="va">dd</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>   <span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">contrast</span><span class="op">*</span><span class="va">p</span><span class="op">)</span></span>
<span>   <span class="va">r1</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>   <span class="va">r2</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>   <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pd</span>,<span class="va">r1</span>,<span class="va">r2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span>     </span>
<span><span class="fu"><a href="https://kkholst.github.io/lava/reference/estimate.default.html" class="external-link">estimate</a></span><span class="op">(</span><span class="va">outs</span>,f<span class="op">=</span><span class="va">riskdifratio</span>,<span class="va">dd</span>,null<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Estimate Std.Err     2.5%  97.5% P-value</span></span>
<span><span class="co">#&gt; [p1]   0.1192 0.07344 -0.02471 0.2632 0.10448</span></span>
<span><span class="co">#&gt; [p2]   1.3894 0.32197  0.75833 2.0204 0.22652</span></span>
<span><span class="co">#&gt; [p3]   0.7197 0.16679  0.39284 1.0467 0.09291</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Null Hypothesis: </span></span>
<span><span class="co">#&gt;   [p1] = 0</span></span>
<span><span class="co">#&gt;   [p2] = 1</span></span>
<span><span class="co">#&gt;   [p3] = 1 </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; chisq = 12.0249, df = 3, p-value = 0.007298</span></span></code></pre></div>
<p>same as</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">prodlim</span><span class="op">)</span></span>
<span><span class="va">pl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/prodlim/man/prodlim.html" class="external-link">prodlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/prodlim/man/Hist.html" class="external-link">Hist</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">cause</span><span class="op">)</span><span class="op">~</span><span class="va">tcell</span>,<span class="va">bmt</span><span class="op">)</span></span>
<span><span class="va">spl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pl</span>,times<span class="op">=</span><span class="fl">50</span>,asMatrix<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">spl</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="augmenting-the-binomial-regression">Augmenting the Binomial Regression<a class="anchor" aria-label="anchor" href="#augmenting-the-binomial-regression"></a>
</h2>
<p>Rather than using a larger censoring model we can also compute an augmentation term and then fit the binomial regression model based on this augmentation term. Here we compute the augmentation based on stratified non-parametric estimates of <span class="math inline">\(F_1(t,S(X))\)</span>, where <span class="math inline">\(S(X)\)</span> gives strata based on <span class="math inline">\(X\)</span> as a working model.</p>
<p>Computes the augmentation term for each individual as well as the sum <span class="math display">\[\begin{align*}
 A &amp; = \int_0^t H(u,X) \frac{1}{S^*(u,s)} \frac{1}{G_c(u)} dM_c(u)
\end{align*}\]</span> with <span class="math display">\[\begin{align*}
 H(u,X) &amp; = F_1^*(t,S(X)) - F_1^*(u,S(X))
\end{align*}\]</span> using a KM for <span class="math inline">\(G_c(t)\)</span> and a working model for cumulative baseline related to <span class="math inline">\(F_1^*(t,s)\)</span> and <span class="math inline">\(s\)</span> is strata, <span class="math inline">\(S^*(t,s) = 1 - F_1^*(t,s) - F_2^*(t,s)\)</span>.</p>
<p>Standard errors computed under assumption of correct but estimated <span class="math inline">\(G_c(s)\)</span> model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">bmt</span><span class="op">)</span></span>
<span> <span class="fu"><a href="../reference/dcut.html">dcut</a></span><span class="op">(</span><span class="va">bmt</span>,breaks<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">age</span> </span>
<span> <span class="va">out1</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/BinAugmentCifstrata.html">BinAugmentCifstrata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">cause</span><span class="op">)</span><span class="op">~</span><span class="va">platelet</span><span class="op">+</span><span class="va">agecat.2</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">platelet</span>,<span class="va">agecat.2</span><span class="op">)</span>,data<span class="op">=</span><span class="va">bmt</span>,cause<span class="op">=</span><span class="fl">1</span>,time<span class="op">=</span><span class="fl">40</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  408    157</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  408 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;                      Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept)          -0.50047  0.17043 -0.83450 -0.16643  0.0033</span></span>
<span><span class="co">#&gt; platelet             -0.63482  0.23584 -1.09706 -0.17258  0.0071</span></span>
<span><span class="co">#&gt; agecat.2(0.203,1.94]  0.53812  0.21185  0.12291  0.95333  0.0111</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;                      Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; (Intercept)           0.60625 0.43409 0.8467</span></span>
<span><span class="co">#&gt; platelet              0.53003 0.33385 0.8415</span></span>
<span><span class="co">#&gt; agecat.2(0.203,1.94]  1.71279 1.13078 2.5943</span></span>
<span></span>
<span> <span class="va">out2</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/BinAugmentCifstrata.html">BinAugmentCifstrata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">cause</span><span class="op">)</span><span class="op">~</span><span class="va">platelet</span><span class="op">+</span><span class="va">agecat.2</span><span class="op">+</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">platelet</span>,<span class="va">agecat.2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="../reference/FG_AugmentCifstrata.html">strataC</a></span><span class="op">(</span><span class="va">platelet</span><span class="op">)</span>,data<span class="op">=</span><span class="va">bmt</span>,cause<span class="op">=</span><span class="fl">1</span>,time<span class="op">=</span><span class="fl">40</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  408    157</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  408 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;                      Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span><span class="co">#&gt; (Intercept)          -0.49984  0.17054 -0.83409 -0.16559  0.0034</span></span>
<span><span class="co">#&gt; platelet             -0.63650  0.23627 -1.09958 -0.17342  0.0071</span></span>
<span><span class="co">#&gt; agecat.2(0.203,1.94]  0.53709  0.21190  0.12177  0.95242  0.0113</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;                      Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; (Intercept)           0.60663 0.43427 0.8474</span></span>
<span><span class="co">#&gt; platelet              0.52914 0.33301 0.8408</span></span>
<span><span class="co">#&gt; agecat.2(0.203,1.94]  1.71103 1.12949 2.5920</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sessioninfo">SessionInfo<a class="anchor" aria-label="anchor" href="#sessioninfo"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.3.2 (2023-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 22.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] mets_1.3.3     timereg_2.0.5  survival_3.5-7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] Matrix_1.6-1.1      future.apply_1.11.0 jsonlite_1.8.7     </span></span>
<span><span class="co">#&gt;  [4] compiler_4.3.2      Rcpp_1.0.11         stringr_1.5.1      </span></span>
<span><span class="co">#&gt;  [7] parallel_4.3.2      jquerylib_0.1.4     globals_0.16.2     </span></span>
<span><span class="co">#&gt; [10] splines_4.3.2       systemfonts_1.0.5   textshaping_0.3.7  </span></span>
<span><span class="co">#&gt; [13] yaml_2.3.7          fastmap_1.1.1       lattice_0.21-9     </span></span>
<span><span class="co">#&gt; [16] R6_2.5.1            knitr_1.45          future_1.33.0      </span></span>
<span><span class="co">#&gt; [19] desc_1.4.2          rprojroot_2.0.4     bslib_0.6.0        </span></span>
<span><span class="co">#&gt; [22] rlang_1.1.2         cachem_1.0.8        stringi_1.8.2      </span></span>
<span><span class="co">#&gt; [25] xfun_0.41           fs_1.6.3            sass_0.4.7         </span></span>
<span><span class="co">#&gt; [28] memoise_2.0.1       cli_3.6.1           pkgdown_2.0.7      </span></span>
<span><span class="co">#&gt; [31] magrittr_2.0.3      digest_0.6.33       grid_4.3.2         </span></span>
<span><span class="co">#&gt; [34] mvtnorm_1.2-4       lifecycle_1.0.4     lava_1.7.3         </span></span>
<span><span class="co">#&gt; [37] vctrs_0.6.4         evaluate_0.23       glue_1.6.2         </span></span>
<span><span class="co">#&gt; [40] listenv_0.9.0       numDeriv_2016.8-1.1 codetools_0.2-19   </span></span>
<span><span class="co">#&gt; [43] ragg_1.2.6          parallelly_1.36.0   rmarkdown_2.25     </span></span>
<span><span class="co">#&gt; [46] purrr_1.0.2         tools_4.3.2         htmltools_0.5.7</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Klaus K. Holst, Thomas Scheike.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
