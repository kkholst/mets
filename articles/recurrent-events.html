<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recurrent events • mets</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Recurrent events">
<meta property="og:description" content="mets">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mets</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basic-dutils.html">dUtility data-frame manipulations</a>
    </li>
    <li>
      <a href="../articles/binomial-family.html">Analysis of multivariate binomial data: family analysis</a>
    </li>
    <li>
      <a href="../articles/binomial-twin.html">Analysis of bivariate binomial data: Twin analysis</a>
    </li>
    <li>
      <a href="../articles/binreg-ate.html">Average treatment effect (ATE) for Competing risks and binary outcomes</a>
    </li>
    <li>
      <a href="../articles/binreg.html">Binomial Regression for Survival and Competing Risks Data</a>
    </li>
    <li>
      <a href="../articles/cifreg.html">Cumulative Incidence Regression</a>
    </li>
    <li>
      <a href="../articles/haplo-discrete-ttp.html">Haplotype Discrete Survival Models</a>
    </li>
    <li>
      <a href="../articles/interval-discrete-survival.html">Discrete Interval Censored Survival Models</a>
    </li>
    <li>
      <a href="../articles/marginal-cox.html">Marginal modelling of clustered survival data</a>
    </li>
    <li>
      <a href="../articles/mediation-survival.html">Mediation Analysis for survival data</a>
    </li>
    <li>
      <a href="../articles/quantitative-twin.html">Twin models</a>
    </li>
    <li>
      <a href="../articles/recurrent-events.html">Recurrent events</a>
    </li>
    <li>
      <a href="../articles/rmst-ate.html">Average treatment effect (ATE) for Restricted mean survival and years lost of Competing risks</a>
    </li>
    <li>
      <a href="../articles/survival-ate.html">G-Computation or standardization for the Cox, Fine-Gray and binomial regression models for survival data</a>
    </li>
    <li>
      <a href="../articles/time-to-event-family-studies-arev.html">A practical guide to Human Genetics with Lifetime Data</a>
    </li>
    <li>
      <a href="../articles/twostage-survival.html">Analysis of multivariate survival data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kkholst/mets/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="recurrent-events_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Recurrent events</h1>
                        <h4 data-toc-skip class="author">Klaus Holst &amp; Thomas Scheike</h4>
            
            <h4 data-toc-skip class="date">2023-06-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/kkholst/mets/blob/HEAD/vignettes/recurrent-events.Rmd" class="external-link"><code>vignettes/recurrent-events.Rmd</code></a></small>
      <div class="hidden name"><code>recurrent-events.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>For recurrent events data it is often of interest to compute basic descriptive quantities to get some basic understanding of the phenonmenon studied. We here demonstrate how one can compute:</p>
<ul>
<li>the marginal mean
<ul>
<li>efficient marginal mean estimation</li>
</ul>
</li>
<li>the Ghosh-Lin Cox type regression for the marginal mean, possibly with composite outcomes.
<ul>
<li>efficient regression augmentation of the Ghosh-Lin model</li>
</ul>
</li>
<li>the variance of a recurrent events process</li>
<li>the probability of exceeding k events</li>
</ul>
<p>We also show how to improve the efficiency of recurrents events marginal mean.</p>
<p>In addition several tools can be used for simulating recurrent events and bivariate recurrent events data, also with a possible terminating event:</p>
<ul>
<li>recurrent events up to two causes and death, given rates of survivors and death on Cox form.
<ul>
<li>frailty extenstions</li>
</ul>
</li>
<li>the Ghosh-Lin model when the survival rate is on Cox form.
<ul>
<li>frailty extenstions</li>
</ul>
</li>
<li>The general illness death model with cox models for all hazards.</li>
</ul>
<p>For bivariate recurrent events we also compute summary measures that describe their dependence such as</p>
<ul>
<li>the covariance</li>
<li>directional dependence</li>
<li>the bivariate probability of exceeding <span class="math inline">\((k_1,k_2)\)</span> events</li>
</ul>
</div>
<div class="section level2">
<h2 id="simulation-of-recurrents-events">Simulation of recurrents events<a class="anchor" aria-label="anchor" href="#simulation-of-recurrents-events"></a>
</h2>
<p>We start by simulating some recurrent events data with two type of events with cumulative hazards</p>
<ul>
<li>
<span class="math inline">\(\Lambda_1(t)\)</span> (rate among survivors)</li>
<li>
<span class="math inline">\(\Lambda_2(t)\)</span> (rate among survivors)</li>
<li><span class="math inline">\(\Lambda_D(t)\)</span></li>
</ul>
<p>where we consider types 1 and 2 and with a rate of the terminal event given by <span class="math inline">\(\Lambda_D(t)\)</span>. We let the events be independent, but could also specify a random effects structure to generate dependence.</p>
<p>When simulating data we can impose various random-effects structures to generate dependence</p>
<ul>
<li><p>Dependence=0: The intensities can be independent.</p></li>
<li>
<p>Dependence=1: We can one gamma distributed random effects <span class="math inline">\(Z\)</span>. Then the intensities are</p>
<ul>
<li><span class="math inline">\(Z \lambda_1(t)\)</span></li>
<li><span class="math inline">\(Z \lambda_2(t)\)</span></li>
<li><span class="math inline">\(Z \lambda_D(t)\)</span></li>
</ul>
</li>
<li>
<p>Dependence=2: We can draw normally distributed random effects <span class="math inline">\(Z_1,Z_2,Z_d\)</span> were the variance (var.z) and correlation can be specified (cor.mat). Then the intensities are</p>
<ul>
<li><span class="math inline">\(\exp(Z_1) \lambda_1(t)\)</span></li>
<li><span class="math inline">\(\exp(Z_2) \lambda_2(t)\)</span></li>
<li><span class="math inline">\(\exp(Z_3) \lambda_D(t)\)</span></li>
</ul>
</li>
<li>
<p>Dependence=3: We can draw gamma distributed random effects <span class="math inline">\(Z_1,Z_2,Z_d\)</span> were the sum-structure can be speicifed via a matrix cor.mat. We compute <span class="math inline">\(\tilde Z_j = \sum_k Z_k^{cor.mat(j,k)}\)</span> for <span class="math inline">\(j=1,2,3\)</span>.<br>
Then the intensities are</p>
<ul>
<li><span class="math inline">\(\tilde Z_1 \lambda_1(t)\)</span></li>
<li><span class="math inline">\(\tilde Z_2 \lambda_2(t)\)</span></li>
<li><span class="math inline">\(\tilde Z_3 \lambda_D(t)\)</span></li>
</ul>
</li>
</ul>
<p>We return to how to run the different set-ups later and start by simulating independent processes.</p>
<p>The key functions are</p>
<ul>
<li>simRecurrent
<ul>
<li>simple simulation with only one event type and death</li>
</ul>
</li>
<li>simRecurrentII
<ul>
<li>extended version with possibly multiple types of recurrent events (but rates can be 0)</li>
<li>Allows Cox types rates with subject specific rates</li>
</ul>
</li>
</ul>
<p>In addition we can simulate data from the Ghosh-Lin model and where marginals of the rates among survivors are on on Cox form</p>
<ul>
<li>simGLcox
<ul>
<li>can simulate data from Ghosh-Lin model (also simRecurrentCox)</li>
<li>with frailties
<ul>
<li>where survival model for terminal event is on Cox form</li>
</ul>
</li>
<li>can simulate data where rates among survivors are are con Cox form
<ul>
<li>with frailties</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>see examples below for specific models.</p>
</div>
<div class="section level2">
<h2 id="utility-functions">Utility functions<a class="anchor" aria-label="anchor" href="#utility-functions"></a>
</h2>
<p>We here mention two utility functions</p>
<ul>
<li>tie.breaker for breaking ties among jump-times which is expected in the functions below.</li>
<li>count.history that counts the number of jumps previous for each subject that is <span class="math inline">\(N_1(t-)\)</span> and <span class="math inline">\(N_2(t-)\)</span>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="marginal-mean">Marginal Mean<a class="anchor" aria-label="anchor" href="#marginal-mean"></a>
</h2>
<p>We start by estimating the marginal mean <span class="math inline">\(E(N_1(t \wedge D))\)</span> where <span class="math inline">\(D\)</span> is the timing of the terminal event.</p>
<p>This is based on a rate model for</p>
<ul>
<li>the type 1 events <span class="math inline">\(\sim E(dN_1(t) | D &gt; t)\)</span>
</li>
<li>the terminal event <span class="math inline">\(\sim E(dN_d(t) | D &gt; t)\)</span>
</li>
</ul>
<p>and is defined as <span class="math inline">\(\mu_1(t)=E(N_1^*(t))\)</span> <span class="math display">\[\begin{align}
   \int_0^t S(u) d R_1(u)   
\end{align}\]</span> where <span class="math inline">\(S(t)=P(D \geq t)\)</span> and <span class="math inline">\(dR_1(t) = E(dN_1^*(t) | D &gt; t)\)</span></p>
<p>and can therefore be estimated by a</p>
<ul>
<li>Kaplan-Meier estimator, <span class="math inline">\(\hat S(u)\)</span>
</li>
<li>Nelson-Aalen estimator for <span class="math inline">\(R_1(t)\)</span>
</li>
</ul>
<p><span class="math display">\[\begin{align}
  \hat R_1(t) &amp; =   \sum_i \int_0^t  \frac{1}{Y_\bullet (s)}  dN_{1i}(s)
\end{align}\]</span> where <span class="math inline">\(Y_{\bullet}(t)= \sum_i Y_i(t)\)</span> such that the estimator is <span class="math display">\[\begin{align}
  \hat \mu_1(t) &amp; =    \int_0^t \hat S(u) d\hat R_1(u).
\end{align}\]</span></p>
<p>Cook &amp; Lawless (1997), and developed further in Gosh &amp; Lin (2000).</p>
<p>The variance can be estimated based on the asymptotic expansion of <span class="math inline">\(\hat \mu_1(t) - \mu_1(t)\)</span> <span class="math display">\[\begin{align*}
  &amp; \sum_i \int_0^t \frac{S(s)}{\pi(s)} dM_{i1}  - \mu_1(t) \int_0^t  \frac{1}{\pi(s)} dM_i^d +  \int_0^t \frac{\mu_1(s) }{\pi(s)} dM_i^d,
\end{align*}\]</span></p>
<p>with mean-zero processes</p>
<ul>
<li>
<span class="math inline">\(M_i^d(t) = N_i^D(t)- \int_0^t Y_i(s) d \Lambda^D(s)\)</span>,</li>
<li>
<span class="math inline">\(M_{i1}(t) = N_{i1}(t) - \int_0^t Y_{i}(s) dR_1(s)\)</span>.</li>
</ul>
<p>as in Gosh &amp; Lin (2000)</p>
</div>
<div class="section level2">
<h2 id="generating-data">Generating data<a class="anchor" aria-label="anchor" href="#generating-data"></a>
</h2>
<p>We start by generating some data to illustrate the computation of the marginal mean</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kkholst.github.io/mets/" class="external-link">mets</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/scheike/timereg" class="external-link">timereg</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span> <span class="co"># to control output in simulatins for p-values below.</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">base1cumhaz</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">base4cumhaz</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">drcumhaz</span><span class="op">)</span></span>
<span><span class="va">ddr</span> <span class="op">&lt;-</span> <span class="va">drcumhaz</span></span>
<span><span class="va">base1</span> <span class="op">&lt;-</span> <span class="va">base1cumhaz</span></span>
<span><span class="va">base4</span> <span class="op">&lt;-</span> <span class="va">base4cumhaz</span></span>
<span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simRecurrentII.html">simRecurrent</a></span><span class="op">(</span><span class="fl">200</span>,<span class="va">base1</span>,death.cumhaz<span class="op">=</span><span class="va">ddr</span><span class="op">)</span></span>
<span><span class="va">rr</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">rr</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">rr</span><span class="op">$</span><span class="va">strata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="op">(</span><span class="va">rr</span><span class="op">$</span><span class="va">id</span><span class="op">-</span><span class="fl">0.01</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dprint.html">dlist</a></span><span class="op">(</span><span class="va">rr</span>,<span class="va">.</span><span class="op">~</span><span class="va">id</span><span class="op">|</span> <span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">7</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; id: 1</span></span>
<span><span class="co">#&gt;     entry  time   status rr rr2 dtime fdeath death start  stop   x       strata</span></span>
<span><span class="co">#&gt; 1      0.0  451.1 1      1  1   3291  1      0        0.0  451.1  1.5212 0     </span></span>
<span><span class="co">#&gt; 201  451.1 2687.9 1      1  1   3291  1      0      451.1 2687.9  0.3290 0     </span></span>
<span><span class="co">#&gt; 337 2687.9 3290.8 0      1  1   3291  1      1     2687.9 3290.8 -0.4887 0     </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; id: 7</span></span>
<span><span class="co">#&gt;   entry time  status rr rr2 dtime fdeath death start stop  x        strata</span></span>
<span><span class="co">#&gt; 7 0     658.3 0      1  1   658.3 1      1     0     658.3 -0.04719 0     </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; id: 9</span></span>
<span><span class="co">#&gt;     entry time  status rr rr2 dtime fdeath death start stop  x       strata</span></span>
<span><span class="co">#&gt; 9     0.0 433.5 1      1  1   505.3 1      0       0.0 433.5 -0.3530 0     </span></span>
<span><span class="co">#&gt; 205 433.5 505.3 0      1  1   505.3 1      1     433.5 505.3  0.7694 0</span></span></code></pre></div>
<p>The status variable keeps track of the recurrent evnts and their type, and death the timing of death.</p>
<p>To compute the marginal mean we simly estimate the two rates functions of the number of events of interest and death by using the phreg function (to start without covariates). Then the estimates are combined with standard error computation in the recurrentMarginal function</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#  to fit non-parametric models with just a baseline </span></span>
<span><span class="va">xr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span></span>
<span><span class="va">dr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">death</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">dr</span>,se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"death"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">xr</span>,se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># robust standard errors </span></span>
<span><span class="va">rxr</span> <span class="op">&lt;-</span>   <span class="fu"><a href="../reference/phreg.html">robust.phreg</a></span><span class="op">(</span><span class="va">xr</span>,fixbeta<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">rxr</span>,se<span class="op">=</span><span class="cn">TRUE</span>,robust<span class="op">=</span><span class="cn">TRUE</span>,add<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># marginal mean of expected number of recurrent events </span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recurrentMarginal</a></span><span class="op">(</span><span class="va">xr</span>,<span class="va">dr</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">out</span>,se<span class="op">=</span><span class="cn">TRUE</span>,ylab<span class="op">=</span><span class="st">"marginal mean"</span>,col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-4-1.png" width="600px"></p>
<p>We can also extract the estimate in different time-points</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out</span>,times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>,<span class="fl">2000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   times mean   se-mean  CI-2.5% CI-97.5% strata</span></span>
<span><span class="co">#&gt; 1  1000 1.29 0.0989616 1.109913 1.499306      0</span></span>
<span><span class="co">#&gt; 2  2000 1.81 0.1381837 1.558450 2.102153      0</span></span></code></pre></div>
<p>The marginal mean can also be estimated in a stratified case:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">strata</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span></span>
<span><span class="va">dr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">death</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">strata</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">dr</span>,se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"death"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">xr</span>,se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">rxr</span> <span class="op">&lt;-</span>   <span class="fu"><a href="../reference/phreg.html">robust.phreg</a></span><span class="op">(</span><span class="va">xr</span>,fixbeta<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">rxr</span>,se<span class="op">=</span><span class="cn">TRUE</span>,robust<span class="op">=</span><span class="cn">TRUE</span>,add<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recurrentMarginal</a></span><span class="op">(</span><span class="va">xr</span>,<span class="va">dr</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">out</span>,se<span class="op">=</span><span class="cn">TRUE</span>,ylab<span class="op">=</span><span class="st">"marginal mean"</span>,col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-6-1.png" width="600px"></p>
<p>Further, if we adjust for covariates for the two rates we can still do predictions of marginal mean, what can be plotted is the baseline marginal mean, that is for the covariates equal to 0 for both models. Predictions for specific covariates can also be obtained with the recmarg (recurren marginal mean used solely for predictions without standard error computation).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cox case</span></span>
<span><span class="va">xr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">x</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span></span>
<span><span class="va">dr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">death</span><span class="op">)</span><span class="op">~</span><span class="va">x</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">dr</span>,se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"death"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">xr</span>,se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">rxr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">robust.phreg</a></span><span class="op">(</span><span class="va">xr</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">rxr</span>,se<span class="op">=</span><span class="cn">TRUE</span>,robust<span class="op">=</span><span class="cn">TRUE</span>,add<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recurrentMarginal</a></span><span class="op">(</span><span class="va">xr</span>,<span class="va">dr</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">out</span>,se<span class="op">=</span><span class="cn">TRUE</span>,ylab<span class="op">=</span><span class="st">"marginal mean"</span>,col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># predictions witout se's </span></span>
<span><span class="va">outX</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recmarg</a></span><span class="op">(</span><span class="va">xr</span>,<span class="va">dr</span>,Xr<span class="op">=</span><span class="fl">1</span>,Xd<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">outX</span>,add<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-7-1.png" width="600px"></p>
</div>
<div class="section level2">
<h2 id="improving-efficiency">Improving efficiency<a class="anchor" aria-label="anchor" href="#improving-efficiency"></a>
</h2>
<p>We now simulate some data where there is strong heterogenity such that we can improve the efficiency for censored survival data. The augmentation is a regression on the history for each subject consisting of the specified terms terms: Nt, Nt2 (Nt squared), expNt (exp(-Nt)), NtexpNt (Nt*exp(-Nt)) or by simply specifying these directly. This was developed in Cortese and Scheike (2022).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simRecurrentII.html">simRecurrentII</a></span><span class="op">(</span><span class="fl">200</span>,<span class="va">base1</span>,<span class="va">base4</span>,death.cumhaz<span class="op">=</span><span class="va">ddr</span>,cens<span class="op">=</span><span class="fl">3</span><span class="op">/</span><span class="fl">5000</span>,dependence<span class="op">=</span><span class="fl">4</span>,var.z<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">rr</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/count.history.html">count.history</a></span><span class="op">(</span><span class="va">rr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">rr</span>,statusD<span class="op">=</span><span class="va">status</span><span class="op">)</span></span>
<span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dtransform.html">dtransform</a></span><span class="op">(</span><span class="va">rr</span>,statusD<span class="op">=</span><span class="fl">3</span>,<span class="va">death</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dtable.html">dtable</a></span><span class="op">(</span><span class="va">rr</span>,<span class="op">~</span><span class="va">statusD</span><span class="op">+</span><span class="va">status</span><span class="op">+</span><span class="va">death</span>,level<span class="op">=</span><span class="fl">2</span>,response<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       statusD</span></span>
<span><span class="co">#&gt; status   0   1   2   3</span></span>
<span><span class="co">#&gt;      0  82   0   0 118</span></span>
<span><span class="co">#&gt;      1   0 243   0   0</span></span>
<span><span class="co">#&gt;      2   0   0  32   0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      statusD</span></span>
<span><span class="co">#&gt; death   0   1   2   3</span></span>
<span><span class="co">#&gt;     0  82 243  32   0</span></span>
<span><span class="co">#&gt;     1   0   0   0 118</span></span>
<span></span>
<span><span class="va">xr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">status</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span></span>
<span><span class="va">dr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">death</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span></span>
<span><span class="co"># marginal mean of expected number of recurrent events </span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recurrentMarginal</a></span><span class="op">(</span><span class="va">xr</span>,<span class="va">dr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fl">500</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">recEFF1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recurrentMarginalAIPCW</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusD</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span>,times<span class="op">=</span><span class="va">times</span>,cens.code<span class="op">=</span><span class="fl">0</span>,</span>
<span>                   death.code<span class="op">=</span><span class="fl">3</span>,cause<span class="op">=</span><span class="fl">1</span>,augment.model<span class="op">=</span><span class="op">~</span><span class="va">Nt</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span> <span class="va">recEFF1</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">times</span>,<span class="va">muP</span>,<span class="va">semuP</span>,<span class="va">muPAt</span>,<span class="va">semuPAt</span>,<span class="va">semuPAt</span><span class="op">/</span><span class="va">semuP</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       times       muP      semuP     muPAt    semuPAt          </span></span>
<span><span class="co">#&gt;  [1,]   500 0.7296607 0.08934148 0.7249944 0.08905594 0.9968040</span></span>
<span><span class="co">#&gt;  [2,]  1000 1.0253633 0.11701067 1.0152615 0.11651045 0.9957250</span></span>
<span><span class="co">#&gt;  [3,]  1500 1.2942861 0.15154426 1.2960853 0.15078170 0.9949681</span></span>
<span><span class="co">#&gt;  [4,]  2000 1.5821804 0.19166318 1.5505537 0.19135356 0.9983846</span></span>
<span><span class="co">#&gt;  [5,]  2500 1.7367039 0.20788926 1.6836330 0.20737040 0.9975041</span></span>
<span><span class="co">#&gt;  [6,]  3000 1.8824299 0.23035386 1.8141174 0.22956165 0.9965609</span></span>
<span><span class="co">#&gt;  [7,]  3500 2.0447577 0.26163802 1.9734070 0.25940041 0.9914477</span></span>
<span><span class="co">#&gt;  [8,]  4000 2.2148153 0.30878777 2.1219632 0.30363205 0.9833034</span></span>
<span><span class="co">#&gt;  [9,]  4500 2.2457349 0.32054957 2.1413394 0.31524586 0.9834543</span></span>
<span><span class="co">#&gt; [10,]  5000 2.2457349 0.32054957 2.1413394 0.31524586 0.9834543</span></span>
<span></span>
<span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fl">500</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">###recEFF14 &lt;- recurrentMarginalAIPCW(Event(start,stop,statusD)~cluster(id),data=rr,times=times,cens.code=0,</span></span>
<span><span class="co">###death.code=3,cause=1,augment.model=~Nt+Nt2+expNt+NtexpNt)</span></span>
<span><span class="co">###with(recEFF14,cbind(times,muP,semuP,muPAt,semuPAt,semuPAt/semuP))</span></span>
<span></span>
<span><span class="va">recEFF14</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recurrentMarginalAIPCW</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusD</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span>,times<span class="op">=</span><span class="va">times</span>,cens.code<span class="op">=</span><span class="fl">0</span>,</span>
<span>death.code<span class="op">=</span><span class="fl">3</span>,cause<span class="op">=</span><span class="fl">1</span>,augment.model<span class="op">=</span><span class="op">~</span><span class="va">Nt</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Nt</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">Nt</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span> <span class="va">Nt</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">Nt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">recEFF14</span>,<span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">times</span>,<span class="va">muP</span>,<span class="va">semuP</span>,<span class="va">muPAt</span>,<span class="va">semuPAt</span>,<span class="va">semuPAt</span><span class="op">/</span><span class="va">semuP</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       times       muP      semuP     muPAt    semuPAt          </span></span>
<span><span class="co">#&gt;  [1,]   500 0.7296607 0.08934148 0.7237379 0.08900176 0.9961975</span></span>
<span><span class="co">#&gt;  [2,]  1000 1.0253633 0.11701067 1.0161458 0.11620481 0.9931129</span></span>
<span><span class="co">#&gt;  [3,]  1500 1.2942861 0.15154426 1.2667555 0.15011448 0.9905653</span></span>
<span><span class="co">#&gt;  [4,]  2000 1.5821804 0.19166318 1.5082470 0.18777944 0.9797366</span></span>
<span><span class="co">#&gt;  [5,]  2500 1.7367039 0.20788926 1.6111245 0.20257313 0.9744281</span></span>
<span><span class="co">#&gt;  [6,]  3000 1.8824299 0.23035386 1.7159668 0.22374282 0.9713005</span></span>
<span><span class="co">#&gt;  [7,]  3500 2.0447577 0.26163802 1.8292428 0.25298091 0.9669119</span></span>
<span><span class="co">#&gt;  [8,]  4000 2.2148153 0.30878777 1.9265436 0.29398875 0.9520738</span></span>
<span><span class="co">#&gt;  [9,]  4500 2.2457349 0.32054957 1.9218467 0.30431466 0.9493529</span></span>
<span><span class="co">#&gt; [10,]  5000 2.2457349 0.32054957 1.9218467 0.30431466 0.9493529</span></span>
<span></span>
<span><span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">out</span>,se<span class="op">=</span><span class="cn">TRUE</span>,ylab<span class="op">=</span><span class="st">"marginal mean"</span>,col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="va">times</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ci1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">recEFF1</span><span class="op">$</span><span class="va">muPAt</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">recEFF1</span><span class="op">$</span><span class="va">semuPAt</span><span class="op">[</span><span class="va">k</span><span class="op">]</span>,</span>
<span>             <span class="va">recEFF1</span><span class="op">$</span><span class="va">muPAt</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="va">recEFF1</span><span class="op">$</span><span class="va">semuPAt</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">ci2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">recEFF1</span><span class="op">$</span><span class="va">muP</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">recEFF1</span><span class="op">$</span><span class="va">semuP</span><span class="op">[</span><span class="va">k</span><span class="op">]</span>,</span>
<span>             <span class="va">recEFF1</span><span class="op">$</span><span class="va">muP</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="va">recEFF1</span><span class="op">$</span><span class="va">semuP</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">t</span>,<span class="fl">2</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span>,<span class="va">ci2</span>,col<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">1</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">t</span>,<span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fl">2</span>,<span class="va">ci1</span>,col<span class="op">=</span><span class="fl">1</span>,lty<span class="op">=</span><span class="fl">1</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">k</span><span class="op">+</span><span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Eff-pred"</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-8-1.png" width="600px"></p>
<p>In the case where covariates might be important but we are still interested in the marginal mean we can also augment wrt these covariates</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span>,<span class="va">n</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"X"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="co">###</span></span>
<span><span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="op">-</span><span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="op">-</span><span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fz</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu">mets</span><span class="fu">:::</span><span class="fu">simGLcox</span><span class="op">(</span><span class="va">n</span>,<span class="va">base1</span>,<span class="va">ddr</span>,var.z<span class="op">=</span><span class="fl">0</span>,r1<span class="op">=</span><span class="va">r1</span>,rd<span class="op">=</span><span class="va">rd</span>,rc<span class="op">=</span><span class="va">rc</span>,<span class="va">fz</span>,model<span class="op">=</span><span class="st">"twostage"</span>,cens<span class="op">=</span><span class="fl">3</span><span class="op">/</span><span class="fl">5000</span><span class="op">)</span> </span>
<span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">rr</span>,<span class="va">X</span><span class="op">[</span><span class="va">rr</span><span class="op">$</span><span class="va">id</span><span class="op">+</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/dtable.html">dtable</a></span><span class="op">(</span><span class="va">rr</span>,<span class="op">~</span><span class="va">statusD</span><span class="op">+</span><span class="va">status</span><span class="op">+</span><span class="va">death</span>,level<span class="op">=</span><span class="fl">2</span>,response<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       statusD</span></span>
<span><span class="co">#&gt; status   0   1   3</span></span>
<span><span class="co">#&gt;      0  93   0 107</span></span>
<span><span class="co">#&gt;      1   0 802   0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      statusD</span></span>
<span><span class="co">#&gt; death   0   1   3</span></span>
<span><span class="co">#&gt;     0  93 476   0</span></span>
<span><span class="co">#&gt;     1   0 326 107</span></span>
<span></span>
<span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">5000</span>,by<span class="op">=</span><span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">recEFF1x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recurrentMarginalAIPCW</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusD</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span>,times<span class="op">=</span><span class="va">times</span>,</span>
<span>                   cens.code<span class="op">=</span><span class="fl">0</span>,death.code<span class="op">=</span><span class="fl">3</span>,cause<span class="op">=</span><span class="fl">1</span>,augment.model<span class="op">=</span><span class="op">~</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">recEFF1x</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">muP</span>,<span class="va">muPA</span>,<span class="va">muPAt</span>,<span class="va">semuP</span>,<span class="va">semuPA</span>,<span class="va">semuPAt</span>,<span class="va">semuPAt</span><span class="op">/</span><span class="va">semuP</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;             muP      muPA    muPAt     semuP    semuPA   semuPAt          </span></span>
<span><span class="co">#&gt;  [1,]  1.239629  1.226904 1.219113 0.1113222 0.1104686 0.1102564 0.9904262</span></span>
<span><span class="co">#&gt;  [2,]  2.260753  2.237327 2.218786 0.1888720 0.1856083 0.1850181 0.9795950</span></span>
<span><span class="co">#&gt;  [3,]  3.380778  3.284093 3.299408 0.3116231 0.2998621 0.2970862 0.9533513</span></span>
<span><span class="co">#&gt;  [4,]  4.715639  4.652729 4.588619 0.4959756 0.4640347 0.4579825 0.9233974</span></span>
<span><span class="co">#&gt;  [5,]  5.978661  5.817999 5.773031 0.6718212 0.6155609 0.6038833 0.8988751</span></span>
<span><span class="co">#&gt;  [6,]  7.029352  6.955265 6.802368 0.8586233 0.7963062 0.7710258 0.8979792</span></span>
<span><span class="co">#&gt;  [7,]  8.520280  8.217099 8.009947 1.2296894 1.0756621 1.0568620 0.8594544</span></span>
<span><span class="co">#&gt;  [8,]  9.780973  9.143637 8.813562 1.7113961 1.4189071 1.4040811 0.8204302</span></span>
<span><span class="co">#&gt;  [9,] 10.871472 10.357563 9.395688 2.1044673 1.7855074 1.6866794 0.8014757</span></span>
<span><span class="co">#&gt; [10,] 11.296956 10.735081 9.648354 2.2567311 1.8849404 1.7901175 0.7932347</span></span>
<span></span>
<span><span class="va">xr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">status</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span></span>
<span><span class="va">dr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">death</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recurrentMarginal</a></span><span class="op">(</span><span class="va">xr</span>,<span class="va">dr</span><span class="op">)</span></span>
<span><span class="fu">mets</span><span class="fu">::</span><span class="fu"><a href="../reference/prob.exceed.recurrent.html">summaryTimeobject</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">times</span>,<span class="va">out</span><span class="op">$</span><span class="va">mu</span>,times<span class="op">=</span><span class="va">times</span>,se.mu<span class="op">=</span><span class="va">out</span><span class="op">$</span><span class="va">se.mu</span><span class="op">)</span></span>
<span><span class="co">#&gt;    times      mean    se-mean   CI-2.5% CI-97.5%</span></span>
<span><span class="co">#&gt; 1    500 0.8806899 0.06519655 0.7617427 1.018211</span></span>
<span><span class="co">#&gt; 2   1000 1.2224722 0.10539353 1.0324110 1.447523</span></span>
<span><span class="co">#&gt; 3   1500 1.3702238 0.14414996 1.1149155 1.683996</span></span>
<span><span class="co">#&gt; 4   2000 1.4239958 0.17001617 1.1268827 1.799446</span></span>
<span><span class="co">#&gt; 5   2500 1.4334297 0.17708838 1.1251633 1.826153</span></span>
<span><span class="co">#&gt; 6   3000 1.4352968 0.17907319 1.1239334 1.832917</span></span>
<span><span class="co">#&gt; 7   3500 1.4359348 0.17990713 1.1232758 1.835621</span></span>
<span><span class="co">#&gt; 8   4000 1.4360308 0.18005391 1.1231443 1.836081</span></span>
<span><span class="co">#&gt; 9   4500 1.4360356 0.18006355 1.1231342 1.836110</span></span>
<span><span class="co">#&gt; 10  5000 1.4360358 0.18006394 1.1231338 1.836111</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="regression-models-for-the-marginal-mean">Regression models for the marginal mean<a class="anchor" aria-label="anchor" href="#regression-models-for-the-marginal-mean"></a>
</h2>
<p>One can also do regression modelling , using the model <span class="math display">\[\begin{align*}
E(N_1(t) | X) &amp;  = \Lambda_0(t)  \exp(X^T \beta)
\end{align*}\]</span> then Ghost-Lin suggested IPCW score equations that are implemented in the recreg function of mets.</p>
<p>First we generate data that from a Ghosh-Lin model with <span class="math inline">\(\beta=(-0.3,0.3)\)</span> and the baseline given by base1, this is done under the assumption that the death rate given covariates are on Cox form with baseline ddr:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span> <span class="va">out</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusD</span><span class="op">)</span><span class="op">~</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span>,cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">3</span>,cens.code<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span> <span class="va">outs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusD</span><span class="op">)</span><span class="op">~</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span>,cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">3</span>,cens.code<span class="op">=</span><span class="fl">0</span>,</span>
<span>        cens.model<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">X1</span>,<span class="va">X2</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span></span>
<span><span class="co">#&gt;      Estimate      S.E.    dU^-1/2      P-value</span></span>
<span><span class="co">#&gt; X1  0.6380200 0.2408892 0.07297799 0.0080825173</span></span>
<span><span class="co">#&gt; X2 -0.8184964 0.2342689 0.07671136 0.0004761393</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">outs</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span></span>
<span><span class="co">#&gt;      Estimate      S.E.    dU^-1/2      P-value</span></span>
<span><span class="co">#&gt; X1  0.4842323 0.2074928 0.07347288 1.960983e-02</span></span>
<span><span class="co">#&gt; X2 -0.9345854 0.2300951 0.07724723 4.870917e-05</span></span>
<span></span>
<span> <span class="co">## checking baseline</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span> <span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">outs</span>,add<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="../reference/recreg.html">scalecumhaz</a></span><span class="op">(</span><span class="va">base1</span>,<span class="fl">1</span><span class="op">)</span>,col<span class="op">=</span><span class="fl">3</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-10-1.png" width="600px"></p>
<p>We note that for the extended censoring model we gain a little efficiency and that the estimates are close to the true values.</p>
<p>Also possible to do IPCW regression at fixed time-point</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">outipcw</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recregIPCW</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusD</span><span class="op">)</span><span class="op">~</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span>,cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">3</span>,</span>
<span>            cens.code<span class="op">=</span><span class="fl">0</span>,times<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span>
<span> <span class="va">outipcws</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recregIPCW</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusD</span><span class="op">)</span><span class="op">~</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span>,cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">3</span>,</span>
<span>            cens.code<span class="op">=</span><span class="fl">0</span>,times<span class="op">=</span><span class="fl">2000</span>,cens.model<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">X1</span>,<span class="va">X2</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">outipcw</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span></span>
<span><span class="co">#&gt;               Estimate   Std.Err       2.5%       97.5%      P-value</span></span>
<span><span class="co">#&gt; (Intercept)  1.4116326 0.1829704  1.0530173  1.77024798 1.208981e-14</span></span>
<span><span class="co">#&gt; X1           0.6942164 0.2497149  0.2047843  1.18364856 5.435279e-03</span></span>
<span><span class="co">#&gt; X2          -0.5369772 0.2379153 -1.0032826 -0.07067177 2.400745e-02</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">outipcws</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span></span>
<span><span class="co">#&gt;               Estimate   Std.Err        2.5%      97.5%      P-value</span></span>
<span><span class="co">#&gt; (Intercept)  1.5931070 0.1555811  1.28817378  1.8980403 1.316116e-24</span></span>
<span><span class="co">#&gt; X1           0.4582230 0.1893324  0.08713836  0.8293075 1.551179e-02</span></span>
<span><span class="co">#&gt; X2          -0.7005233 0.1787626 -1.05089168 -0.3501550 8.901508e-05</span></span></code></pre></div>
<p>We can also do the Mao-Lin type composite outcome where we both count the cause 1 and deaths for example <span class="math display">\[\begin{align*}
E(N_1(t) + I(D&lt;t,\epsilon=3) | X) &amp;  = \Lambda_0(t)  \exp(X^T \beta)
\end{align*}\]</span></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">out</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusD</span><span class="op">)</span><span class="op">~</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span>,cause<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>        death.code<span class="op">=</span><span class="fl">3</span>,cens.code<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span></span>
<span><span class="co">#&gt;      Estimate      S.E.    dU^-1/2      P-value</span></span>
<span><span class="co">#&gt; X1  0.5913866 0.2047469 0.06814289 0.0038723340</span></span>
<span><span class="co">#&gt; X2 -0.7166796 0.1985950 0.07084952 0.0003076774</span></span></code></pre></div>
<p>Also demonstrate that this can be done with competing risks death (change some of the cause 3 deaths to cause 4) <span class="math display">\[\begin{align*}
E(w_1 N_1(t) + w_2 I(D&lt;t,\epsilon=3) | X) &amp;  = \Lambda_0(t)  \exp(X^T \beta)
\end{align*}\]</span> and with weights <span class="math inline">\(w_1,w_2\)</span> that follow the causes, here 1 and 3.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">rr</span><span class="op">$</span><span class="va">binf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">rr</span><span class="op">)</span>,<span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span> </span>
<span> <span class="va">rr</span><span class="op">$</span><span class="va">statusDC</span> <span class="op">&lt;-</span> <span class="va">rr</span><span class="op">$</span><span class="va">statusD</span></span>
<span> <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dtransform.html">dtransform</a></span><span class="op">(</span><span class="va">rr</span>,statusDC<span class="op">=</span><span class="fl">4</span>, <span class="va">statusD</span><span class="op">==</span><span class="fl">3</span> <span class="op">&amp;</span> <span class="va">binf</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span></span>
<span> <span class="va">rr</span><span class="op">$</span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span> <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dtransform.html">dtransform</a></span><span class="op">(</span><span class="va">rr</span>,weight<span class="op">=</span><span class="fl">2</span>,<span class="va">statusDC</span><span class="op">==</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span> <span class="va">outC</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusDC</span><span class="op">)</span><span class="op">~</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span>,cause<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>         death.code<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span>,cens.code<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">outC</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span></span>
<span><span class="co">#&gt;      Estimate      S.E.    dU^-1/2      P-value</span></span>
<span><span class="co">#&gt; X1  0.6096097 0.2211934 0.07037815 0.0058512503</span></span>
<span><span class="co">#&gt; X2 -0.7672723 0.2150622 0.07361544 0.0003601605</span></span>
<span></span>
<span> <span class="va">outCW</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusDC</span><span class="op">)</span><span class="op">~</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span>,cause<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>          death.code<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span>,cens.code<span class="op">=</span><span class="fl">0</span>,wcomp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">outCW</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span></span>
<span><span class="co">#&gt;      Estimate      S.E.    dU^-1/2     P-value</span></span>
<span><span class="co">#&gt; X1  0.5847914 0.2049969 0.06805083 0.004335170</span></span>
<span><span class="co">#&gt; X2 -0.7227776 0.1997827 0.07089222 0.000297095</span></span>
<span></span>
<span> <span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">out</span>,ylab<span class="op">=</span><span class="st">"Mean composite"</span><span class="op">)</span></span>
<span> <span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">outC</span>,col<span class="op">=</span><span class="fl">2</span>,add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span> <span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">outCW</span>,col<span class="op">=</span><span class="fl">3</span>,add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-13-1.png" width="600px"></p>
<p>Predictions and standard errors can be computed via the iid decompositions of the baseline and the regression coefficients. We illustrate this for the standard Ghosh-Lin model and it requires that the model is fitted with the option cox.prep=TRUE</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusD</span><span class="op">)</span><span class="op">~</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span>,cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">3</span>,</span>
<span>            cens.code<span class="op">=</span><span class="fl">0</span>,cox.prep<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">baseiid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cifreg.html">IIDbaseline.cifreg</a></span><span class="op">(</span><span class="va">out</span>,time<span class="op">=</span><span class="fl">3000</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/recreg.html">GLprediid</a></span><span class="op">(</span><span class="va">baseiid</span>,<span class="va">rr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;          pred    se-log    lower    upper</span></span>
<span><span class="co">#&gt; [1,] 3.032683 0.2376058 1.903604 4.831450</span></span>
<span><span class="co">#&gt; [2,] 3.032683 0.2376058 1.903604 4.831450</span></span>
<span><span class="co">#&gt; [3,] 3.032683 0.2376058 1.903604 4.831450</span></span>
<span><span class="co">#&gt; [4,] 6.875362 0.1785841 4.844896 9.756782</span></span>
<span><span class="co">#&gt; [5,] 6.875362 0.1785841 4.844896 9.756782</span></span></code></pre></div>
<p>The Ghosh-Lin model can be made more efficient by the regression augmentation method. First computing the augmentation and then in a second step the augmented estimator (Cortese and Scheike (2023)):</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">outi</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusD</span><span class="op">)</span><span class="op">~</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span>,cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">3</span>,cens.code<span class="op">=</span><span class="fl">0</span>,</span>
<span>        augment.model<span class="op">=</span><span class="op">~</span><span class="va">Nt</span><span class="op">+</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">outi</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span></span>
<span><span class="co">#&gt;      Estimate      S.E.    dU^-1/2      P-value</span></span>
<span><span class="co">#&gt; X1  0.6380200 0.2408892 0.07297799 0.0080825173</span></span>
<span><span class="co">#&gt; X2 -0.8184964 0.2342689 0.07671136 0.0004761393</span></span>
<span> <span class="va">outA</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusD</span><span class="op">)</span><span class="op">~</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span>,cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">3</span>,cens.code<span class="op">=</span><span class="fl">0</span>,</span>
<span>        augment.model<span class="op">=</span><span class="op">~</span><span class="va">Nt</span><span class="op">+</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span>,augment<span class="op">=</span><span class="va">outi</span><span class="op">$</span><span class="va">lindyn.augment</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">outA</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span></span>
<span><span class="co">#&gt;      Estimate      S.E.    dU^-1/2      P-value</span></span>
<span><span class="co">#&gt; X1  0.5364087 0.2149533 0.07220037 0.0125791499</span></span>
<span><span class="co">#&gt; X2 -0.7737024 0.2058243 0.07615310 0.0001705645</span></span></code></pre></div>
<p>We note that the simple augmentation improves the standard errors as expected. The data was generated assuming independence with previous number of events so it would suffice to augment only with the covariates.</p>
</div>
<div class="section level2">
<h2 id="simulations-with-specific-structure">Simulations with specific structure<a class="anchor" aria-label="anchor" href="#simulations-with-specific-structure"></a>
</h2>
<p>The function simGLcox can simulate data where the recurrent process has mean on Ghosh-Lin form. The key is that <span class="math display">\[\begin{align*}
E(N_1(t) | X) &amp;  = \Lambda_0(t)  \exp(X^T \beta) = \int_0^t S(t|X,Z) dR(t|X,Z)
\end{align*}\]</span> where <span class="math inline">\(Z\)</span> is a possible frailty. Therefore <span class="math display">\[\begin{align*}
 R(t|X,Z) &amp; = \frac{Z \Lambda_0(t)  \exp(X^T \beta) }{S(t|X,Z)}
\end{align*}\]</span> leads to a Ghosh-Lin model. We can choose the survival model to have Cox form among survivors by the option model=“twostage”, otherwise model=“frailty” uses the survival model with rate <span class="math inline">\(Z \lambda_d(t) rd\)</span>. The <span class="math inline">\(Z\)</span> is gamma distributed with a variance that can be specified. The simulations are based on a piecwise-linear approximation of the hazard functions for <span class="math inline">\(S(t|X,Z)\)</span> and <span class="math inline">\(R(t|X,Z)\)</span>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span>,<span class="va">n</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"X"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="co">###</span></span>
<span><span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="op">-</span><span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="op">-</span><span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu">mets</span><span class="fu">:::</span><span class="fu">simGLcox</span><span class="op">(</span><span class="va">n</span>,<span class="va">base1</span>,<span class="va">ddr</span>,var.z<span class="op">=</span><span class="fl">0</span>,r1<span class="op">=</span><span class="va">r1</span>,rd<span class="op">=</span><span class="va">rd</span>,rc<span class="op">=</span><span class="va">rc</span>,model<span class="op">=</span><span class="st">"twostage"</span>,cens<span class="op">=</span><span class="fl">3</span><span class="op">/</span><span class="fl">5000</span><span class="op">)</span> </span>
<span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">rr</span>,<span class="va">X</span><span class="op">[</span><span class="va">rr</span><span class="op">$</span><span class="va">id</span><span class="op">+</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>We can also simulate from models where the terminal event is on Cox form and the rate among survivors is on Cox form.</p>
<ul>
<li><span class="math inline">\(E(dN_1 | D&gt;t, X) = \lambda_1(t) r_1\)</span></li>
<li><span class="math inline">\(E(dN_d | D&gt;t, X) = \lambda_d(t) r_d\)</span></li>
</ul>
<p>underlying these models we have a shared frailty model</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu">mets</span><span class="fu">:::</span><span class="fu">simGLcox</span><span class="op">(</span><span class="fl">100</span>,<span class="va">base1</span>,<span class="va">ddr</span>,var.z<span class="op">=</span><span class="fl">1</span>,r1<span class="op">=</span><span class="va">r1</span>,rd<span class="op">=</span><span class="va">rd</span>,rc<span class="op">=</span><span class="va">rc</span>,type<span class="op">=</span><span class="fl">3</span>,cens<span class="op">=</span><span class="fl">3</span><span class="op">/</span><span class="fl">5000</span><span class="op">)</span> </span>
<span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">rr</span>,<span class="va">X</span><span class="op">[</span><span class="va">rr</span><span class="op">$</span><span class="va">id</span><span class="op">+</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">margsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusD</span><span class="op">==</span><span class="fl">3</span><span class="op">)</span><span class="op">~</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,<span class="va">rr</span><span class="op">)</span></span>
<span><span class="va">recurrent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusD</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">~</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,<span class="va">rr</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://kkholst.github.io/lava/reference/estimate.default.html" class="external-link">estimate</a></span><span class="op">(</span><span class="va">margsurv</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Estimate Std.Err    2.5%  97.5% P-value</span></span>
<span><span class="co">#&gt; X1   0.3264  0.3121 -0.2853 0.9380  0.2956</span></span>
<span><span class="co">#&gt; X2  -0.3840  0.2803 -0.9334 0.1653  0.1706</span></span>
<span><span class="fu"><a href="https://kkholst.github.io/lava/reference/estimate.default.html" class="external-link">estimate</a></span><span class="op">(</span><span class="va">recurrent</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Estimate Std.Err    2.5%    97.5% P-value</span></span>
<span><span class="co">#&gt; X1   0.3354  0.2556 -0.1655  0.83638 0.18937</span></span>
<span><span class="co">#&gt; X2  -0.5385  0.2443 -1.0173 -0.05976 0.02748</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>; </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">margsurv</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ddr</span>,col<span class="op">=</span><span class="fl">3</span><span class="op">)</span>; </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">recurrent</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">base1</span>,col<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-17-1.png" width="600px"></p>
</div>
<div class="section level2">
<h2 id="other-marginal-properties">Other marginal properties<a class="anchor" aria-label="anchor" href="#other-marginal-properties"></a>
</h2>
<p>The mean is a useful summary measure but it is very easy and useful to look at other simple summary measures such as the probability of exceeding <span class="math inline">\(k\)</span> events</p>
<ul>
<li>
<span class="math inline">\(P(N_1^*(t) \ge k)\)</span>
<ul>
<li>cumulative incidence of <span class="math inline">\(T_{k} = \inf \{ t: N_1^*(t)=k \}\)</span> with competing <span class="math inline">\(D\)</span>.</li>
</ul>
</li>
</ul>
<p>that is thus equivalent to a certain cumulative incidence of <span class="math inline">\(T_k\)</span> occurring before <span class="math inline">\(D\)</span>. We denote this cumulative incidence as <span class="math inline">\(\hat F_k(t)\)</span>.</p>
<p>We note also that <span class="math inline">\(N_1^*(t)^2\)</span> can be written as <span class="math display">\[\begin{align*}
   \sum_{k=0}^K  \int_0^t I(D &gt; s) I(N_1^*(s-)=k) f(k) dN_1^*(s)
\end{align*}\]</span> with <span class="math inline">\(f(k)=(k+1)^2 - k^2\)</span>, such that its mean can be written as <span class="math display">\[\begin{align*}
    \sum_{k=0}^K \int_0^t S(s) f(k) P(N_1^*(s-)= k  | D  \geq s) E( dN_1^*(s)  | N_1^*(s-)=k, D&gt; s) 
\end{align*}\]</span> and estimated by <span class="math display">\[\begin{align*}
\tilde \mu_{1,2}(t) &amp; = 
    \sum_{k=0}^K \int_0^t \hat S(s) f(k) 
    \frac{Y_{1\bullet}^k(s)}{Y_\bullet (s)} \frac{1}{Y_{1\bullet}^k(s)} d N_{1\bullet}^k(s)= \sum_{i=1}^n \int_0^t \hat S(s) f(N_{i1}(s-)) \frac{1}{Y_\bullet (s)} d N_{i1}(s),
\end{align*}\]</span> That is very similar to the “product-limit” estimator for <span class="math inline">\(E( (N_1^*(t))^2 )\)</span> <span class="math display">\[\begin{align}
  \hat \mu_{1,2}(t) &amp; =    \sum_{k=0}^K k^2 ( \hat F_{k}(t) - \hat F_{k+1}(t) ).
\end{align}\]</span></p>
<p>We use the esimator of the probabilty of exceeding “k” events based on the fact that <span class="math inline">\(I(N_1^*(t) \geq k)\)</span> is equivalent to <span class="math display">\[\begin{align*}
    \int_0^t I(D &gt; s) I(N_1^*(s-)=k-1) dN_1^*(s),
\end{align*}\]</span> suggesting that its mean can be computed as <span class="math display">\[\begin{align*}
\int_0^t S(s) P(N_1^*(s-)= k-1  | D  \geq s) E( dN_1^*(s)  | N_1^*(s-)=k-1, D&gt; s) 
\end{align*}\]</span> and estimated by <span class="math display">\[\begin{align*}
\tilde F_k(t) = \int_0^t \hat S(s)  \frac{Y_{1\bullet}^{k-1}(s)}{Y_\bullet (s)} 
            \frac{1}{Y_{1\bullet}^{k-1}(s)} d N_{1\bullet}^{k-1}(s).
\end{align*}\]</span></p>
<p>To compute these estimators we need to set up the data by computing the number of previous events of type “1” by the count.history function</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">###cor.mat &lt;- corM &lt;- rbind(c(1.0, 0.6, 0.9), c(0.6, 1.0, 0.5), c(0.9, 0.5, 1.0))</span></span>
<span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simRecurrentII.html">simRecurrentII</a></span><span class="op">(</span><span class="fl">200</span>,<span class="va">base1</span>,<span class="va">base4</span>,death.cumhaz<span class="op">=</span><span class="va">ddr</span>,cens<span class="op">=</span><span class="fl">3</span><span class="op">/</span><span class="fl">5000</span>,dependence<span class="op">=</span><span class="fl">4</span>,var.z<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">rr</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/count.history.html">count.history</a></span><span class="op">(</span><span class="va">rr</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dtable.html">dtable</a></span><span class="op">(</span><span class="va">rr</span>,<span class="op">~</span><span class="va">death</span><span class="op">+</span><span class="va">status</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       status   0   1   2</span></span>
<span><span class="co">#&gt; death                   </span></span>
<span><span class="co">#&gt; 0             90 368  43</span></span>
<span><span class="co">#&gt; 1            110   0   0</span></span>
<span></span>
<span><span class="va">oo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prob.exceed.recurrent.html">prob.exceedRecurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">oo</span><span class="op">)</span></span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-18-1.png" width="600px"></p>
<p>We can also look at the mean and variance based on the estimators just described</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">oo</span>,<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">mu</span>,col<span class="op">=</span><span class="fl">2</span>,type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">oo</span>,<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">varN</span>,type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-19-1.png" width="600px"></p>
<p>We could also use the product-limit estimator to estimate the probability of exceeding “k” events, and then standard errors are also returned:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">oop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prob.exceed.recurrent.html">prob.exceed.recurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span><span class="op">)</span></span>
<span> <span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">oo</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matlines</a></span><span class="op">(</span><span class="va">oop</span><span class="op">$</span><span class="va">times</span>,<span class="va">oop</span><span class="op">$</span><span class="va">prob</span>,type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-20-1.png" width="600px"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="../reference/prob.exceed.recurrent.html">summaryTimeobject</a></span><span class="op">(</span><span class="va">oop</span><span class="op">$</span><span class="va">times</span>,<span class="va">oop</span><span class="op">$</span><span class="va">prob</span>,se.mu<span class="op">=</span><span class="va">oop</span><span class="op">$</span><span class="va">se.prob</span>,times<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co">#&gt;            times       mean    se-mean     CI-2.5%   CI-97.5%</span></span>
<span><span class="co">#&gt; N=0         1000 0.46385701 0.03787037 0.395265371 0.54435158</span></span>
<span><span class="co">#&gt; exceed&gt;=1   1000 0.53614299 0.03787037 0.466826008 0.61575254</span></span>
<span><span class="co">#&gt; exceed&gt;=2   1000 0.30575221 0.03663381 0.241757931 0.38668603</span></span>
<span><span class="co">#&gt; exceed&gt;=3   1000 0.17846674 0.03022729 0.128051543 0.24873092</span></span>
<span><span class="co">#&gt; exceed&gt;=4   1000 0.12711946 0.02685561 0.084019777 0.19232802</span></span>
<span><span class="co">#&gt; exceed&gt;=5   1000 0.06909581 0.02038020 0.038759696 0.12317514</span></span>
<span><span class="co">#&gt; exceed&gt;=6   1000 0.04408730 0.01639583 0.021269164 0.09138536</span></span>
<span><span class="co">#&gt; exceed&gt;=7   1000 0.03794275 0.01521870 0.017286562 0.08328159</span></span>
<span><span class="co">#&gt; exceed&gt;=8   1000 0.03357182 0.01471191 0.014221739 0.07924960</span></span>
<span><span class="co">#&gt; exceed&gt;=9   1000 0.02094917 0.01193213 0.006860166 0.06397333</span></span>
<span><span class="co">#&gt; exceed&gt;=10  1000 0.02150929 0.01226103 0.007037254 0.06574293</span></span>
<span><span class="co">#&gt; exceed&gt;=11  1000 0.01460515 0.01024606 0.003692710 0.05776526</span></span>
<span><span class="co">#&gt; exceed&gt;=12  1000 0.01511065 0.01059225 0.003824701 0.05969923</span></span>
<span><span class="co">#&gt; exceed&gt;=13  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=14  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=15  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=16  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=17  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=18  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=19  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=20  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=21  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=22  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=23  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=24  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=25  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=26  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=27  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=28  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=29  1000 0.00000000 0.00000000         NaN        NaN</span></span>
<span><span class="co">#&gt; exceed&gt;=30  1000 0.00000000 0.00000000         NaN        NaN</span></span></code></pre></div>
<p>We note from the plot that the estimates are quite similar.</p>
<p>Finally, we make a plot with 95% confidence intervals</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">oop</span><span class="op">$</span><span class="va">times</span>,<span class="va">oop</span><span class="op">$</span><span class="va">prob</span>,type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">oop</span><span class="op">$</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span>    <span class="fu"><a href="../reference/basehazplot.phreg.html">plotConfRegion</a></span><span class="op">(</span><span class="va">oop</span><span class="op">$</span><span class="va">times</span>,<span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">oop</span><span class="op">$</span><span class="va">se.lower</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>,<span class="va">oop</span><span class="op">$</span><span class="va">se.upper</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="va">i</span><span class="op">)</span></span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-21-1.png" width="600px"></p>
</div>
<div class="section level2">
<h2 id="multiple-events">Multiple events<a class="anchor" aria-label="anchor" href="#multiple-events"></a>
</h2>
<p>We now generate recurrent events with two types of events. We start by generating data as before where all events are independent.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simRecurrentII.html">simRecurrentII</a></span><span class="op">(</span><span class="fl">200</span>,<span class="va">base1</span>,cumhaz2<span class="op">=</span><span class="va">base4</span>,death.cumhaz<span class="op">=</span><span class="va">ddr</span><span class="op">)</span></span>
<span><span class="va">rr</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/count.history.html">count.history</a></span><span class="op">(</span><span class="va">rr</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dtable.html">dtable</a></span><span class="op">(</span><span class="va">rr</span>,<span class="op">~</span><span class="va">death</span><span class="op">+</span><span class="va">status</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       status   0   1   2</span></span>
<span><span class="co">#&gt; death                   </span></span>
<span><span class="co">#&gt; 0             25 651  79</span></span>
<span><span class="co">#&gt; 1            175   0   0</span></span></code></pre></div>
<p>Based on this we can estimate also the joint distribution function, that is the probability that <span class="math inline">\((N_1(t) \geq k_1, N_2(t) \geq k_2)\)</span></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bivariate probability of exceeding </span></span>
<span><span class="va">oo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prob.exceed.recurrent.html">prob.exceedBiRecurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,exceed1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span>,exceed2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">oo</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">pe1e2</span>,type<span class="op">=</span><span class="st">"s"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">oo</span><span class="op">$</span><span class="va">pe1e2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">oo</span><span class="op">$</span><span class="va">pe1e2</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">nc</span>,col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">nc</span><span class="op">)</span></span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-23-1.png" width="600px"></p>
<div class="section level3">
<h3 id="dependence-between-events-covariance">Dependence between events: Covariance<a class="anchor" aria-label="anchor" href="#dependence-between-events-covariance"></a>
</h3>
<p>The dependence can also be summarised in other ways. For example by computing the covariance and comparing it to the covariance under the assumption of independence among survivors.</p>
<p>Covariance among two types of events <span class="math display">\[\begin{align}
\rho(t) &amp;  = \frac{ E(N_1^*(t) N_2^*(t) )  - \mu_1(t) \mu_2(t) }{ \mbox{sd}(N_1^*(t)) \mbox{sd}(N_2^*(t)) }
\end{align}\]</span> where <span class="math inline">\(E(N_1^*(t) N_2^*(t))\)</span> can be computed as <span class="math display">\[\begin{align*}
  E(N_1^*(t) N_2^*(t)) &amp;   = E( \int_0^t N_1^*(s-) dN_2^*(s) ) + E( \int_0^t N_2^*(s-) dN_1^*(s) ) 
\end{align*}\]</span></p>
<p>Recall that we might have a terminal event present such that we only see <span class="math inline">\(N_1^*(t \wedge D)\)</span> and <span class="math inline">\(N_2^*(t \wedge D)\)</span>.</p>
<p>To compute the covariance we thus compute <span class="math display">\[\begin{align*}
E(\int_0^t N_1^*(s-) dN_2^*(s) ) &amp; = \sum_k E( \int_0^t k I(N_1^*(s-)=k) I(D \geq s)  dN_2^*(s) ) 
\end{align*}\]</span> <span class="math display">\[\begin{align*}
= \sum_k \int_0^t S(s) k P(N_1^*(s-)= k  | D  \geq s) E( dN_2^*(s)  | N_1^*(s-)=k, D \geq s) 
\end{align*}\]</span> estimated by <span class="math display">\[\begin{align*}
  &amp; \sum_k \int_0^t \hat S(s) k \frac{Y_1^k(s)}{Y_\bullet (s)} \frac{1}{Y_1^k(s)} d \tilde N_{2,k}(s),
\end{align*}\]</span> * <span class="math inline">\(Y_j^k(t) = \sum Y_i(t) I( N_{ji}^*(s-)=k)\)</span> for <span class="math inline">\(j=1,2\)</span>, * <span class="math inline">\(\tilde N_{j,k}(t) = \sum_i \int_0^t I(N_{ij^o}(s-)=k) dN_{ij}(s)\)</span> * <span class="math inline">\(j^o\)</span> gives the other type so that <span class="math inline">\(1^o=2\)</span> and <span class="math inline">\(2^o=1\)</span>.</p>
<p>We thus estimate $ E(N_1^<em>(t) N_2^</em>(t))$ by <span class="math display">\[\begin{align*}
  \sum_k \int_0^t \hat S(s) k \frac{Y_1^k(s)}{Y_\bullet (s)} \frac{1}{Y_1^k(s)} d \tilde N_{2,k}(s) +
   \sum_k \int_0^t \hat S(s) k \frac{Y_2^k(s)}{Y_\bullet (s)} \frac{1}{Y_2^k(s)} d \tilde N_{1,k}(s).
\end{align*}\]</span></p>
<ul>
<li>Without terminating event covariance is a useful nonparametric measure.</li>
<li>With terminating event dependence can be generated terminating event.</li>
<li>In reality what is of interest would be independence among survivors that is if
<ul>
<li>
<span class="math inline">\(N_1\)</span> is not predicitive for <span class="math inline">\(N_2\)</span> <span class="math display">\[\begin{align}
 E( dN_2^*(t)  | N_1^*(t-)=k, D \geq t) =  E( dN_2^*(t)  | D \geq t) 
\end{align}\]</span>
</li>
<li>
<span class="math inline">\(N_2\)</span> is not predicitive for <span class="math inline">\(N_1\)</span> <span class="math display">\[\begin{align}
 E( dN_1^*(t)  | N_2^*(t-)=k, D \geq t) =  E( dN_1^*(t)  | D \geq t) 
\end{align}\]</span>
</li>
</ul>
</li>
</ul>
<p>If the two processes are independent among survivors then <span class="math display">\[\begin{align}
 E( dN_2^*(t)  | N_1^*(t-)=k, D \geq t) =  E( dN_2^*(t)  | D \geq t) 
\end{align}\]</span> so <span class="math display">\[\begin{align*}
  E( \int_0^t N_1^*(s-) dN_2^*(s) )  &amp; =  \int_0^t S(s) E(N_1^*(s-) | D  \geq s) E( dN_2^*(s)  | D \geq s) 
\end{align*}\]</span> and <span class="math display">\[\begin{align*}
  \int_0^t \hat S(s) \{  \sum_k k \frac{Y_1^k(s)}{Y_\bullet (s)} \} \frac{1}{Y_\bullet (s)} dN_{2\bullet}(s),
\end{align*}\]</span> where <span class="math inline">\(N_{j\bullet}(t) = \sum_i \int_0^t dN_{j,i}(s)\)</span>.</p>
<p>Under the independence <span class="math inline">\(E(N_1^*(t) N_2^*(t))\)</span> is estimated <span class="math display">\[\begin{align*}
  \int_0^t \hat S(s) \{  \sum_k k \frac{Y_1^k(s)}{Y_\bullet (s)} \} \frac{1}{Y_\bullet (s)} dN_{2\bullet}(s) 
    + \int_0^t \hat S(s) \{  \sum_k k \frac{Y_2^k(s)}{Y_\bullet (s)} \} \frac{1}{Y_\bullet (s)} dN_{1\bullet}(s).
\end{align*}\]</span></p>
<p>Both estimators, <span class="math inline">\(\hat E(N_1^*(t) N_2^*(t))\)</span> and <span class="math inline">\(\hat E_I(N_1^*(t) N_2^*(t))\)</span>, as well as <span class="math inline">\(\hat E(N_1^*(t))\)</span> and <span class="math inline">\(\hat E(N_2^*(t))\)</span>, have asymptotic expansions that can be written as a sum of iid processes, similarly to the arguments of Ghosh &amp; Lin 2000, <span class="math inline">\(\sum_i \Psi_i(t)\)</span>.<br>
We here, however, use a simple block bootstrap to get standard errors.</p>
<p>We can thus estimate the standard errors and of the estimators and their difference <span class="math inline">\(\hat E(N_1^*(t) N_2^*(t))- \hat E_I(N_1^*(t) N_2^*(t))\)</span>.</p>
<p>Note that we have terms for whether * <span class="math inline">\(N_1\)</span> is predicitive for <span class="math inline">\(N_2\)</span> * N1 -&gt; N2 : <span class="math inline">\(E( \int_0^t N_1^*(s-) dN_2^*(s) )\)</span> * this is equivalent to a weighted log-rank test * <span class="math inline">\(N_2\)</span> is predicitive for <span class="math inline">\(N_1\)</span> * N2 -&gt; N1 : <span class="math inline">\(E( \int_0^t N_2^*(s-) dN_1^*(s) )\)</span> * this is equivalent to a weighted log-rank test</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rr</span><span class="op">$</span><span class="va">strata</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="../reference/dtable.html">dtable</a></span><span class="op">(</span><span class="va">rr</span>,<span class="op">~</span><span class="va">death</span><span class="op">+</span><span class="va">status</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       status   0   1   2</span></span>
<span><span class="co">#&gt; death                   </span></span>
<span><span class="co">#&gt; 0             25 651  79</span></span>
<span><span class="co">#&gt; 1            175   0   0</span></span>
<span></span>
<span><span class="va">covrp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covarianceRecurrent.html">covarianceRecurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,status<span class="op">=</span><span class="st">"status"</span>,death<span class="op">=</span><span class="st">"death"</span>,</span>
<span>                        start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span>,id<span class="op">=</span><span class="st">"id"</span>,names.count<span class="op">=</span><span class="st">"Count"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">covrp</span><span class="op">)</span></span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-24-1.png" width="600px"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># with strata, each strata in matrix column, provides basis for fast Bootstrap</span></span>
<span><span class="va">covrpS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covarianceRecurrent.html">covarianceRecurrentS</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,status<span class="op">=</span><span class="st">"status"</span>,death<span class="op">=</span><span class="st">"death"</span>,</span>
<span>        start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span>,strata<span class="op">=</span><span class="st">"strata"</span>,id<span class="op">=</span><span class="st">"id"</span>,names.count<span class="op">=</span><span class="st">"Count"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bootstrap-standard-errors-for-terms">Bootstrap standard errors for terms<a class="anchor" aria-label="anchor" href="#bootstrap-standard-errors-for-terms"></a>
</h3>
<p>First fitting the model again to get our estimates of interst, and then computing them for some specific time-points</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">5000</span>,<span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coo1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covarianceRecurrent.html">covarianceRecurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,status<span class="op">=</span><span class="st">"status"</span>,start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="va">mug</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timereg/man/internal-addreg.html" class="external-link">Cpred</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">coo1</span><span class="op">$</span><span class="va">time</span>,<span class="va">coo1</span><span class="op">$</span><span class="va">EN1N2</span><span class="op">)</span>,<span class="va">times</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">mui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timereg/man/internal-addreg.html" class="external-link">Cpred</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">coo1</span><span class="op">$</span><span class="va">time</span>,<span class="va">coo1</span><span class="op">$</span><span class="va">EIN1N2</span><span class="op">)</span>,<span class="va">times</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">mu2.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timereg/man/internal-addreg.html" class="external-link">Cpred</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">coo1</span><span class="op">$</span><span class="va">time</span>,<span class="va">coo1</span><span class="op">$</span><span class="va">mu2.1</span><span class="op">)</span>,<span class="va">times</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">mu2.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timereg/man/internal-addreg.html" class="external-link">Cpred</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">coo1</span><span class="op">$</span><span class="va">time</span>,<span class="va">coo1</span><span class="op">$</span><span class="va">mu2.i</span><span class="op">)</span>,<span class="va">times</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">mu1.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timereg/man/internal-addreg.html" class="external-link">Cpred</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">coo1</span><span class="op">$</span><span class="va">time</span>,<span class="va">coo1</span><span class="op">$</span><span class="va">mu1.2</span><span class="op">)</span>,<span class="va">times</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">mu1.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timereg/man/internal-addreg.html" class="external-link">Cpred</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">coo1</span><span class="op">$</span><span class="va">time</span>,<span class="va">coo1</span><span class="op">$</span><span class="va">mu1.i</span><span class="op">)</span>,<span class="va">times</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">times</span>,<span class="va">mu2.1</span>,<span class="va">mu2.i</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">times</span>,<span class="va">mu1.2</span>,<span class="va">mu1.i</span><span class="op">)</span></span></code></pre></div>
<p>To get the bootstrap standard errors there is a quick memory demanding function (with S for speed and strata) BootcovariancerecurrenceS and slower function that goes through the loops in R Bootcovariancerecurrence.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covarianceRecurrent.html">BootcovariancerecurrenceS</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,status<span class="op">=</span><span class="st">"status"</span>,start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span>,K<span class="op">=</span><span class="fl">100</span>,times<span class="op">=</span><span class="va">times</span><span class="op">)</span></span>
<span><span class="co">#bt1 &lt;- Bootcovariancerecurrence(rr,1,2,status="status",start="entry",stop="time",K=K,times=times)</span></span>
<span></span>
<span><span class="va">BCoutput</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bt1<span class="op">=</span><span class="va">bt1</span>,mug<span class="op">=</span><span class="va">mug</span>,mui<span class="op">=</span><span class="va">mui</span>,</span>
<span>        bse.mug<span class="op">=</span><span class="va">bt1</span><span class="op">$</span><span class="va">se.mug</span>,bse.mui<span class="op">=</span><span class="va">bt1</span><span class="op">$</span><span class="va">se.mui</span>,</span>
<span>        dmugi<span class="op">=</span><span class="va">mug</span><span class="op">-</span><span class="va">mui</span>,</span>
<span>    bse.dmugi<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">bt1</span><span class="op">$</span><span class="va">EN1N2</span><span class="op">-</span><span class="va">bt1</span><span class="op">$</span><span class="va">EIN1N2</span>,<span class="fl">1</span>,<span class="va">sd</span><span class="op">)</span>,</span>
<span>    mu2.1 <span class="op">=</span> <span class="va">mu2.1</span> , mu2.i <span class="op">=</span> <span class="va">mu2.i</span> , dmu2.i<span class="op">=</span><span class="va">mu2.1</span><span class="op">-</span><span class="va">mu2.i</span>,</span>
<span>    mu1.2 <span class="op">=</span> <span class="va">mu1.2</span> , mu1.i <span class="op">=</span> <span class="va">mu1.i</span> , dmu1.i<span class="op">=</span><span class="va">mu1.2</span><span class="op">-</span><span class="va">mu1.i</span>,</span>
<span>    bse.mu2.1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">bt1</span><span class="op">$</span><span class="va">mu2.i</span>,<span class="fl">1</span>,<span class="va">sd</span><span class="op">)</span>, bse.mu2.1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">bt1</span><span class="op">$</span><span class="va">mu2.1</span>,<span class="fl">1</span>,<span class="va">sd</span><span class="op">)</span>,</span>
<span>    bse.dmu2.i<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">bt1</span><span class="op">$</span><span class="va">mu2.1</span><span class="op">-</span><span class="va">bt1</span><span class="op">$</span><span class="va">mu2.i</span>,<span class="fl">1</span>,<span class="va">sd</span><span class="op">)</span>,</span>
<span>    bse.mu1.2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">bt1</span><span class="op">$</span><span class="va">mu1.2</span>,<span class="fl">1</span>,<span class="va">sd</span><span class="op">)</span>, bse.mu1.i<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">bt1</span><span class="op">$</span><span class="va">mu1.i</span>,<span class="fl">1</span>,<span class="va">sd</span><span class="op">)</span>,</span>
<span>    bse.dmu1.i<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">bt1</span><span class="op">$</span><span class="va">mu1.2</span><span class="op">-</span><span class="va">bt1</span><span class="op">$</span><span class="va">mu1.i</span>,<span class="fl">1</span>,<span class="va">sd</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>We then look at the test for overall dependence in the different time-points. We here have no suggestion of dependence.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tt</span>  <span class="op">&lt;-</span> <span class="va">BCoutput</span><span class="op">$</span><span class="va">dmugi</span><span class="op">/</span><span class="va">BCoutput</span><span class="op">$</span><span class="va">bse.dmugi</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">times</span>,<span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can also take out the specific components for whether <span class="math inline">\(N_1\)</span> is predictive for <span class="math inline">\(N_2\)</span> and vice versa. We here have no suggestion of dependence.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t21</span>  <span class="op">&lt;-</span> <span class="va">BCoutput</span><span class="op">$</span><span class="va">dmu1.i</span><span class="op">/</span><span class="va">BCoutput</span><span class="op">$</span><span class="va">bse.dmu1.i</span> </span>
<span><span class="va">t12</span>  <span class="op">&lt;-</span> <span class="va">BCoutput</span><span class="op">$</span><span class="va">dmu2.i</span><span class="op">/</span><span class="va">BCoutput</span><span class="op">$</span><span class="va">bse.dmu2.i</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">times</span>,<span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">t21</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">t12</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We finally plot the boostrap samples</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">BCoutput</span><span class="op">$</span><span class="va">bt1</span><span class="op">$</span><span class="va">time</span>,<span class="va">BCoutput</span><span class="op">$</span><span class="va">bt1</span><span class="op">$</span><span class="va">EN1N2</span>,type<span class="op">=</span><span class="st">"l"</span>,lwd<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">BCoutput</span><span class="op">$</span><span class="va">bt1</span><span class="op">$</span><span class="va">time</span>,<span class="va">BCoutput</span><span class="op">$</span><span class="va">bt1</span><span class="op">$</span><span class="va">EIN1N2</span>,type<span class="op">=</span><span class="st">"l"</span>,lwd<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="looking-at-other-simulations-with-dependence">Looking at other simulations with dependence<a class="anchor" aria-label="anchor" href="#looking-at-other-simulations-with-dependence"></a>
</h2>
<p>Using the normally distributed random effects we plot 4 different settings. We have variance <span class="math inline">\(0.5\)</span> for all random effects and change the correlation. We let the correlation between the random effect associated with <span class="math inline">\(N_1\)</span> and <span class="math inline">\(N_2\)</span> be denoted <span class="math inline">\(\rho_{12}\)</span> and the correlation between the random effects associated between <span class="math inline">\(N_j\)</span> and <span class="math inline">\(D\)</span> the terminal event be denoted as <span class="math inline">\(\rho_{j3}\)</span>, and organize all correlation in a vector <span class="math inline">\(\rho=(\rho_{12},\rho_{13},\rho_{23})\)</span>.</p>
<ul>
<li>Scenario I <span class="math inline">\(\rho=(0,0.0,0.0)\)</span> Independence among all efects.</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">base1cumhaz</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">base4cumhaz</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">drcumhaz</span><span class="op">)</span></span>
<span>  <span class="va">dr</span> <span class="op">&lt;-</span> <span class="va">drcumhaz</span></span>
<span>  <span class="va">base1</span> <span class="op">&lt;-</span> <span class="va">base1cumhaz</span></span>
<span>  <span class="va">base4</span> <span class="op">&lt;-</span> <span class="va">base4cumhaz</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">var.z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="co"># death related to  both causes in same way </span></span>
<span>  <span class="va">cor.mat</span> <span class="op">&lt;-</span> <span class="va">corM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">1.0</span>, <span class="fl">0.0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simRecurrentII.html">simRecurrentII</a></span><span class="op">(</span><span class="fl">200</span>,<span class="va">base1</span>,<span class="va">base4</span>,death.cumhaz<span class="op">=</span><span class="va">dr</span>,var.z<span class="op">=</span><span class="va">var.z</span>,cor.mat<span class="op">=</span><span class="va">cor.mat</span>,dependence<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/count.history.html">count.history</a></span><span class="op">(</span><span class="va">rr</span>,types<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">rr</span>,<span class="st">"z"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">coo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covarianceRecurrent.html">covarianceRecurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,status<span class="op">=</span><span class="st">"status"</span>,start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">coo</span>,main <span class="op">=</span><span class="st">"Scenario I"</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Scenario II <span class="math inline">\(\rho=(0,0.5,0.5)\)</span> Independence among survivors but dependence on terminal event</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">var.z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="co"># death related to  both causes in same way </span></span>
<span>  <span class="va">cor.mat</span> <span class="op">&lt;-</span> <span class="va">corM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">0.0</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">1.0</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simRecurrentII.html">simRecurrentII</a></span><span class="op">(</span><span class="fl">200</span>,<span class="va">base1</span>,<span class="va">base4</span>,death.cumhaz<span class="op">=</span><span class="va">dr</span>,var.z<span class="op">=</span><span class="va">var.z</span>,cor.mat<span class="op">=</span><span class="va">cor.mat</span>,dependence<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/count.history.html">count.history</a></span><span class="op">(</span><span class="va">rr</span>,types<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">coo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covarianceRecurrent.html">covarianceRecurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,status<span class="op">=</span><span class="st">"status"</span>,start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">coo</span>,main <span class="op">=</span><span class="st">"Scenario II"</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Scenario III <span class="math inline">\(\rho=(0.5,0.5,0.5)\)</span> Positive dependence among survivors and dependence on terminal event</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">var.z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="co"># positive dependence for N1 and N2 all related in same way</span></span>
<span>  <span class="va">cor.mat</span> <span class="op">&lt;-</span> <span class="va">corM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simRecurrentII.html">simRecurrentII</a></span><span class="op">(</span><span class="fl">200</span>,<span class="va">base1</span>,<span class="va">base4</span>,death.cumhaz<span class="op">=</span><span class="va">dr</span>,var.z<span class="op">=</span><span class="va">var.z</span>,cor.mat<span class="op">=</span><span class="va">cor.mat</span>,dependence<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/count.history.html">count.history</a></span><span class="op">(</span><span class="va">rr</span>,types<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">coo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covarianceRecurrent.html">covarianceRecurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,status<span class="op">=</span><span class="st">"status"</span>,start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">coo</span>,main<span class="op">=</span><span class="st">"Scenario III"</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Scenario IV <span class="math inline">\(\rho=(-0.4,0.5,0.5)\)</span> Negative dependence among survivors and positive dependence on terminal event</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">var.z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="co"># negative dependence for N1 and N2 all related in same way</span></span>
<span>  <span class="va">cor.mat</span> <span class="op">&lt;-</span> <span class="va">corM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.4</span>, <span class="fl">1.0</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simRecurrentII.html">simRecurrentII</a></span><span class="op">(</span><span class="fl">200</span>,<span class="va">base1</span>,<span class="va">base4</span>,death.cumhaz<span class="op">=</span><span class="va">dr</span>,var.z<span class="op">=</span><span class="va">var.z</span>,cor.mat<span class="op">=</span><span class="va">cor.mat</span>,dependence<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/count.history.html">count.history</a></span><span class="op">(</span><span class="va">rr</span>,types<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">coo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covarianceRecurrent.html">covarianceRecurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,status<span class="op">=</span><span class="st">"status"</span>,start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">coo</span>,main<span class="op">=</span><span class="st">"Scenario IV"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sessioninfo">SessionInfo<a class="anchor" aria-label="anchor" href="#sessioninfo"></a>
</h2>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.3.1 (2023-06-16)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 22.04.2 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] mets_1.3.3     timereg_2.0.5  survival_3.5-5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] Matrix_1.5-4.1      future.apply_1.11.0 jsonlite_1.8.5     </span></span>
<span><span class="co">#&gt;  [4] highr_0.10          compiler_4.3.1      Rcpp_1.0.10        </span></span>
<span><span class="co">#&gt;  [7] stringr_1.5.0       parallel_4.3.1      jquerylib_0.1.4    </span></span>
<span><span class="co">#&gt; [10] globals_0.16.2      splines_4.3.1       systemfonts_1.0.4  </span></span>
<span><span class="co">#&gt; [13] textshaping_0.3.6   yaml_2.3.7          fastmap_1.1.1      </span></span>
<span><span class="co">#&gt; [16] lattice_0.21-8      R6_2.5.1            knitr_1.43         </span></span>
<span><span class="co">#&gt; [19] future_1.32.0       desc_1.4.2          rprojroot_2.0.3    </span></span>
<span><span class="co">#&gt; [22] bslib_0.5.0         rlang_1.1.1         cachem_1.0.8       </span></span>
<span><span class="co">#&gt; [25] stringi_1.7.12      xfun_0.39           fs_1.6.2           </span></span>
<span><span class="co">#&gt; [28] sass_0.4.6          memoise_2.0.1       cli_3.6.1          </span></span>
<span><span class="co">#&gt; [31] pkgdown_2.0.7       magrittr_2.0.3      digest_0.6.31      </span></span>
<span><span class="co">#&gt; [34] grid_4.3.1          mvtnorm_1.2-2       lifecycle_1.0.3    </span></span>
<span><span class="co">#&gt; [37] lava_1.7.2.1        vctrs_0.6.3         evaluate_0.21      </span></span>
<span><span class="co">#&gt; [40] glue_1.6.2          listenv_0.9.0       numDeriv_2016.8-1.1</span></span>
<span><span class="co">#&gt; [43] codetools_0.2-19    ragg_1.2.5          parallelly_1.36.0  </span></span>
<span><span class="co">#&gt; [46] rmarkdown_2.22      purrr_1.0.1         tools_4.3.1        </span></span>
<span><span class="co">#&gt; [49] htmltools_0.5.5</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Klaus K. Holst, Thomas Scheike.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
