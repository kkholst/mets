<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recurrent events • mets</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Recurrent events">
<meta property="og:description" content="mets">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mets</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basic-dutils.html">dUtility data-frame manipulations</a>
    </li>
    <li>
      <a href="../articles/binomial-family.html">Analysis of multivariate binomial data: family analysis</a>
    </li>
    <li>
      <a href="../articles/binomial-twin.html">Analysis of bivariate binomial data: Twin analysis</a>
    </li>
    <li>
      <a href="../articles/binreg-ate.html">Average treatment effect (ATE) for Competing risks and binary outcomes</a>
    </li>
    <li>
      <a href="../articles/binreg.html">Binomial Regression</a>
    </li>
    <li>
      <a href="../articles/cifreg.html">Cumulative Incidence Regression</a>
    </li>
    <li>
      <a href="../articles/haplo-discrete-ttp.html">Haplotype Discrete Survival Models</a>
    </li>
    <li>
      <a href="../articles/interval-discrete-survival.html">Discrete Interval Censored Survival Models</a>
    </li>
    <li>
      <a href="../articles/marginal-cox.html">Marginal modelling of clustered survival data</a>
    </li>
    <li>
      <a href="../articles/quantitative-twin.html">Twin models</a>
    </li>
    <li>
      <a href="../articles/recurrent-events.html">Recurrent events</a>
    </li>
    <li>
      <a href="../articles/time-to-event-family-studies-arev.html">A practical guide to Human Genetics with Lifetime Data</a>
    </li>
    <li>
      <a href="../articles/twostage-survival.html">Analysis of multivariate survival data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kkholst/mets/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Recurrent events</h1>
                        <h4 class="author">Klaus Holst &amp; Thomas Scheike</h4>
            
            <h4 class="date">2021-09-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/kkholst/mets/blob/master/vignettes/recurrent-events.Rmd"><code>vignettes/recurrent-events.Rmd</code></a></small>
      <div class="hidden name"><code>recurrent-events.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>For recurrent events data it is often of interest to compute basic descriptive quantities as a first go at getting some basic understanding of the phenonmenon studied. We here demonstrate how one can compute</p>
<ul>
<li>the marginal mean</li>
<li>the variance</li>
<li>the probability of exceeding k events</li>
<li>do a Cox type regression for the marginal mean</li>
</ul>
<p>In addition several tools can be used for simulating recurrent events and bivariate recurrent events data, in the case with a possible terminating event.</p>
<p>For bivariate recurrent events we also compute summary measures that describe their dependence such as</p>
<ul>
<li>the covariance</li>
<li>directional dependence</li>
<li>the bivariate probability of exceeding <span class="math inline">\((k_1,k_2)\)</span> events</li>
</ul>
<p>We also show how to improve the efficiency of recurrents events marginal mean.</p>
</div>
<div id="simulation-of-recurrents-events" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation-of-recurrents-events" class="anchor"></a>Simulation of recurrents events</h1>
<p>We start by simulating some recurrent events data with two type of events with cumulative hazards</p>
<ul>
<li>
<span class="math inline">\(\Lambda_1(t)\)</span> (rate among survivors)</li>
<li>
<span class="math inline">\(\Lambda_2(t)\)</span> (rate among survivors)</li>
<li><span class="math inline">\(\Lambda_D(t)\)</span></li>
</ul>
<p>where we consider types 1 and 2 and with a rate of the terminal event given by <span class="math inline">\(\Lambda_D(t)\)</span>. We let the events be independent, but could also specify a random effects structure to generate dependence.</p>
<p>When simulating data we can impose various random-effects structures to generate dependence</p>
<ul>
<li><p>Dependence=0: The intensities can be independent.</p></li>
<li>Dependence=1: We can one gamma distributed random effects <span class="math inline">\(Z\)</span>. Then the intensities are
<ul>
<li><span class="math inline">\(Z \lambda_1(t)\)</span></li>
<li><span class="math inline">\(Z \lambda_2(t)\)</span></li>
<li><span class="math inline">\(Z \lambda_D(t)\)</span></li>
</ul>
</li>
<li>Dependence=2: We can draw normally distributed random effects <span class="math inline">\(Z_1,Z_2,Z_d\)</span> were the variance (var.z) and correlation can be specified (cor.mat). Then the intensities are
<ul>
<li><span class="math inline">\(\exp(Z_1) \lambda_1(t)\)</span></li>
<li><span class="math inline">\(\exp(Z_2) \lambda_2(t)\)</span></li>
<li><span class="math inline">\(\exp(Z_3) \lambda_D(t)\)</span></li>
</ul>
</li>
<li>Dependence=3: We can draw gamma distributed random effects <span class="math inline">\(Z_1,Z_2,Z_d\)</span> were the sum-structure can be speicifed via a matrix cor.mat. We compute <span class="math inline">\(\tilde Z_j = \sum_k Z_k^{cor.mat(j,k)}\)</span> for <span class="math inline">\(j=1,2,3\)</span>.<br>
Then the intensities are
<ul>
<li><span class="math inline">\(\tilde Z_1 \lambda_1(t)\)</span></li>
<li><span class="math inline">\(\tilde Z_2 \lambda_2(t)\)</span></li>
<li><span class="math inline">\(\tilde Z_3 \lambda_D(t)\)</span></li>
</ul>
</li>
</ul>
<p>We return to how to run the different set-ups later and start by simulating independent processes.</p>
</div>
<div id="utility-functions" class="section level1">
<h1 class="hasAnchor">
<a href="#utility-functions" class="anchor"></a>Utility functions</h1>
<p>We here mention two utility functions</p>
<ul>
<li>tie.breaker for breaking ties among jump-times which is expected in the functions below.</li>
<li>count.history that counts the number of jumps previous for each subject that is <span class="math inline">\(N_1(t-)\)</span> and <span class="math inline">\(N_2(t-)\)</span>.</li>
</ul>
</div>
<div id="marginal-mean" class="section level1">
<h1 class="hasAnchor">
<a href="#marginal-mean" class="anchor"></a>Marginal Mean</h1>
<p>We start by estimating the marginal mean <span class="math inline">\(E(N_1(t \wedge D))\)</span> where <span class="math inline">\(D\)</span> is the timing of the terminal event.</p>
<p>This is based on a rate model for</p>
<ul>
<li>the type 1 events <span class="math inline">\(\sim E(dN_1(t) | D &gt; t)\)</span>
</li>
<li>the terminal event <span class="math inline">\(\sim E(dN_d(t) | D &gt; t)\)</span>
</li>
</ul>
<p>and is defined as <span class="math inline">\(\mu_1(t)=E(N_1^*(t))\)</span> <span class="math display">\[\begin{align}
   \int_0^t S(u) d R_1(u)   
\end{align}\]</span> where <span class="math inline">\(S(t)=P(D \geq t)\)</span> and <span class="math inline">\(dR_1(t) = E(dN_1^*(t) | D &gt; t)\)</span></p>
<p>and can therefore be estimated by a</p>
<ul>
<li>Kaplan-Meier estimator, <span class="math inline">\(\hat S(u)\)</span>
</li>
<li>Nelson-Aalen estimator for <span class="math inline">\(R_1(t)\)</span>
</li>
</ul>
<p><span class="math display">\[\begin{align}
  \hat R_1(t) &amp; =   \sum_i \int_0^t  \frac{1}{Y_\bullet (s)}  dN_{1i}(s)
\end{align}\]</span> where <span class="math inline">\(Y_{\bullet}(t)= \sum_i Y_i(t)\)</span> such that the estimator is <span class="math display">\[\begin{align}
  \hat \mu_1(t) &amp; =    \int_0^t \hat S(u) d\hat R_1(u).
\end{align}\]</span></p>
<p>Cook &amp; Lawless (1997), and developed further in Gosh &amp; Lin (2000).</p>
<p>The variance can be estimated based on the asymptotic expansion of <span class="math inline">\(\hat \mu_1(t) - \mu_1(t)\)</span> <span class="math display">\[\begin{align*}
  &amp; \sum_i \int_0^t \frac{S(s)}{\pi(s)} dM_{i1}  - \mu_1(t) \int_0^t  \frac{1}{\pi(s)} dM_i^d +  \int_0^t \frac{\mu_1(s) }{\pi(s)} dM_i^d,
\end{align*}\]</span></p>
<p>with mean-zero processes</p>
<ul>
<li>
<span class="math inline">\(M_i^d(t) = N_i^D(t)- \int_0^t Y_i(s) d \Lambda^D(s)\)</span>,</li>
<li>
<span class="math inline">\(M_{i1}(t) = N_{i1}(t) - \int_0^t Y_{i}(s) dR_1(s)\)</span>.</li>
</ul>
<p>as in Gosh &amp; Lin (2000)</p>
</div>
<div id="generating-data" class="section level1">
<h1 class="hasAnchor">
<a href="#generating-data" class="anchor"></a>Generating data</h1>
<p>We start by generating some data to illustrate the computation of the marginal mean</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://kkholst.github.io/mets/">mets</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span> <span class="co"># to control output in simulatins for p-values below.</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">base1cumhaz</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">base4cumhaz</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">drcumhaz</span><span class="op">)</span>
<span class="va">ddr</span> <span class="op">&lt;-</span> <span class="va">drcumhaz</span>
<span class="va">base1</span> <span class="op">&lt;-</span> <span class="va">base1cumhaz</span>
<span class="va">base4</span> <span class="op">&lt;-</span> <span class="va">base4cumhaz</span>
<span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simRecurrent.html">simRecurrent</a></span><span class="op">(</span><span class="fl">1000</span>,<span class="va">base1</span>,death.cumhaz<span class="op">=</span><span class="va">ddr</span><span class="op">)</span>
<span class="va">rr</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">rr</span><span class="op">)</span><span class="op">)</span> 
<span class="va">rr</span><span class="op">$</span><span class="va">strata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="op">(</span><span class="va">rr</span><span class="op">$</span><span class="va">id</span><span class="op">-</span><span class="fl">0.01</span><span class="op">)</span><span class="op">/</span><span class="fl">500</span><span class="op">)</span>
<span class="fu"><a href="../reference/dprint.html">dlist</a></span><span class="op">(</span><span class="va">rr</span>,<span class="va">.</span><span class="op">~</span><span class="va">id</span><span class="op">|</span> <span class="va">id</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">7</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; id: 1</span>
<span class="co">#&gt;   entry time  status rr dtime fdeath death start stop  x     strata</span>
<span class="co">#&gt; 1 0     133.1 0      1  133.1 1      1     0     133.1 1.185 0     </span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] matrix array </span>
<span class="co">#&gt; ------------------------------------------------------------ </span>
<span class="co">#&gt; id: 7</span>
<span class="co">#&gt;      entry  time   status rr dtime fdeath death start  stop   x       strata</span>
<span class="co">#&gt; 7       0.0  813.3 1      1  1729  1      0        0.0  813.3  1.5495 0     </span>
<span class="co">#&gt; 1004  813.3 1288.4 1      1  1729  1      0      813.3 1288.4  1.0535 0     </span>
<span class="co">#&gt; 1658 1288.4 1315.4 1      1  1729  1      0     1288.4 1315.4  1.5330 0     </span>
<span class="co">#&gt; 2150 1315.4 1449.4 1      1  1729  1      0     1315.4 1449.4  0.8944 0     </span>
<span class="co">#&gt; 2539 1449.4 1726.1 1      1  1729  1      0     1449.4 1726.1 -0.1931 0     </span>
<span class="co">#&gt; 2851 1726.1 1729.4 0      1  1729  1      1     1726.1 1729.4  0.4081 0     </span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] matrix array </span>
<span class="co">#&gt; ------------------------------------------------------------ </span>
<span class="co">#&gt; id: 9</span>
<span class="co">#&gt;      entry  time   status rr dtime fdeath death start  stop   x       strata</span>
<span class="co">#&gt; 9       0.0  433.5 1      1  5110  0      0        0.0  433.5 -0.4660 0     </span>
<span class="co">#&gt; 1006  433.5 2451.1 1      1  5110  0      0      433.5 2451.1  1.0647 0     </span>
<span class="co">#&gt; 1659 2451.1 3629.7 1      1  5110  0      0     2451.1 3629.7 -0.2506 0     </span>
<span class="co">#&gt; 2151 3629.7 3644.7 1      1  5110  0      0     3629.7 3644.7 -0.6748 0     </span>
<span class="co">#&gt; 2540 3644.7 3695.8 1      1  5110  0      0     3644.7 3695.8  0.6510 0     </span>
<span class="co">#&gt; 2852 3695.8 3890.7 1      1  5110  0      0     3695.8 3890.7 -0.2033 0     </span>
<span class="co">#&gt; 3112 3890.7 5110.0 0      1  5110  0      0     3890.7 5110.0 -1.6981 0     </span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] matrix array</span></code></pre></div>
<p>The status variable keeps track of the recurrent evnts and their type, and death the timing of death.</p>
<p>To compute the marginal mean we simly estimate the two rates functions of the number of events of interest and death by using the phreg function (to start without covariates). Then the estimates are combined with standard error computation in the recurrentMarginal function</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#  to fit non-parametric models with just a baseline </span>
<span class="va">xr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="fu">cluster</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span>
<span class="va">dr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">death</span><span class="op">)</span><span class="op">~</span><span class="fu">cluster</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">dr</span>,se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"death"</span><span class="op">)</span>
<span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">xr</span>,se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># robust standard errors </span>
<span class="va">rxr</span> <span class="op">&lt;-</span>   <span class="fu"><a href="../reference/phreg.html">robust.phreg</a></span><span class="op">(</span><span class="va">xr</span>,fixbeta<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">rxr</span>,se<span class="op">=</span><span class="cn">TRUE</span>,robust<span class="op">=</span><span class="cn">TRUE</span>,add<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="fl">4</span><span class="op">)</span>

<span class="co"># marginal mean of expected number of recurrent events </span>
<span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recurrentMarginal</a></span><span class="op">(</span><span class="va">xr</span>,<span class="va">dr</span><span class="op">)</span>
<span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">out</span>,se<span class="op">=</span><span class="cn">TRUE</span>,ylab<span class="op">=</span><span class="st">"marginal mean"</span>,col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>We can also extract the estimate in different time-points</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">out</span>,times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1000</span>,<span class="fl">2000</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   times  mean    se-mean  CI-2.5% CI-97.5%</span>
<span class="co">#&gt; 1  1000 1.207 0.04227054 1.126929 1.292760</span>
<span class="co">#&gt; 2  2000 1.922 0.06531928 1.798145 2.054386</span></code></pre></div>
<p>The marginal mean can also be estimated in a stratified case:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="fu">strata</span><span class="op">(</span><span class="va">strata</span><span class="op">)</span><span class="op">+</span><span class="fu">cluster</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span>
<span class="va">dr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">death</span><span class="op">)</span><span class="op">~</span><span class="fu">strata</span><span class="op">(</span><span class="va">strata</span><span class="op">)</span><span class="op">+</span><span class="fu">cluster</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">dr</span>,se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"death"</span><span class="op">)</span>
<span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">xr</span>,se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">rxr</span> <span class="op">&lt;-</span>   <span class="fu"><a href="../reference/phreg.html">robust.phreg</a></span><span class="op">(</span><span class="va">xr</span>,fixbeta<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">rxr</span>,se<span class="op">=</span><span class="cn">TRUE</span>,robust<span class="op">=</span><span class="cn">TRUE</span>,add<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>

<span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recurrentMarginal</a></span><span class="op">(</span><span class="va">xr</span>,<span class="va">dr</span><span class="op">)</span>
<span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">out</span>,se<span class="op">=</span><span class="cn">TRUE</span>,ylab<span class="op">=</span><span class="st">"marginal mean"</span>,col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Furhter, if we adjust for covariates for the two rates we can still do predictions of marginal mean, what can be plotted is the baseline marginal mean, that is for the covariates equal to 0 for both models. Predictions for specific covariates can also be obtained with the recmarg (recurren marginal mean used solely for predictions without standard error computation).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># cox case</span>
<span class="va">xr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">x</span><span class="op">+</span><span class="fu">cluster</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span>
<span class="va">dr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">death</span><span class="op">)</span><span class="op">~</span><span class="va">x</span><span class="op">+</span><span class="fu">cluster</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">dr</span>,se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"death"</span><span class="op">)</span>
<span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">xr</span>,se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">rxr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">robust.phreg</a></span><span class="op">(</span><span class="va">xr</span><span class="op">)</span>
<span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">rxr</span>,se<span class="op">=</span><span class="cn">TRUE</span>,robust<span class="op">=</span><span class="cn">TRUE</span>,add<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>

<span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recurrentMarginal</a></span><span class="op">(</span><span class="va">xr</span>,<span class="va">dr</span><span class="op">)</span>
<span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">out</span>,se<span class="op">=</span><span class="cn">TRUE</span>,ylab<span class="op">=</span><span class="st">"marginal mean"</span>,col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>

<span class="co"># predictions witout se's </span>
<span class="va">outX</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recmarg</a></span><span class="op">(</span><span class="va">xr</span>,<span class="va">dr</span>,Xr<span class="op">=</span><span class="fl">1</span>,Xd<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">outX</span>,add<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div id="improving-efficiency" class="section level1">
<h1 class="hasAnchor">
<a href="#improving-efficiency" class="anchor"></a>Improving efficiency</h1>
<p>We now simulate some data where there is strong heterogenity such that we can improve the efficiency for censored survival data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simRecurrentII.html">simRecurrentII</a></span><span class="op">(</span><span class="fl">5000</span>,<span class="va">base1</span>,<span class="va">base4</span>,death.cumhaz<span class="op">=</span><span class="va">ddr</span>,cens<span class="op">=</span><span class="fl">3</span><span class="op">/</span><span class="fl">5000</span>,dependence<span class="op">=</span><span class="fl">4</span>,var.z<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">rr</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/count.history.html">count.history</a></span><span class="op">(</span><span class="va">rr</span><span class="op">)</span>

<span class="co"># cox case</span>
<span class="va">xr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">status</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">~</span><span class="fu">cluster</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span>
<span class="va">dr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phreg.html">phreg</a></span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">death</span><span class="op">)</span><span class="op">~</span><span class="fu">cluster</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span><span class="op">)</span>
<span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recurrentMarginal</a></span><span class="op">(</span><span class="va">xr</span>,<span class="va">dr</span><span class="op">)</span>

<span class="va">times</span> <span class="op">&lt;-</span> <span class="fl">500</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>
     
<span class="va">recEFF1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recurrentMarginalAIPCW</a></span><span class="op">(</span><span class="va">rr</span>,<span class="va">times</span>,start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span>,status<span class="op">=</span><span class="st">"status"</span>,death<span class="op">=</span><span class="st">"death"</span>,cause<span class="op">=</span><span class="fl">1</span>,terms<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">recEFF14</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recurrentMarginal.html">recurrentMarginalAIPCW</a></span><span class="op">(</span><span class="va">rr</span>,<span class="va">times</span>,start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span>,status<span class="op">=</span><span class="st">"status"</span>,death<span class="op">=</span><span class="st">"death"</span>,cause<span class="op">=</span><span class="fl">1</span>,terms<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>

<span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">out</span>,se<span class="op">=</span><span class="cn">TRUE</span>,ylab<span class="op">=</span><span class="st">"marginal mean"</span>,col<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="va">times</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">ci1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">recEFF1</span><span class="op">$</span><span class="va">muPAt</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">recEFF1</span><span class="op">$</span><span class="va">semuPAt</span><span class="op">[</span><span class="va">k</span><span class="op">]</span>,
             <span class="va">recEFF1</span><span class="op">$</span><span class="va">muPAt</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="va">recEFF1</span><span class="op">$</span><span class="va">semuPAt</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">t</span>,<span class="fl">2</span><span class="op">)</span><span class="op">-</span><span class="fl">20</span>,<span class="va">ci1</span>,col<span class="op">=</span><span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
    <span class="va">ci14</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">recEFF14</span><span class="op">$</span><span class="va">muPAt</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">recEFF14</span><span class="op">$</span><span class="va">semuPAt</span><span class="op">[</span><span class="va">k</span><span class="op">]</span>,
              <span class="va">recEFF14</span><span class="op">$</span><span class="va">muPAt</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="va">recEFF14</span><span class="op">$</span><span class="va">semuPAt</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">t</span>,<span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fl">20</span>,<span class="va">ci14</span>,col<span class="op">=</span><span class="fl">3</span>,lty<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
    <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">k</span><span class="op">+</span><span class="fl">1</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Eff-small"</span>,<span class="st">"Eff-large"</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span> <span class="va">recEFF14</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">times</span>,<span class="va">muP</span>,<span class="va">semuP</span>,<span class="va">muPAt</span>,<span class="va">semuPAt</span>,<span class="va">semuPAt</span><span class="op">/</span><span class="va">semuP</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;       times       muP      semuP     muPAt    semuPAt          </span>
<span class="co">#&gt;  [1,]   500 0.7900308 0.01998113 0.7877685 0.01989930 0.9959044</span>
<span class="co">#&gt;  [2,]  1000 1.1805813 0.03073517 1.1745455 0.03033522 0.9869872</span>
<span class="co">#&gt;  [3,]  1500 1.5458783 0.04343038 1.5379056 0.04217803 0.9711643</span>
<span class="co">#&gt;  [4,]  2000 1.8657064 0.05605839 1.8534433 0.05364115 0.9568801</span>
<span class="co">#&gt;  [5,]  2500 2.0977225 0.06731111 2.0774959 0.06331096 0.9405722</span>
<span class="co">#&gt;  [6,]  3000 2.3295890 0.08090458 2.3020009 0.07468060 0.9230701</span>
<span class="co">#&gt;  [7,]  3500 2.5302409 0.09375891 2.4941233 0.08499066 0.9064809</span>
<span class="co">#&gt;  [8,]  4000 2.7226356 0.11166060 2.6762896 0.09870848 0.8840046</span>
<span class="co">#&gt;  [9,]  4500 2.8183751 0.12198167 2.7703477 0.10715645 0.8784636</span>
<span class="co">#&gt; [10,]  5000 2.8625077 0.12489274 2.8139108 0.10983466 0.8794319</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span> <span class="va">recEFF1</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">times</span>,<span class="va">muP</span>,<span class="va">semuP</span>,<span class="va">muPAt</span>,<span class="va">semuPAt</span>,<span class="va">semuPAt</span><span class="op">/</span><span class="va">semuP</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;       times       muP      semuP     muPAt    semuPAt          </span>
<span class="co">#&gt;  [1,]   500 0.7900308 0.01998113 0.7877783 0.01990158 0.9960187</span>
<span class="co">#&gt;  [2,]  1000 1.1805813 0.03073517 1.1760556 0.03034430 0.9872825</span>
<span class="co">#&gt;  [3,]  1500 1.5458783 0.04343038 1.5395675 0.04220712 0.9718340</span>
<span class="co">#&gt;  [4,]  2000 1.8657064 0.05605839 1.8574160 0.05369177 0.9577830</span>
<span class="co">#&gt;  [5,]  2500 2.0977225 0.06731111 2.0845827 0.06340969 0.9420390</span>
<span class="co">#&gt;  [6,]  3000 2.3295890 0.08090458 2.3152442 0.07490363 0.9258269</span>
<span class="co">#&gt;  [7,]  3500 2.5302409 0.09375891 2.5113033 0.08536411 0.9104639</span>
<span class="co">#&gt;  [8,]  4000 2.7226356 0.11166060 2.7046847 0.09938874 0.8900968</span>
<span class="co">#&gt;  [9,]  4500 2.8183751 0.12198167 2.8091830 0.10798346 0.8852433</span>
<span class="co">#&gt; [10,]  5000 2.8625077 0.12489274 2.8548534 0.11058939 0.8854749</span></code></pre></div>
</div>
<div id="regression-models-for-the-marginal-mean" class="section level1">
<h1 class="hasAnchor">
<a href="#regression-models-for-the-marginal-mean" class="anchor"></a>Regression models for the marginal mean</h1>
<p>One can also do regression model, using the model <span class="math display">\[\begin{align*}
E(N_1(t) | X) &amp;  = \Lambda_0(t)  \exp(X^T \beta)
\end{align*}\]</span> then Ghost-Lin suggested IPCW score equations that are implemented in the recreg function of mets.</p>
<p>First we generate data that from a cox model with <span class="math inline">\(\beta=(-0.3,0.3)\)</span></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu">mets</span><span class="fu">:::</span><span class="fu">simMarginalMeanCox</span><span class="op">(</span><span class="fl">10000</span>,cens<span class="op">=</span><span class="fl">3</span><span class="op">/</span><span class="fl">5000</span>,Lam1<span class="op">=</span><span class="va">base1</span>,LamD<span class="op">=</span><span class="va">ddr</span>,beta1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="op">-</span><span class="fl">0.3</span><span class="op">)</span>,betad<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.3</span>,<span class="fl">0.3</span><span class="op">)</span><span class="op">)</span>

 <span class="va">out</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recreg</a></span><span class="op">(</span><span class="fu"><a href="../reference/recreg.html">EventCens</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusG</span>,<span class="va">cens</span><span class="op">)</span><span class="op">~</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="fu">cluster</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span>,cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
 <span class="va">outs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recreg.html">recreg</a></span><span class="op">(</span><span class="fu"><a href="../reference/recreg.html">EventCens</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span>,<span class="va">statusG</span>,<span class="va">cens</span><span class="op">)</span><span class="op">~</span><span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="fu">cluster</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">rr</span>,cause<span class="op">=</span><span class="fl">1</span>,death.code<span class="op">=</span><span class="fl">2</span>,cens.model<span class="op">=</span><span class="op">~</span><span class="fu">strata</span><span class="op">(</span><span class="va">X1g</span>,<span class="va">X2g</span><span class="op">)</span><span class="op">)</span>

 <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span>
<span class="co">#&gt;      Estimate       S.E.    dU^-1/2      P-value</span>
<span class="co">#&gt; X1  0.3468882 0.04662299 0.03658079 1.004698e-13</span>
<span class="co">#&gt; X2 -0.3806577 0.04670614 0.03674118 3.637579e-16</span>
 <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">outs</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span>
<span class="co">#&gt;      Estimate       S.E.    dU^-1/2      P-value</span>
<span class="co">#&gt; X1  0.3211903 0.04414868 0.03659178 3.459185e-13</span>
<span class="co">#&gt; X2 -0.3594566 0.04422745 0.03675239 4.383964e-16</span></code></pre></div>
<p>We note that for the extended censoring model we gain a little efficiency and that the estimates are close to the true values.</p>
</div>
<div id="other-marginal-properties" class="section level1">
<h1 class="hasAnchor">
<a href="#other-marginal-properties" class="anchor"></a>Other marginal properties</h1>
<p>The mean is a useful summary measure but it is very easy and useful to look at other simple summary measures such as the probability of exceeding <span class="math inline">\(k\)</span> events</p>
<ul>
<li>
<span class="math inline">\(P(N_1^*(t) \ge k)\)</span>
<ul>
<li>cumulative incidence of <span class="math inline">\(T_{k} = \inf \{ t: N_1^*(t)=k \}\)</span> with competing <span class="math inline">\(D\)</span>.</li>
</ul>
</li>
</ul>
<p>that is thus equivalent to a certain cumulative incidence of <span class="math inline">\(T_k\)</span> occurring before <span class="math inline">\(D\)</span>. We denote this cumulative incidence as <span class="math inline">\(\hat F_k(t)\)</span>.</p>
<p>We note also that <span class="math inline">\(N_1^*(t)^2\)</span> can be written as <span class="math display">\[\begin{align*}
   \sum_{k=0}^K  \int_0^t I(D &gt; s) I(N_1^*(s-)=k) f(k) dN_1^*(s)
\end{align*}\]</span> with <span class="math inline">\(f(k)=(k+1)^2 - k^2\)</span>, such that its mean can be written as <span class="math display">\[\begin{align*}
    \sum_{k=0}^K \int_0^t S(s) f(k) P(N_1^*(s-)= k  | D  \geq s) E( dN_1^*(s)  | N_1^*(s-)=k, D&gt; s) 
\end{align*}\]</span> and estimated by <span class="math display">\[\begin{align*}
\tilde \mu_{1,2}(t) &amp; = 
    \sum_{k=0}^K \int_0^t \hat S(s) f(k) 
    \frac{Y_{1\bullet}^k(s)}{Y_\bullet (s)} \frac{1}{Y_{1\bullet}^k(s)} d N_{1\bullet}^k(s)= \sum_{i=1}^n \int_0^t \hat S(s) f(N_{i1}(s-)) \frac{1}{Y_\bullet (s)} d N_{i1}(s),
\end{align*}\]</span> That is very similar to the “product-limit” estimator for <span class="math inline">\(E( (N_1^*(t))^2 )\)</span> <span class="math display">\[\begin{align}
  \hat \mu_{1,2}(t) &amp; =    \sum_{k=0}^K k^2 ( \hat F_{k}(t) - \hat F_{k+1}(t) ).
\end{align}\]</span></p>
<p>We use the esimator of the probabilty of exceeding “k” events based on the fact that <span class="math inline">\(I(N_1^*(t) \geq k)\)</span> is equivalent to <span class="math display">\[\begin{align*}
    \int_0^t I(D &gt; s) I(N_1^*(s-)=k-1) dN_1^*(s),
\end{align*}\]</span> suggesting that its mean can be computed as <span class="math display">\[\begin{align*}
\int_0^t S(s) P(N_1^*(s-)= k-1  | D  \geq s) E( dN_1^*(s)  | N_1^*(s-)=k-1, D&gt; s) 
\end{align*}\]</span> and estimated by <span class="math display">\[\begin{align*}
\tilde F_k(t) = \int_0^t \hat S(s)  \frac{Y_{1\bullet}^{k-1}(s)}{Y_\bullet (s)} 
            \frac{1}{Y_{1\bullet}^{k-1}(s)} d N_{1\bullet}^{k-1}(s).
\end{align*}\]</span></p>
<p>To compute these estimators we need to set up the data by computing the number of previous events of type “1” by the count.history function</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">###cor.mat &lt;- corM &lt;- rbind(c(1.0, 0.6, 0.9), c(0.6, 1.0, 0.5), c(0.9, 0.5, 1.0))</span>
<span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simRecurrentII.html">simRecurrentII</a></span><span class="op">(</span><span class="fl">5000</span>,<span class="va">base1</span>,<span class="va">base4</span>,death.cumhaz<span class="op">=</span><span class="va">ddr</span>,cens<span class="op">=</span><span class="fl">3</span><span class="op">/</span><span class="fl">5000</span>,dependence<span class="op">=</span><span class="fl">4</span>,var.z<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">rr</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/count.history.html">count.history</a></span><span class="op">(</span><span class="va">rr</span><span class="op">)</span>
<span class="fu"><a href="../reference/dtable.html">dtable</a></span><span class="op">(</span><span class="va">rr</span>,<span class="op">~</span><span class="va">death</span><span class="op">+</span><span class="va">status</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;       status    0    1    2</span>
<span class="co">#&gt; death                      </span>
<span class="co">#&gt; 0            2173 6965  724</span>
<span class="co">#&gt; 1            2827    0    0</span>

<span class="va">oo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prob.exceed.recurrent.html">prob.exceedRecurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">oo</span><span class="op">)</span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>We can also look at the mean and variance based on the estimators just described</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">oo</span>,<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">mu</span>,col<span class="op">=</span><span class="fl">2</span>,type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">oo</span>,<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">varN</span>,type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>We could also use the product-limit estimator to estimate the probability of exceeding “k” events, and then standard errors are also returned:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">oop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prob.exceed.recurrent.html">prob.exceed.recurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span><span class="op">)</span>
 <span class="fu"><a href="../reference/basehazplot.phreg.html">bplot</a></span><span class="op">(</span><span class="va">oo</span><span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html">matlines</a></span><span class="op">(</span><span class="va">oop</span><span class="op">$</span><span class="va">times</span>,<span class="va">oop</span><span class="op">$</span><span class="va">prob</span>,type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/prob.exceed.recurrent.html">summaryTimeobject</a></span><span class="op">(</span><span class="va">oop</span><span class="op">$</span><span class="va">times</span>,<span class="va">oop</span><span class="op">$</span><span class="va">prob</span>,se.mu<span class="op">=</span><span class="va">oop</span><span class="op">$</span><span class="va">se.prob</span>,times<span class="op">=</span><span class="fl">1000</span><span class="op">)</span>
<span class="co">#&gt;            times         mean      se-mean      CI-2.5%    CI-97.5%</span>
<span class="co">#&gt; N=0         1000 0.5135839727 0.0077508270 4.986148e-01 0.529002507</span>
<span class="co">#&gt; exceed&gt;=1   1000 0.4864160273 0.0077508270 4.714592e-01 0.501847368</span>
<span class="co">#&gt; exceed&gt;=2   1000 0.2791802631 0.0072649551 2.652980e-01 0.293788959</span>
<span class="co">#&gt; exceed&gt;=3   1000 0.1548328609 0.0059596102 1.435818e-01 0.166965600</span>
<span class="co">#&gt; exceed&gt;=4   1000 0.0953205692 0.0049028842 8.617943e-02 0.105431313</span>
<span class="co">#&gt; exceed&gt;=5   1000 0.0597833007 0.0039950674 5.244410e-02 0.068149577</span>
<span class="co">#&gt; exceed&gt;=6   1000 0.0364443702 0.0031823858 3.071148e-02 0.043247421</span>
<span class="co">#&gt; exceed&gt;=7   1000 0.0215738650 0.0024797742 1.722210e-02 0.027025254</span>
<span class="co">#&gt; exceed&gt;=8   1000 0.0160412772 0.0021940205 1.226917e-02 0.020973110</span>
<span class="co">#&gt; exceed&gt;=9   1000 0.0096320548 0.0017332910 6.769275e-03 0.013705526</span>
<span class="co">#&gt; exceed&gt;=10  1000 0.0055502228 0.0013121492 3.491973e-03 0.008821651</span>
<span class="co">#&gt; exceed&gt;=11  1000 0.0041124211 0.0011449285 2.382936e-03 0.007097130</span>
<span class="co">#&gt; exceed&gt;=12  1000 0.0018178741 0.0007482175 8.113569e-04 0.004073012</span>
<span class="co">#&gt; exceed&gt;=13  1000 0.0008180219 0.0004750604 2.620757e-04 0.002553308</span>
<span class="co">#&gt; exceed&gt;=14  1000 0.0008515012 0.0004948700 2.725714e-04 0.002660052</span>
<span class="co">#&gt; exceed&gt;=15  1000 0.0008865533 0.0005167437 2.828508e-04 0.002778768</span>
<span class="co">#&gt; exceed&gt;=16  1000 0.0005754358 0.0004117978 1.415280e-04 0.002339653</span>
<span class="co">#&gt; exceed&gt;=17  1000 0.0005899438 0.0004230969 1.446549e-04 0.002405958</span>
<span class="co">#&gt; exceed&gt;=18  1000 0.0002465672 0.0002465103 3.474678e-05 0.001749669</span>
<span class="co">#&gt; exceed&gt;=19  1000 0.0002486972 0.0002486380 3.504745e-05 0.001764759</span>
<span class="co">#&gt; exceed&gt;=20  1000 0.0002514304 0.0002513690 3.543303e-05 0.001784132</span>
<span class="co">#&gt; exceed&gt;=21  1000 0.0002644166 0.0002643526 3.726299e-05 0.001876289</span>
<span class="co">#&gt; exceed&gt;=22  1000 0.0002839154 0.0002838369 4.001357e-05 0.002014516</span>
<span class="co">#&gt; exceed&gt;=23  1000 0.0002883495 0.0002882585 4.064156e-05 0.002045822</span>
<span class="co">#&gt; exceed&gt;=24  1000 0.0003054324 0.0003053305 4.305089e-05 0.002166947</span>
<span class="co">#&gt; exceed&gt;=25  1000 0.0003118949 0.0003117901 4.396199e-05 0.002212786</span>
<span class="co">#&gt; exceed&gt;=26  1000 0.0003151674 0.0003150598 4.442368e-05 0.002235981</span>
<span class="co">#&gt; exceed&gt;=27  1000 0.0003295971 0.0003294816 4.645844e-05 0.002338311</span>
<span class="co">#&gt; exceed&gt;=28  1000 0.0003400618 0.0003399308 4.793673e-05 0.002412389</span>
<span class="co">#&gt; exceed&gt;=29  1000 0.0003403236 0.0003401851 4.797568e-05 0.002414143</span>
<span class="co">#&gt; exceed&gt;=30  1000 0.0000000000 0.0000000000          NaN         NaN</span>
<span class="co">#&gt; exceed&gt;=31  1000 0.0000000000 0.0000000000          NaN         NaN</span>
<span class="co">#&gt; exceed&gt;=32  1000 0.0000000000 0.0000000000          NaN         NaN</span>
<span class="co">#&gt; exceed&gt;=33  1000 0.0000000000 0.0000000000          NaN         NaN</span></code></pre></div>
<p>We note from the plot that the estimates are quite similar.</p>
<p>Finally, we make a plot with 95% confidence intervals</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html">matplot</a></span><span class="op">(</span><span class="va">oop</span><span class="op">$</span><span class="va">times</span>,<span class="va">oop</span><span class="op">$</span><span class="va">prob</span>,type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">oop</span><span class="op">$</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> 
    <span class="fu"><a href="../reference/basehazplot.phreg.html">plotConfRegion</a></span><span class="op">(</span><span class="va">oop</span><span class="op">$</span><span class="va">times</span>,<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">oop</span><span class="op">$</span><span class="va">se.lower</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>,<span class="va">oop</span><span class="op">$</span><span class="va">se.upper</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="va">i</span><span class="op">)</span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div id="multiple-events" class="section level1">
<h1 class="hasAnchor">
<a href="#multiple-events" class="anchor"></a>Multiple events</h1>
<p>We now generate recurrent events with two types of events. We start by generating data as before where all events are independent.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simRecurrent.html">simRecurrent</a></span><span class="op">(</span><span class="fl">1000</span>,<span class="va">base1</span>,cumhaz2<span class="op">=</span><span class="va">base4</span>,death.cumhaz<span class="op">=</span><span class="va">ddr</span><span class="op">)</span>
<span class="co">#&gt; Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):</span>
<span class="co">#&gt; collapsing to unique 'x' values</span>
<span class="va">rr</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/count.history.html">count.history</a></span><span class="op">(</span><span class="va">rr</span><span class="op">)</span>
<span class="fu"><a href="../reference/dtable.html">dtable</a></span><span class="op">(</span><span class="va">rr</span>,<span class="op">~</span><span class="va">death</span><span class="op">+</span><span class="va">status</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;       status    0    1    2</span>
<span class="co">#&gt; death                      </span>
<span class="co">#&gt; 0             118 2823  440</span>
<span class="co">#&gt; 1             882    0    0</span></code></pre></div>
<p>Based on this we can estimate also the joint distribution function, that is the probability that <span class="math inline">\((N_1(t) \geq k_1, N_2(t) \geq k_2)\)</span></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Bivariate probability of exceeding </span>
<span class="va">oo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prob.exceed.recurrent.html">prob.exceedBiRecurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,exceed1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span>,exceed2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">oo</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html">matplot</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">pe1e2</span>,type<span class="op">=</span><span class="st">"s"</span><span class="op">)</span><span class="op">)</span>
<span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">oo</span><span class="op">$</span><span class="va">pe1e2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">oo</span><span class="op">$</span><span class="va">pe1e2</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">nc</span>,col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">nc</span><span class="op">)</span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<div id="dependence-between-events-covariance" class="section level2">
<h2 class="hasAnchor">
<a href="#dependence-between-events-covariance" class="anchor"></a>Dependence between events: Covariance</h2>
<p>The dependence can also be summarised in other ways. For example by computing the covariance and comparing it to the covariance under the assumption of independence among survivors.</p>
<p>Covariance among two types of events <span class="math display">\[\begin{align}
\rho(t) &amp;  = \frac{ E(N_1^*(t) N_2^*(t) )  - \mu_1(t) \mu_2(t) }{ \mbox{sd}(N_1^*(t)) \mbox{sd}(N_2^*(t)) }
\end{align}\]</span> where <span class="math inline">\(E(N_1^*(t) N_2^*(t))\)</span> can be computed as <span class="math display">\[\begin{align*}
  E(N_1^*(t) N_2^*(t)) &amp;   = E( \int_0^t N_1^*(s-) dN_2^*(s) ) + E( \int_0^t N_2^*(s-) dN_1^*(s) ) 
\end{align*}\]</span></p>
<p>Recall that we might have a terminal event present such that we only see <span class="math inline">\(N_1^*(t \wedge D)\)</span> and <span class="math inline">\(N_2^*(t \wedge D)\)</span>.</p>
<p>To compute the covariance we thus compute <span class="math display">\[\begin{align*}
E(\int_0^t N_1^*(s-) dN_2^*(s) ) &amp; = \sum_k E( \int_0^t k I(N_1^*(s-)=k) I(D \geq s)  dN_2^*(s) ) 
\end{align*}\]</span> <span class="math display">\[\begin{align*}
= \sum_k \int_0^t S(s) k P(N_1^*(s-)= k  | D  \geq s) E( dN_2^*(s)  | N_1^*(s-)=k, D \geq s) 
\end{align*}\]</span> estimated by <span class="math display">\[\begin{align*}
  &amp; \sum_k \int_0^t \hat S(s) k \frac{Y_1^k(s)}{Y_\bullet (s)} \frac{1}{Y_1^k(s)} d \tilde N_{2,k}(s),
\end{align*}\]</span> * <span class="math inline">\(Y_j^k(t) = \sum Y_i(t) I( N_{ji}^*(s-)=k)\)</span> for <span class="math inline">\(j=1,2\)</span>, * <span class="math inline">\(\tilde N_{j,k}(t) = \sum_i \int_0^t I(N_{ij^o}(s-)=k) dN_{ij}(s)\)</span> * <span class="math inline">\(j^o\)</span> gives the other type so that <span class="math inline">\(1^o=2\)</span> and <span class="math inline">\(2^o=1\)</span>.</p>
<p>We thus estimate $ E(N_1^<em>(t) N_2^</em>(t))$ by <span class="math display">\[\begin{align*}
  \sum_k \int_0^t \hat S(s) k \frac{Y_1^k(s)}{Y_\bullet (s)} \frac{1}{Y_1^k(s)} d \tilde N_{2,k}(s) +
   \sum_k \int_0^t \hat S(s) k \frac{Y_2^k(s)}{Y_\bullet (s)} \frac{1}{Y_2^k(s)} d \tilde N_{1,k}(s).
\end{align*}\]</span></p>
<ul>
<li>Without terminating event covariance is a useful nonparametric measure.</li>
<li>With terminating event dependence can be generated terminating event.</li>
<li>In reality what is of interest would be independence among survivors that is if
<ul>
<li>
<span class="math inline">\(N_1\)</span> is not predicitive for <span class="math inline">\(N_2\)</span> <span class="math display">\[\begin{align}
 E( dN_2^*(t)  | N_1^*(t-)=k, D \geq t) =  E( dN_2^*(t)  | D \geq t) 
\end{align}\]</span>
</li>
<li>
<span class="math inline">\(N_2\)</span> is not predicitive for <span class="math inline">\(N_1\)</span> <span class="math display">\[\begin{align}
 E( dN_1^*(t)  | N_2^*(t-)=k, D \geq t) =  E( dN_1^*(t)  | D \geq t) 
\end{align}\]</span>
</li>
</ul>
</li>
</ul>
<p>If the two processes are independent among survivors then <span class="math display">\[\begin{align}
 E( dN_2^*(t)  | N_1^*(t-)=k, D \geq t) =  E( dN_2^*(t)  | D \geq t) 
\end{align}\]</span> so <span class="math display">\[\begin{align*}
  E( \int_0^t N_1^*(s-) dN_2^*(s) )  &amp; =  \int_0^t S(s) E(N_1^*(s-) | D  \geq s) E( dN_2^*(s)  | D \geq s) 
\end{align*}\]</span> and <span class="math display">\[\begin{align*}
  \int_0^t \hat S(s) \{  \sum_k k \frac{Y_1^k(s)}{Y_\bullet (s)} \} \frac{1}{Y_\bullet (s)} dN_{2\bullet}(s),
\end{align*}\]</span> where <span class="math inline">\(N_{j\bullet}(t) = \sum_i \int_0^t dN_{j,i}(s)\)</span>.</p>
<p>Under the independence <span class="math inline">\(E(N_1^*(t) N_2^*(t))\)</span> is estimated <span class="math display">\[\begin{align*}
  \int_0^t \hat S(s) \{  \sum_k k \frac{Y_1^k(s)}{Y_\bullet (s)} \} \frac{1}{Y_\bullet (s)} dN_{2\bullet}(s) 
    + \int_0^t \hat S(s) \{  \sum_k k \frac{Y_2^k(s)}{Y_\bullet (s)} \} \frac{1}{Y_\bullet (s)} dN_{1\bullet}(s).
\end{align*}\]</span></p>
<p>Both estimators, <span class="math inline">\(\hat E(N_1^*(t) N_2^*(t))\)</span> and <span class="math inline">\(\hat E_I(N_1^*(t) N_2^*(t))\)</span>, as well as <span class="math inline">\(\hat E(N_1^*(t))\)</span> and <span class="math inline">\(\hat E(N_2^*(t))\)</span>, have asymptotic expansions that can be written as a sum of iid processes, similarly to the arguments of Ghosh &amp; Lin 2000, <span class="math inline">\(\sum_i \Psi_i(t)\)</span>.<br>
We here, however, use a simple block bootstrap to get standard errors.</p>
<p>We can thus estimate the standard errors and of the estimators and their difference <span class="math inline">\(\hat E(N_1^*(t) N_2^*(t))- \hat E_I(N_1^*(t) N_2^*(t))\)</span>.</p>
<p>Note that we have terms for whether * <span class="math inline">\(N_1\)</span> is predicitive for <span class="math inline">\(N_2\)</span> * N1 -&gt; N2 : <span class="math inline">\(E( \int_0^t N_1^*(s-) dN_2^*(s) )\)</span> * this is equivalent to a weighted log-rank test * <span class="math inline">\(N_2\)</span> is predicitive for <span class="math inline">\(N_1\)</span> * N2 -&gt; N1 : <span class="math inline">\(E( \int_0^t N_2^*(s-) dN_1^*(s) )\)</span> * this is equivalent to a weighted log-rank test</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rr</span><span class="op">$</span><span class="va">strata</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="fu"><a href="../reference/dtable.html">dtable</a></span><span class="op">(</span><span class="va">rr</span>,<span class="op">~</span><span class="va">death</span><span class="op">+</span><span class="va">status</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;       status    0    1    2</span>
<span class="co">#&gt; death                      </span>
<span class="co">#&gt; 0             118 2823  440</span>
<span class="co">#&gt; 1             882    0    0</span>

<span class="va">covrp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covarianceRecurrent.html">covarianceRecurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,status<span class="op">=</span><span class="st">"status"</span>,death<span class="op">=</span><span class="st">"death"</span>,
                        start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span>,id<span class="op">=</span><span class="st">"id"</span>,names.count<span class="op">=</span><span class="st">"Count"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">covrp</span><span class="op">)</span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># with strata, each strata in matrix column, provides basis for fast Bootstrap</span>
<span class="va">covrpS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covarianceRecurrent.html">covarianceRecurrentS</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,status<span class="op">=</span><span class="st">"status"</span>,death<span class="op">=</span><span class="st">"death"</span>,
        start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span>,strata<span class="op">=</span><span class="st">"strata"</span>,id<span class="op">=</span><span class="st">"id"</span>,names.count<span class="op">=</span><span class="st">"Count"</span><span class="op">)</span></code></pre></div>
</div>
<div id="bootstrap-standard-errors-for-terms" class="section level2">
<h2 class="hasAnchor">
<a href="#bootstrap-standard-errors-for-terms" class="anchor"></a>Bootstrap standard errors for terms</h2>
<p>First fitting the model again to get our estimates of interst, and then computing them for some specific time-points</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">5000</span>,<span class="fl">500</span><span class="op">)</span>

<span class="va">coo1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covarianceRecurrent.html">covarianceRecurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,status<span class="op">=</span><span class="st">"status"</span>,start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span><span class="op">)</span>
<span class="co">#</span>
<span class="va">mug</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timereg/man/internal-addreg.html">Cpred</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">coo1</span><span class="op">$</span><span class="va">time</span>,<span class="va">coo1</span><span class="op">$</span><span class="va">EN1N2</span><span class="op">)</span>,<span class="va">times</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
<span class="va">mui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timereg/man/internal-addreg.html">Cpred</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">coo1</span><span class="op">$</span><span class="va">time</span>,<span class="va">coo1</span><span class="op">$</span><span class="va">EIN1N2</span><span class="op">)</span>,<span class="va">times</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
<span class="va">mu2.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timereg/man/internal-addreg.html">Cpred</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">coo1</span><span class="op">$</span><span class="va">time</span>,<span class="va">coo1</span><span class="op">$</span><span class="va">mu2.1</span><span class="op">)</span>,<span class="va">times</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
<span class="va">mu2.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timereg/man/internal-addreg.html">Cpred</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">coo1</span><span class="op">$</span><span class="va">time</span>,<span class="va">coo1</span><span class="op">$</span><span class="va">mu2.i</span><span class="op">)</span>,<span class="va">times</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
<span class="va">mu1.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timereg/man/internal-addreg.html">Cpred</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">coo1</span><span class="op">$</span><span class="va">time</span>,<span class="va">coo1</span><span class="op">$</span><span class="va">mu1.2</span><span class="op">)</span>,<span class="va">times</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
<span class="va">mu1.i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timereg/man/internal-addreg.html">Cpred</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">coo1</span><span class="op">$</span><span class="va">time</span>,<span class="va">coo1</span><span class="op">$</span><span class="va">mu1.i</span><span class="op">)</span>,<span class="va">times</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">times</span>,<span class="va">mu2.1</span>,<span class="va">mu2.i</span><span class="op">)</span>
<span class="co">#&gt;       times      mu2.1     mu2.i</span>
<span class="co">#&gt;  [1,]   500 0.04601324 0.0469160</span>
<span class="co">#&gt;  [2,]  1000 0.12705524 0.1222740</span>
<span class="co">#&gt;  [3,]  1500 0.29919770 0.2835838</span>
<span class="co">#&gt;  [4,]  2000 0.43135081 0.4166259</span>
<span class="co">#&gt;  [5,]  2500 0.58158096 0.5852313</span>
<span class="co">#&gt;  [6,]  3000 0.84804339 0.8321718</span>
<span class="co">#&gt;  [7,]  3500 1.19574502 1.2019577</span>
<span class="co">#&gt;  [8,]  4000 1.30500870 1.3291303</span>
<span class="co">#&gt;  [9,]  4500 1.37519751 1.3922222</span>
<span class="co">#&gt; [10,]  5000 1.51861512 1.5428956</span>
<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">times</span>,<span class="va">mu1.2</span>,<span class="va">mu1.i</span><span class="op">)</span>
<span class="co">#&gt;       times      mu1.2      mu1.i</span>
<span class="co">#&gt;  [1,]   500 0.03200902 0.04064835</span>
<span class="co">#&gt;  [2,]  1000 0.10204628 0.11504194</span>
<span class="co">#&gt;  [3,]  1500 0.21613882 0.23963895</span>
<span class="co">#&gt;  [4,]  2000 0.38233417 0.39337191</span>
<span class="co">#&gt;  [5,]  2500 0.50852920 0.53313875</span>
<span class="co">#&gt;  [6,]  3000 0.68783945 0.70336553</span>
<span class="co">#&gt;  [7,]  3500 0.87422247 0.88788963</span>
<span class="co">#&gt;  [8,]  4000 1.06669018 1.08096281</span>
<span class="co">#&gt;  [9,]  4500 1.19001756 1.19203550</span>
<span class="co">#&gt; [10,]  5000 1.29633583 1.28547399</span></code></pre></div>
<p>To get the bootstrap standard errors there is a quick memory demanding function (with S for speed and strata) BootcovariancerecurrenceS and slow function that goes through the loops in R Bootcovariancerecurrence.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covarianceRecurrent.html">BootcovariancerecurrenceS</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,status<span class="op">=</span><span class="st">"status"</span>,start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span>,K<span class="op">=</span><span class="fl">100</span>,times<span class="op">=</span><span class="va">times</span><span class="op">)</span>
<span class="co">#bt1 &lt;- Bootcovariancerecurrence(rr,1,2,status="status",start="entry",stop="time",K=K,times=times)</span>

<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>bt1<span class="op">=</span><span class="va">bt1</span>,mug<span class="op">=</span><span class="va">mug</span>,mui<span class="op">=</span><span class="va">mui</span>,
               bse.mug<span class="op">=</span><span class="va">bt1</span><span class="op">$</span><span class="va">se.mug</span>,bse.mui<span class="op">=</span><span class="va">bt1</span><span class="op">$</span><span class="va">se.mui</span>,
               dmugi<span class="op">=</span><span class="va">mug</span><span class="op">-</span><span class="va">mui</span>,
    bse.dmugi<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">bt1</span><span class="op">$</span><span class="va">EN1N2</span><span class="op">-</span><span class="va">bt1</span><span class="op">$</span><span class="va">EIN1N2</span>,<span class="fl">1</span>,<span class="va">sd</span><span class="op">)</span>,
    mu2.1 <span class="op">=</span> <span class="va">mu2.1</span> , mu2.i <span class="op">=</span> <span class="va">mu2.i</span> , dmu2.i<span class="op">=</span><span class="va">mu2.1</span><span class="op">-</span><span class="va">mu2.i</span>,
    mu1.2 <span class="op">=</span> <span class="va">mu1.2</span> , mu1.i <span class="op">=</span> <span class="va">mu1.i</span> , dmu1.i<span class="op">=</span><span class="va">mu1.2</span><span class="op">-</span><span class="va">mu1.i</span>,
    bse.mu2.1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">bt1</span><span class="op">$</span><span class="va">mu2.i</span>,<span class="fl">1</span>,<span class="va">sd</span><span class="op">)</span>, bse.mu2.1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">bt1</span><span class="op">$</span><span class="va">mu2.1</span>,<span class="fl">1</span>,<span class="va">sd</span><span class="op">)</span>,
    bse.dmu2.i<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">bt1</span><span class="op">$</span><span class="va">mu2.1</span><span class="op">-</span><span class="va">bt1</span><span class="op">$</span><span class="va">mu2.i</span>,<span class="fl">1</span>,<span class="va">sd</span><span class="op">)</span>,
    bse.mu1.2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">bt1</span><span class="op">$</span><span class="va">mu1.2</span>,<span class="fl">1</span>,<span class="va">sd</span><span class="op">)</span>, bse.mu1.i<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">bt1</span><span class="op">$</span><span class="va">mu1.i</span>,<span class="fl">1</span>,<span class="va">sd</span><span class="op">)</span>,
    bse.dmu1.i<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">bt1</span><span class="op">$</span><span class="va">mu1.2</span><span class="op">-</span><span class="va">bt1</span><span class="op">$</span><span class="va">mu1.i</span>,<span class="fl">1</span>,<span class="va">sd</span><span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<p>We then look at the test for overall dependence in the different time-points. We here have no suggestion of dependence.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tt</span>  <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">dmugi</span><span class="op">/</span><span class="va">output</span><span class="op">$</span><span class="va">bse.dmugi</span>
<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">times</span>,<span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;       times          </span>
<span class="co">#&gt;  [1,]   500 0.2095830</span>
<span class="co">#&gt;  [2,]  1000 0.5531759</span>
<span class="co">#&gt;  [3,]  1500 0.7486746</span>
<span class="co">#&gt;  [4,]  2000 0.8873643</span>
<span class="co">#&gt;  [5,]  2500 0.3612170</span>
<span class="co">#&gt;  [6,]  3000 0.9931213</span>
<span class="co">#&gt;  [7,]  3500 0.7104815</span>
<span class="co">#&gt;  [8,]  4000 0.4840412</span>
<span class="co">#&gt;  [9,]  4500 0.7458429</span>
<span class="co">#&gt; [10,]  5000 0.8300532</span></code></pre></div>
<p>We can also take out the specific components for whether <span class="math inline">\(N_1\)</span> is predictive for <span class="math inline">\(N_2\)</span> and vice versa. We here have no suggestion of dependence.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t21</span>  <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">dmu1.i</span><span class="op">/</span><span class="va">output</span><span class="op">$</span><span class="va">bse.dmu1.i</span> 
<span class="va">t12</span>  <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">dmu2.i</span><span class="op">/</span><span class="va">output</span><span class="op">$</span><span class="va">bse.dmu2.i</span> 
<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">times</span>,<span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">t21</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">t12</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;       times                    </span>
<span class="co">#&gt;  [1,]   500 0.1001725 0.8817548</span>
<span class="co">#&gt;  [2,]  1000 0.1848142 0.6437858</span>
<span class="co">#&gt;  [3,]  1500 0.1062231 0.3945859</span>
<span class="co">#&gt;  [4,]  2000 0.5790327 0.4393874</span>
<span class="co">#&gt;  [5,]  2500 0.2595644 0.8699370</span>
<span class="co">#&gt;  [6,]  3000 0.5620673 0.5445263</span>
<span class="co">#&gt;  [7,]  3500 0.6523147 0.8648893</span>
<span class="co">#&gt;  [8,]  4000 0.6793768 0.5280303</span>
<span class="co">#&gt;  [9,]  4500 0.9564647 0.6660893</span>
<span class="co">#&gt; [10,]  5000 0.7898194 0.5635499</span></code></pre></div>
<p>We finally plot the boostrap samples</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html">matplot</a></span><span class="op">(</span><span class="va">bt1</span><span class="op">$</span><span class="va">time</span>,<span class="va">bt1</span><span class="op">$</span><span class="va">EN1N2</span>,type<span class="op">=</span><span class="st">"l"</span>,lwd<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html">matplot</a></span><span class="op">(</span><span class="va">bt1</span><span class="op">$</span><span class="va">time</span>,<span class="va">bt1</span><span class="op">$</span><span class="va">EIN1N2</span>,type<span class="op">=</span><span class="st">"l"</span>,lwd<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
</div>
</div>
<div id="looking-at-other-simulations-with-dependence" class="section level1">
<h1 class="hasAnchor">
<a href="#looking-at-other-simulations-with-dependence" class="anchor"></a>Looking at other simulations with dependence</h1>
<p>Using the normally distributed random effects we plot 4 different settings. We have variance <span class="math inline">\(0.5\)</span> for all random effects and change the correlation. We let the correlation between the random effect associated with <span class="math inline">\(N_1\)</span> and <span class="math inline">\(N_2\)</span> be denoted <span class="math inline">\(\rho_{12}\)</span> and the correlation between the random effects associated between <span class="math inline">\(N_j\)</span> and <span class="math inline">\(D\)</span> the terminal event be denoted as <span class="math inline">\(\rho_{j3}\)</span>, and organize all correlation in a vector <span class="math inline">\(\rho=(\rho_{12},\rho_{13},\rho_{23})\)</span>.</p>
<ul>
<li>Scenario I <span class="math inline">\(\rho=(0,0.0,0.0)\)</span> Independence among all efects.</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">base1cumhaz</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">base4cumhaz</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">drcumhaz</span><span class="op">)</span>
  <span class="va">dr</span> <span class="op">&lt;-</span> <span class="va">drcumhaz</span>
  <span class="va">base1</span> <span class="op">&lt;-</span> <span class="va">base1cumhaz</span>
  <span class="va">base4</span> <span class="op">&lt;-</span> <span class="va">base4cumhaz</span>

  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
  <span class="va">var.z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span>
  <span class="co"># death related to  both causes in same way </span>
  <span class="va">cor.mat</span> <span class="op">&lt;-</span> <span class="va">corM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">1.0</span>, <span class="fl">0.0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span>
  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simRecurrentII.html">simRecurrentII</a></span><span class="op">(</span><span class="fl">3000</span>,<span class="va">base1</span>,<span class="va">base4</span>,death.cumhaz<span class="op">=</span><span class="va">dr</span>,var.z<span class="op">=</span><span class="va">var.z</span>,cor.mat<span class="op">=</span><span class="va">cor.mat</span>,dependence<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/count.history.html">count.history</a></span><span class="op">(</span><span class="va">rr</span>,types<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">rr</span>,<span class="st">"z"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;              [,1]        [,2]        [,3]</span>
<span class="co">#&gt; [1,]  1.000000000 -0.02007302 0.003790876</span>
<span class="co">#&gt; [2,] -0.020073021  1.00000000 0.038974806</span>
<span class="co">#&gt; [3,]  0.003790876  0.03897481 1.000000000</span>
  <span class="va">coo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covarianceRecurrent.html">covarianceRecurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,status<span class="op">=</span><span class="st">"status"</span>,start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">coo</span>,main <span class="op">=</span><span class="st">"Scenario I"</span><span class="op">)</span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-22-1.png" width="700"> * Scenario II <span class="math inline">\(\rho=(0,0.5,0.5)\)</span> Independence among survivors but dependence on terminal event</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">var.z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span>
  <span class="co"># death related to  both causes in same way </span>
  <span class="va">cor.mat</span> <span class="op">&lt;-</span> <span class="va">corM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">0.0</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">1.0</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span>
  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simRecurrentII.html">simRecurrentII</a></span><span class="op">(</span><span class="fl">3000</span>,<span class="va">base1</span>,<span class="va">base4</span>,death.cumhaz<span class="op">=</span><span class="va">dr</span>,var.z<span class="op">=</span><span class="va">var.z</span>,cor.mat<span class="op">=</span><span class="va">cor.mat</span>,dependence<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/count.history.html">count.history</a></span><span class="op">(</span><span class="va">rr</span>,types<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>
  <span class="va">coo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covarianceRecurrent.html">covarianceRecurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,status<span class="op">=</span><span class="st">"status"</span>,start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">coo</span>,main <span class="op">=</span><span class="st">"Scenario II"</span><span class="op">)</span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<ul>
<li>Scenario III <span class="math inline">\(\rho=(0.5,0.5,0.5)\)</span> Positive dependence among survivors and dependence on terminal event</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">var.z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span>
  <span class="co"># positive dependence for N1 and N2 all related in same way</span>
  <span class="va">cor.mat</span> <span class="op">&lt;-</span> <span class="va">corM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span>
  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simRecurrentII.html">simRecurrentII</a></span><span class="op">(</span><span class="fl">3000</span>,<span class="va">base1</span>,<span class="va">base4</span>,death.cumhaz<span class="op">=</span><span class="va">dr</span>,var.z<span class="op">=</span><span class="va">var.z</span>,cor.mat<span class="op">=</span><span class="va">cor.mat</span>,dependence<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/count.history.html">count.history</a></span><span class="op">(</span><span class="va">rr</span>,types<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>
  <span class="va">coo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covarianceRecurrent.html">covarianceRecurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,status<span class="op">=</span><span class="st">"status"</span>,start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">coo</span>,main<span class="op">=</span><span class="st">"Scenario III"</span><span class="op">)</span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<ul>
<li>Scenario IV <span class="math inline">\(\rho=(-0.4,0.5,0.5)\)</span> Negative dependence among survivors and positive dependence on terminal event</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">var.z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span>
  <span class="co"># negative dependence for N1 and N2 all related in same way</span>
  <span class="va">cor.mat</span> <span class="op">&lt;-</span> <span class="va">corM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.4</span>, <span class="fl">1.0</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span>
  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simRecurrentII.html">simRecurrentII</a></span><span class="op">(</span><span class="fl">3000</span>,<span class="va">base1</span>,<span class="va">base4</span>,death.cumhaz<span class="op">=</span><span class="va">dr</span>,var.z<span class="op">=</span><span class="va">var.z</span>,cor.mat<span class="op">=</span><span class="va">cor.mat</span>,dependence<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/count.history.html">count.history</a></span><span class="op">(</span><span class="va">rr</span>,types<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>
  <span class="va">coo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covarianceRecurrent.html">covarianceRecurrent</a></span><span class="op">(</span><span class="va">rr</span>,<span class="fl">1</span>,<span class="fl">2</span>,status<span class="op">=</span><span class="st">"status"</span>,start<span class="op">=</span><span class="st">"entry"</span>,stop<span class="op">=</span><span class="st">"time"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">coo</span>,main<span class="op">=</span><span class="st">"Scenario IV"</span><span class="op">)</span></code></pre></div>
<p><img src="recurrent-events_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
</div>
<div id="sessioninfo" class="section level1">
<h1 class="hasAnchor">
<a href="#sessioninfo" class="anchor"></a>SessionInfo</h1>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; R version 4.1.1 (2021-08-10)</span>
<span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">#&gt; Running under: Ubuntu 20.04.3 LTS</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0</span>
<span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span>
<span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span>
<span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span>
<span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] mets_1.2.9      lava_1.6.10     timereg_2.0.0   survival_3.2-11</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] Rcpp_1.0.7          compiler_4.1.1      highr_0.9          </span>
<span class="co">#&gt;  [4] tools_4.1.1         digest_0.6.27       evaluate_0.14      </span>
<span class="co">#&gt;  [7] memoise_2.0.0       lattice_0.20-44     rlang_0.4.11       </span>
<span class="co">#&gt; [10] Matrix_1.3-4        yaml_2.2.1          parallel_4.1.1     </span>
<span class="co">#&gt; [13] mvtnorm_1.1-2       pkgdown_1.6.1       xfun_0.25          </span>
<span class="co">#&gt; [16] fastmap_1.1.0       stringr_1.4.0       knitr_1.33         </span>
<span class="co">#&gt; [19] desc_1.3.0          fs_1.5.0            systemfonts_1.0.2  </span>
<span class="co">#&gt; [22] globals_0.14.0      rprojroot_2.0.2     grid_4.1.1         </span>
<span class="co">#&gt; [25] listenv_0.8.0       R6_2.5.1            textshaping_0.3.5  </span>
<span class="co">#&gt; [28] future.apply_1.8.1  parallelly_1.27.0   rmarkdown_2.10     </span>
<span class="co">#&gt; [31] magrittr_2.0.1      codetools_0.2-18    htmltools_0.5.2    </span>
<span class="co">#&gt; [34] splines_4.1.1       future_1.22.1       numDeriv_2016.8-1.1</span>
<span class="co">#&gt; [37] ragg_1.1.3          stringi_1.7.4       cachem_1.0.6       </span>
<span class="co">#&gt; [40] crayon_1.4.1</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Klaus K. Holst, Thomas Scheike.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
