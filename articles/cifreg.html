<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cumulative Incidence Regression • mets</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Cumulative Incidence Regression">
<meta property="og:description" content="mets">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mets</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basic-dutils.html">dUtility data-frame manipulations</a>
    </li>
    <li>
      <a href="../articles/binomial-family.html">Analysis of multivariate binomial data: family analysis</a>
    </li>
    <li>
      <a href="../articles/binomial-twin.html">Analysis of bivariate binomial data: Twin analysis</a>
    </li>
    <li>
      <a href="../articles/binreg-ate.html">Average treatment effect (ATE) for Competing risks and binary outcomes</a>
    </li>
    <li>
      <a href="../articles/binreg.html">Binomial Regression</a>
    </li>
    <li>
      <a href="../articles/cifreg.html">Cumulative Incidence Regression</a>
    </li>
    <li>
      <a href="../articles/haplo-discrete-ttp.html">Haplotype Discrete Survival Models</a>
    </li>
    <li>
      <a href="../articles/interval-discrete-survival.html">Discrete Interval Censored Survival Models</a>
    </li>
    <li>
      <a href="../articles/marginal-cox.html">Marginal modelling of clustered survival data</a>
    </li>
    <li>
      <a href="../articles/mediation-survival.html">Mediation Analysis for survival data</a>
    </li>
    <li>
      <a href="../articles/quantitative-twin.html">Twin models</a>
    </li>
    <li>
      <a href="../articles/recurrent-events.html">Recurrent events</a>
    </li>
    <li>
      <a href="../articles/time-to-event-family-studies-arev.html">A practical guide to Human Genetics with Lifetime Data</a>
    </li>
    <li>
      <a href="../articles/twostage-survival.html">Analysis of multivariate survival data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kkholst/mets/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Cumulative Incidence Regression</h1>
                        <h4 data-toc-skip class="author">Klaus Holst &amp; Thomas Scheike</h4>
            
            <h4 data-toc-skip class="date">2022-09-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/kkholst/mets/blob/HEAD/vignettes/cifreg.Rmd" class="external-link"><code>vignettes/cifreg.Rmd</code></a></small>
      <div class="hidden name"><code>cifreg.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="fine-gray-model">Fine-Gray model<a class="anchor" aria-label="anchor" href="#fine-gray-model"></a>
</h2>
<p> considered <span class="math display">\[\begin{align*}
  U^{FG}_{n}(\beta) = \sum_{i=0}^{n} \int_0^{+\infty} \left( X_i- E_n(t,\beta) \right) w_i(t,X_i) dN_{1,i}(t)  \text{ where } 
    E_n(t,\beta)=\frac{\tilde S_1(t,\beta) }{\tilde S_0(t,\beta)},
\end{align*}\]</span> with <span class="math inline">\(w_i(t,X_i) = \frac{G_c(t,X_i)}{G_c(T_i \wedge t,X_i)} I( C_i &gt; T_i \wedge t )\)</span> ,<span class="math inline">\(\tilde S_k(t,\beta) = \sum_{j=1}^n X_j^k \exp(X_j^T\beta) Y_{1,j}(t)\)</span> for <span class="math inline">\(k=0,1\)</span>, and with with <span class="math inline">\(\tilde Y_{1,i}(t) = Y_{1,i}(t) w_i(t,X_i)\)</span> for <span class="math inline">\(i=1,...,n\)</span>. <span class="math inline">\(w_i(t)\)</span> needs to be replaced by an estimator of the censoring distribution, and since it does not depend on <span class="math inline">\(X\)</span> the <span class="math inline">\(\hat w_i(t) = \frac{\hat G_c(t,X_i)}{\hat G_c(T_i \wedge t,X_i)} I(C_i &gt; T_i \wedge t)\)</span> where <span class="math inline">\(\hat G_c\)</span> is the Kaplan-Meier estimator of the censoring distribution.</p>
<p>In this article we briefly introduce some functions for doing cumulative incidence regression, and how to augment the Fine-Gray estimator.</p>
<p>First we simulate some competing risks data using some utility functions.</p>
<p>We simulate data with two causes based on the Fine-Gray model: <span class="math display">\[\begin{align}
F_1(t,X) &amp;  = P(T\leq t, \epsilon=1|X)=( 1 - exp(-\Lambda_1(t) \exp(X^T \beta_1))) \\
F_2(t,X) &amp; = P(T\leq t, \epsilon=2|X)= ( 1 - exp(-\Lambda_2(t) \exp(X^T \beta_2))) 
              \cdot (1 - F_1(\infty,X))  
\end{align}\]</span> where the baselines are given as <span class="math inline">\(\Lambda_j(t) = \rho_j (1- exp(-t/\nu_j))\)</span> for <span class="math inline">\(j=1,2\)</span>, and the <span class="math inline">\(X\)</span> being two independent binomials. Alternatively, one can also replace the FG-model with a logistic link <span class="math inline">\(\mbox{expit}( \Lambda_j(t) + \exp(X^T \beta_j))\)</span>.</p>
<p>The advantage of the model is that it is easy to fit and to get standard errors, and that it is quite flexible essentially being a Cox-model. On the downside is that the coefficients are quite hard to interpret since they are the <span class="math inline">\(cloglog\)</span> coefficients of <span class="math inline">\(1-F_1(t,X)\)</span>. Specifically, <span class="math display">\[\begin{align}
\log(-\log( 1-F_1(t,X_1+1,X_2))) - \log(-\log( 1-F_1(t,X_1,X_2))) &amp; =  \beta_1,
\end{align}\]</span> so the effect is <span class="math inline">\(\beta_1\)</span> of <span class="math inline">\(X_1\)</span> is on <span class="math inline">\(1-F_1(t,X)\)</span> on the <span class="math inline">\(cloglog\)</span> scale.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kkholst.github.io/mets/" class="external-link">mets</a></span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>warn<span class="op">=</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span> <span class="co"># to control output in simulatins for p-values below.</span></span>
<span></span>
<span> <span class="va">rho1</span> <span class="op">&lt;-</span> <span class="fl">0.2</span>; <span class="va">rho2</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span> <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">400</span></span>
<span> <span class="va">beta</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>,<span class="op">-</span><span class="fl">0.1</span>,<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0.3</span><span class="op">)</span></span>
<span> <span class="co">## beta1=c(0.0,-0.1); beta2=c(-0.5,0.3)</span></span>
<span> <span class="va">dats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FG_AugmentCifstrata.html">simul.cifs</a></span><span class="op">(</span><span class="va">n</span>,<span class="va">rho1</span>,<span class="va">rho2</span>,<span class="va">beta</span>,rc<span class="op">=</span><span class="fl">0.5</span>,rate<span class="op">=</span><span class="fl">7</span><span class="op">)</span></span>
<span> <span class="fu"><a href="../reference/dtable.html">dtable</a></span><span class="op">(</span><span class="va">dats</span>,<span class="op">~</span><span class="va">status</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; status</span></span>
<span><span class="co">#&gt;   0   1   2 </span></span>
<span><span class="co">#&gt; 127  12 261</span></span>
<span> <span class="fu"><a href="../reference/dsort.html">dsort</a></span><span class="op">(</span><span class="va">dats</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">time</span></span></code></pre></div>
<p>We have a look at the non-parametric cumulative incidence curves</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="va">cifs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cif.html">cif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">Z1</span>,<span class="va">Z2</span><span class="op">)</span>,<span class="va">dats</span>,cause<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cifs1</span><span class="op">)</span></span>
<span></span>
<span> <span class="va">cifs2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cif.html">cif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">Z1</span>,<span class="va">Z2</span><span class="op">)</span>,<span class="va">dats</span>,cause<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cifs2</span><span class="op">)</span></span></code></pre></div>
<p><img src="cifreg_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>Now fitting the Fine-Gray model</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">fg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cifreg.html">cifreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">Z1</span><span class="op">+</span><span class="va">Z2</span>,data<span class="op">=</span><span class="va">dats</span>,cause<span class="op">=</span><span class="fl">1</span>,propodds<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fg</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400     12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  400 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;    Estimate     S.E.  dU^-1/2 P-value</span></span>
<span><span class="co">#&gt; Z1  0.69686  0.38760  0.38882  0.0722</span></span>
<span><span class="co">#&gt; Z2 -0.85929  0.62453  0.61478  0.1689</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;    Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; Z1  2.00744 0.93911 4.2911</span></span>
<span><span class="co">#&gt; Z2  0.42346 0.12451 1.4402</span></span>
<span></span>
<span> <span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>Z1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,Z2<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></span>
<span> <span class="va">pfg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fg</span>,<span class="va">dd</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pfg</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="cifreg_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="ses-for-the-baseline-and-predictions-of-fg">SE’s for the baseline and predictions of FG<a class="anchor" aria-label="anchor" href="#ses-for-the-baseline-and-predictions-of-fg"></a>
</h2>
<p>The standard errors reported for the FG-estimator are based on the i.i.d decompostion (influence functions) of the estimator that we give later. A similar decompostion exist for the baseline and is needed when standard errors of predictions are computed. These are a bit harder to compute for all time-points simultaneously, but they can be obtained for specific timepoints jointly with the iid decomposition of the regression coefficients and then used to get standard errors for predictions.</p>
<p>We here plot the predictions with jittered confidence intervals for the predictions at time point 5</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### predictions with CI based on iid decomposition of baseline and beta</span></span>
<span><span class="va">fg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cifreg.html">cifreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">Z1</span><span class="op">+</span><span class="va">Z2</span>,data<span class="op">=</span><span class="va">dats</span>,cause<span class="op">=</span><span class="fl">1</span>,propodds<span class="op">=</span><span class="cn">NULL</span>,cox.prep<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Biid</span> <span class="op">&lt;-</span> <span class="fu">mets</span><span class="fu">:::</span><span class="fu"><a href="../reference/cifreg.html">iid.baseline.cifreg</a></span><span class="op">(</span><span class="va">fg</span>,time<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">pfgse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cifreg.html">FGprediid</a></span><span class="op">(</span><span class="va">Biid</span>,<span class="va">dd</span><span class="op">)</span></span>
<span><span class="va">pfgse</span></span>
<span><span class="co">#&gt;            pred    se-log       lower     upper</span></span>
<span><span class="co">#&gt; [1,] 0.04253879 0.7418354 0.009938793 0.1820692</span></span>
<span><span class="co">#&gt; [2,] 0.16069100 0.3946377 0.074143886 0.3482633</span></span>
<span><span class="co">#&gt; [3,] 0.01823957 0.9410399 0.002884032 0.1153531</span></span>
<span><span class="co">#&gt; [4,] 0.07149610 0.4611261 0.028958169 0.1765199</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pfg</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span><span class="op">)</span><span class="op">+</span><span class="va">i</span><span class="op">/</span><span class="fl">10</span>,<span class="va">pfgse</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>,col<span class="op">=</span><span class="va">i</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="cifreg_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>The iid decompostions are stored inside Biid, in addition we note that the iid decompostions for <span class="math inline">\(\hat \beta - \beta_0\)</span> are obtained by the command iid()</p>
</div>
<div class="section level2">
<h2 id="comparison">Comparison<a class="anchor" aria-label="anchor" href="#comparison"></a>
</h2>
<p>We compare with the cmprsk function but without running it to avoid dependencies:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.R-project.org" class="external-link">cmprsk</a></span><span class="op">)</span></span>
<span> <span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">Z1</span><span class="op">+</span><span class="va">Z2</span>,<span class="va">dats</span><span class="op">)</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span> <span class="va">cr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">dats</span>,<span class="fu"><a href="https://rdrr.io/pkg/cmprsk/man/crr.html" class="external-link">crr</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span>,<span class="va">mm</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">cr</span><span class="op">$</span><span class="va">coef</span>,<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">cr</span><span class="op">$</span><span class="va">var</span><span class="op">)</span><span class="op">^</span><span class="fl">.5</span>,<span class="va">fg</span><span class="op">$</span><span class="va">coef</span>,<span class="va">fg</span><span class="op">$</span><span class="va">se.coef</span>,<span class="va">cr</span><span class="op">$</span><span class="va">coef</span><span class="op">-</span><span class="va">fg</span><span class="op">$</span><span class="va">coef</span>,<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">cr</span><span class="op">$</span><span class="va">var</span><span class="op">)</span><span class="op">^</span><span class="fl">.5</span><span class="op">-</span><span class="va">fg</span><span class="op">$</span><span class="va">se.coef</span><span class="op">)</span></span>
<span><span class="co">#          [,1]      [,2]       [,3]      [,4]          [,5]          [,6]</span></span>
<span><span class="co"># Z1  0.6968603 0.3876029  0.6968603 0.3876029 -1.534155e-09 -7.811395e-10</span></span>
<span><span class="co"># Z2 -0.8592892 0.6245258 -0.8592892 0.6245258  8.537615e-14  4.430734e-11</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="va">fg0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cifreg.html">cifreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">Z1</span><span class="op">+</span><span class="va">Z2</span>,data<span class="op">=</span><span class="va">dats</span>,cause<span class="op">=</span><span class="fl">1</span>,propodds<span class="op">=</span><span class="cn">NULL</span>,beta<span class="op">=</span><span class="va">cr</span><span class="op">$</span><span class="va">coef</span>,no.opt<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">cr</span><span class="op">$</span><span class="va">var</span><span class="op">)</span><span class="op">^</span><span class="fl">.5</span>,<span class="va">fg0</span><span class="op">$</span><span class="va">se.coef</span>,<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">cr</span><span class="op">$</span><span class="va">var</span><span class="op">)</span><span class="op">^</span><span class="fl">.5</span><span class="op">-</span><span class="va">fg0</span><span class="op">$</span><span class="va">se.coef</span><span class="op">)</span></span>
<span><span class="co">#           [,1]      [,2]          [,3]</span></span>
<span><span class="co"># [1,] 0.3876029 0.3876029 -8.881784e-16</span></span>
<span><span class="co"># [2,] 0.6245258 0.6245258  3.330669e-16</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>When comparing with the results from the coxph based on setting up the data using the finegray function, we get the same estimates but note that the standard errors of the coxph is missing a term and therefore slightly different. When comparing to the estimates from coxph missing the additional censoring term we see that we get also the same standard errors</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="va">dats</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dats</span><span class="op">)</span></span>
<span> <span class="va">dats</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dats</span><span class="op">$</span><span class="va">status</span>,<span class="fl">0</span><span class="op">:</span><span class="fl">2</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"censor"</span>, <span class="st">"death"</span>, <span class="st">"other"</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="va">fgdats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/finegray.html" class="external-link">finegray</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">event</span><span class="op">)</span><span class="op">~</span><span class="va">.</span>,data<span class="op">=</span><span class="va">dats</span><span class="op">)</span></span>
<span> <span class="va">coxfg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">fgstart</span>, <span class="va">fgstop</span>, <span class="va">fgstatus</span><span class="op">)</span> <span class="op">~</span> <span class="va">Z1</span><span class="op">+</span><span class="va">Z2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>, weight<span class="op">=</span><span class="va">fgwt</span>, data<span class="op">=</span><span class="va">fgdats</span><span class="op">)</span></span>
<span></span>
<span> <span class="va">fg0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cifreg.html">cifreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">Z1</span><span class="op">+</span><span class="va">Z2</span>,data<span class="op">=</span><span class="va">dats</span>,cause<span class="op">=</span><span class="fl">1</span>,propodds<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="va">coxfg</span><span class="op">$</span><span class="va">coef</span>,<span class="va">fg0</span><span class="op">$</span><span class="va">coef</span>, <span class="va">coxfg</span><span class="op">$</span><span class="va">coef</span><span class="op">-</span><span class="va">fg0</span><span class="op">$</span><span class="va">coef</span><span class="op">)</span></span>
<span><span class="co">#          [,1]       [,2]          [,3]</span></span>
<span><span class="co"># Z1  0.6968603  0.6968603 -1.534153e-09</span></span>
<span><span class="co"># Z2 -0.8592892 -0.8592892  8.726353e-14</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">coxfg</span><span class="op">$</span><span class="va">var</span><span class="op">)</span><span class="op">^</span><span class="fl">.5</span>,<span class="va">fg0</span><span class="op">$</span><span class="va">se.coef</span>,<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">coxfg</span><span class="op">$</span><span class="va">var</span><span class="op">)</span><span class="op">^</span><span class="fl">.5</span><span class="op">-</span><span class="va">fg0</span><span class="op">$</span><span class="va">se.coef</span><span class="op">)</span></span>
<span><span class="co">#           [,1]      [,2]          [,3]</span></span>
<span><span class="co"># [1,] 0.3889129 0.3876029  0.0013099907</span></span>
<span><span class="co"># [2,] 0.6241225 0.6245258 -0.0004033148</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">coxfg</span><span class="op">$</span><span class="va">var</span><span class="op">)</span><span class="op">^</span><span class="fl">.5</span>,<span class="va">fg0</span><span class="op">$</span><span class="va">se1.coef</span>,<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">coxfg</span><span class="op">$</span><span class="va">var</span><span class="op">)</span><span class="op">^</span><span class="fl">.5</span><span class="op">-</span><span class="va">fg0</span><span class="op">$</span><span class="va">se1.coef</span><span class="op">)</span></span>
<span><span class="co">#           [,1]      [,2]          [,3]</span></span>
<span><span class="co"># [1,] 0.3889129 0.3889129 -7.839487e-10</span></span>
<span><span class="co"># [2,] 0.6241225 0.6241225  4.448153e-11</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We also remove all censorings from the data to compare the estimates with those based on coxph, and observe that the estimates as well as the standard errors agree</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datsnc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dtransform.html">dtransform</a></span><span class="op">(</span><span class="va">dats</span>,status<span class="op">=</span><span class="fl">2</span>,<span class="va">status</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dtable.html">dtable</a></span><span class="op">(</span><span class="va">datsnc</span>,<span class="op">~</span><span class="va">status</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; status</span></span>
<span><span class="co">#&gt;   1   2 </span></span>
<span><span class="co">#&gt;  12 388</span></span>
<span><span class="va">datsnc</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span></span>
<span><span class="va">datsnc</span><span class="op">$</span><span class="va">entry</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dats</span><span class="op">$</span><span class="va">time</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span></span>
<span><span class="co">## for cause 2 add risk interaval </span></span>
<span><span class="va">datsnc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">datsnc</span>,<span class="va">status</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">datsnc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">datsnc2</span>,entry<span class="op">=</span><span class="va">time</span><span class="op">)</span></span>
<span><span class="va">datsnc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">datsnc2</span>,time<span class="op">=</span><span class="va">max</span><span class="op">)</span></span>
<span><span class="va">datsncf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">datsnc</span>,<span class="va">datsnc2</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="va">cifnc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cifreg.html">cifreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">Z1</span><span class="op">+</span><span class="va">Z2</span>,data<span class="op">=</span><span class="va">datsnc</span>,cause<span class="op">=</span><span class="fl">1</span>,propodds<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">cc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">entry</span>,<span class="va">time</span>,<span class="va">status</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">~</span><span class="va">Z1</span><span class="op">+</span><span class="va">Z2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,<span class="va">datsncf</span>,robust<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">cifnc</span><span class="op">$</span><span class="va">coef</span>,<span class="va">cifnc</span><span class="op">$</span><span class="va">se.coef</span>, <span class="va">cc</span><span class="op">$</span><span class="va">coef</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">cc</span><span class="op">$</span><span class="va">var</span><span class="op">)</span><span class="op">^</span><span class="fl">.5</span><span class="op">)</span></span>
<span><span class="co">#&gt;          [,1]      [,2]       [,3]      [,4]</span></span>
<span><span class="co">#&gt; Z1  0.7376223 0.3962877  0.7376223 0.3962877</span></span>
<span><span class="co">#&gt; Z2 -0.8211457 0.6308807 -0.8211457 0.6308807</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">cifnc</span><span class="op">$</span><span class="va">coef</span><span class="op">-</span><span class="va">cc</span><span class="op">$</span><span class="va">coef</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">cc</span><span class="op">$</span><span class="va">var</span><span class="op">)</span><span class="op">^</span><span class="fl">.5</span><span class="op">-</span><span class="va">cifnc</span><span class="op">$</span><span class="va">se.coef</span><span class="op">)</span></span>
<span><span class="co">#&gt;            [,1]          [,2]</span></span>
<span><span class="co">#&gt; Z1 2.053291e-09 -1.048035e-09</span></span>
<span><span class="co">#&gt; Z2 1.915135e-13  7.571810e-11</span></span></code></pre></div>
<p>the cmprsk gives something slightly-slightly different</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.R-project.org" class="external-link">cmprsk</a></span><span class="op">)</span></span>
<span> <span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">Z1</span><span class="op">+</span><span class="va">Z2</span>,<span class="va">datsnc</span><span class="op">)</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span> <span class="va">cr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">datsnc</span>,<span class="fu"><a href="https://rdrr.io/pkg/cmprsk/man/crr.html" class="external-link">crr</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span>,<span class="va">mm</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">cifnc</span><span class="op">$</span><span class="va">coef</span><span class="op">-</span><span class="va">cr</span><span class="op">$</span><span class="va">coef</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">cr</span><span class="op">$</span><span class="va">var</span><span class="op">)</span><span class="op">^</span><span class="fl">.5</span><span class="op">-</span><span class="va">cifnc</span><span class="op">$</span><span class="va">se.coef</span><span class="op">)</span></span>
<span><span class="co">#            [,1]          [,2]</span></span>
<span><span class="co"># Z1 2.053291e-09 -1.048037e-09</span></span>
<span><span class="co"># Z2 1.926237e-13  7.571876e-11</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="strata-dependent-censoring-weights">Strata dependent Censoring weights<a class="anchor" aria-label="anchor" href="#strata-dependent-censoring-weights"></a>
</h2>
<p>We can improve efficiency and avoid bias by allowing the censoring weights to depend on the covariates</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">fgcm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cifreg.html">cifreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">Z1</span><span class="op">+</span><span class="va">Z2</span>,data<span class="op">=</span><span class="va">dats</span>,cause<span class="op">=</span><span class="fl">1</span>,propodds<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>        cens.model<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">Z1</span>,<span class="va">Z2</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fgcm</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400     12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  400 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;    Estimate     S.E.  dU^-1/2 P-value</span></span>
<span><span class="co">#&gt; Z1  0.54277  0.37188  0.39352  0.1444</span></span>
<span><span class="co">#&gt; Z2 -0.91846  0.61886  0.61447  0.1378</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;    Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; Z1  1.72077 0.83019 3.5667</span></span>
<span><span class="co">#&gt; Z2  0.39913 0.11867 1.3424</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fg</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400     12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  400 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;    Estimate     S.E.  dU^-1/2 P-value</span></span>
<span><span class="co">#&gt; Z1  0.69686  0.38760  0.38882  0.0722</span></span>
<span><span class="co">#&gt; Z2 -0.85929  0.62453  0.61478  0.1689</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;    Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; Z1  2.00744 0.93911 4.2911</span></span>
<span><span class="co">#&gt; Z2  0.42346 0.12451 1.4402</span></span></code></pre></div>
<p>We note that the standard errors are slightly smaller for the more efficient estimator.</p>
<p>The influence functions of the FG-estimator is given by ,<br><span class="math display">\[\begin{align*}
\phi_i^{FG}  &amp; = \int (X_i- e(t))  \tilde w_i(t) dM_{i1}(t,X_i)  + \int \frac{q(t)}{\pi(t)} dM_{ic}(t),  \\
             &amp; = \phi_i^{FG,1}  + \phi_i^{FG,2},
\end{align*}\]</span> where the first term is what would be achieved for a known censoring distribution, and the second term is due to the variability from the Kaplan-Meier estimator. Where <span class="math inline">\(M_{ic}(t) = N_{ic}(t) - \int_0^t Y_i(s) d\Lambda_c (s)\)</span> with <span class="math inline">\(M_{ic}\)</span> the standard censoring martingale.</p>
<p>The function <span class="math inline">\(q(t)\)</span> that reflects that the censoring only affects the terms related to cause “2” jumps, can be written as (see Appendix B2) <span class="math display">\[\begin{align*} 
    q(t) &amp; =   E( H(t,X) I(T  \leq t, \epsilon=2) I(C &gt; T)/G_c(T)) = E( H(t,X) F_2(t,X) ), 
\end{align*}\]</span> with <span class="math inline">\(H(t,X) = \int_t^{\infty} (X- e(s)) G(s) d \Lambda_1(s,X)\)</span> and since <span class="math inline">\(\pi(t)=E(Y(t))=S(t) G_c(t)\)</span>.</p>
<p>In the case where the censoring weights are stratified (based on <span class="math inline">\(X\)</span>) we get the influence functions related to the censoring term with <span class="math display">\[\begin{align*} 
    q(t,X) &amp; =   E( H(t,X) I(T  \leq t, \epsilon=2) I(T &lt; C)/G_c(T,X) | X) = H(t,X) F_2(t,X), 
\end{align*}\]</span> so that the influence function becomes <span class="math display">\[\begin{align*}
\int (X-e(t)) w(t) dM_1(t,X) +  \int H(t,X) \frac{F_2(t,X)}{S(t,X)} \frac{1}{G_c(t,X)} dM_c(t,X).
\end{align*}\]</span> with <span class="math inline">\(H(t,X) = \int_t^{\infty} (X- e(s)) G(s,X) d \Lambda_1(s,X)\)</span>.</p>
</div>
<div class="section level2">
<h2 id="augmenting-the-fg-estimator">Augmenting the FG-estimator<a class="anchor" aria-label="anchor" href="#augmenting-the-fg-estimator"></a>
</h2>
<p>Rather than using a larger censoring model we can also compute the augmentation term directly and then fit the FG-model based on this augmentation term and do a couple of iterations</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">fgaugS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FG_AugmentCifstrata.html">FG_AugmentCifstrata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">Z1</span><span class="op">+</span><span class="va">Z2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">Z1</span>,<span class="va">Z2</span><span class="op">)</span>,data<span class="op">=</span><span class="va">dats</span>,cause<span class="op">=</span><span class="fl">1</span>,E<span class="op">=</span><span class="va">fg</span><span class="op">$</span><span class="va">E</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fgaugS</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400     12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  400 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;    Estimate     S.E.  dU^-1/2 P-value</span></span>
<span><span class="co">#&gt; Z1  0.55614  0.29861  0.35607  0.0625</span></span>
<span><span class="co">#&gt; Z2 -0.88438  0.61209  0.62011  0.1485</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;    Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; Z1  1.74392 0.97128 3.1312</span></span>
<span><span class="co">#&gt; Z2  0.41297 0.12442 1.3707</span></span>
<span></span>
<span>  <span class="va">fgaugS2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FG_AugmentCifstrata.html">FG_AugmentCifstrata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">Z1</span><span class="op">+</span><span class="va">Z2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">Z1</span>,<span class="va">Z2</span><span class="op">)</span>,data<span class="op">=</span><span class="va">dats</span>,cause<span class="op">=</span><span class="fl">1</span>,E<span class="op">=</span><span class="va">fgaugS</span><span class="op">$</span><span class="va">E</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fgaugS2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400     12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  400 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;    Estimate     S.E.  dU^-1/2 P-value</span></span>
<span><span class="co">#&gt; Z1  0.56000  0.29957  0.35687  0.0616</span></span>
<span><span class="co">#&gt; Z2 -0.88347  0.61172  0.61993  0.1487</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;    Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; Z1  1.75068 0.97321 3.1492</span></span>
<span><span class="co">#&gt; Z2  0.41335 0.12463 1.3709</span></span>
<span></span>
<span>  <span class="va">fgaugS3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FG_AugmentCifstrata.html">FG_AugmentCifstrata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">Z1</span><span class="op">+</span><span class="va">Z2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">Z1</span>,<span class="va">Z2</span><span class="op">)</span>,data<span class="op">=</span><span class="va">dats</span>,cause<span class="op">=</span><span class="fl">1</span>,E<span class="op">=</span><span class="va">fgaugS2</span><span class="op">$</span><span class="va">E</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fgaugS3</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400     12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  400 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;    Estimate     S.E.  dU^-1/2 P-value</span></span>
<span><span class="co">#&gt; Z1  0.55989  0.29954  0.35685  0.0616</span></span>
<span><span class="co">#&gt; Z2 -0.88350  0.61173  0.61994  0.1487</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;    Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; Z1  1.75047 0.97317 3.1487</span></span>
<span><span class="co">#&gt; Z2  0.41333 0.12462 1.3709</span></span></code></pre></div>
<p>Again we note slightly smaller standard errors when augmenting the estimator.</p>
<p>The function  compute the augmentation term for fixed <span class="math inline">\(E(t)\)</span> based on the current <span class="math inline">\(\hat \beta\)</span> <span class="math display">\[\begin{align*}
 U_n^{A} = \sum_{i=1}^n \int_{0}^{+\infty}  \frac{F_2(t,X_i)}{S(t,X_i)G_c(t,X_i)}  
    H(t,X_i,E,G_c,\Lambda_1)  dM_{ci}(t)
\end{align*}\]</span> using working models based on stratification to get <span class="math inline">\(F_1^s\)</span> and <span class="math inline">\(F_2^s\)</span> where the strata are given by <span class="math inline">\(strata()\)</span> in the call. Then fits the FG model so solve the <span class="math display">\[\begin{align*}
 U_n^{A}(\beta_p)  + U^{FG}_{n}(\beta) = 0. 
\end{align*}\]</span></p>
<p>Then we may iterate to get a solution to the augmented score equation <span class="math display">\[\begin{align*}
 U_n^{A}(\beta_\infty)  + U^{FG}_{n}(\beta_\infty) = 0.
\end{align*}\]</span></p>
<p>The censoring model here is one overall Kaplan-Meier.</p>
<p>The influence funtion for the augmented estimator is <span class="math display">\[\begin{align*}
\int (X-e(t)) w(t) dM_1(t,X) +  \int H(t,X) \frac{F_2(t,X)}{S(t,X)} \frac{1}{G_c(t)} dM_c.
\end{align*}\]</span> and standard errors are based on this formula.</p>
</div>
<div class="section level2">
<h2 id="logistic-link">Logistic-link<a class="anchor" aria-label="anchor" href="#logistic-link"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">rho1</span> <span class="op">&lt;-</span> <span class="fl">0.2</span>; <span class="va">rho2</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span> <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">400</span></span>
<span> <span class="va">beta</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>,<span class="op">-</span><span class="fl">0.1</span>,<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0.3</span><span class="op">)</span></span>
<span> <span class="va">dats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FG_AugmentCifstrata.html">simul.cifs</a></span><span class="op">(</span><span class="va">n</span>,<span class="va">rho1</span>,<span class="va">rho2</span>,<span class="va">beta</span>,rc<span class="op">=</span><span class="fl">0.5</span>,rate<span class="op">=</span><span class="fl">7</span>,type<span class="op">=</span><span class="st">"logistic"</span><span class="op">)</span></span>
<span> <span class="fu"><a href="../reference/dtable.html">dtable</a></span><span class="op">(</span><span class="va">dats</span>,<span class="op">~</span><span class="va">status</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; status</span></span>
<span><span class="co">#&gt;   0   1   2 </span></span>
<span><span class="co">#&gt; 166  13 221</span></span>
<span> <span class="fu"><a href="../reference/dsort.html">dsort</a></span><span class="op">(</span><span class="va">dats</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">time</span></span></code></pre></div>
<p>The model where <span class="math display">\[\begin{align*}
 \mbox{logit}(F_1(t,X)) &amp; =  \alpha(t) + X^T \beta
\end{align*}\]</span> that then leads to OR interpretation of the <span class="math inline">\(F_1\)</span>, can also be fitted easily, however, the standard errors are harder to compute and only approximative (assuming that the censoring weights are known) but this gives typically only a small error. In the <span class="math inline">\({{\bf timereg}}\)</span>-package the model can be fitted using different estimators that are more efficient using different weights but this is much slower.</p>
<p>Fitting the model and getting OR’s</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">or</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cifreg.html">cifreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/Event.html" class="external-link">Event</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">Z1</span><span class="op">+</span><span class="va">Z2</span>,data<span class="op">=</span><span class="va">dats</span>,cause<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">or</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n events</span></span>
<span><span class="co">#&gt;  400     13</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  400 clusters</span></span>
<span><span class="co">#&gt; coeffients:</span></span>
<span><span class="co">#&gt;     Estimate      S.E.   dU^-1/2 P-value</span></span>
<span><span class="co">#&gt; Z1 -0.021671  0.280140  0.278754  0.9383</span></span>
<span><span class="co">#&gt; Z2  0.459416  0.581451  0.570530  0.4295</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exp(coeffients):</span></span>
<span><span class="co">#&gt;    Estimate    2.5%  97.5%</span></span>
<span><span class="co">#&gt; Z1  0.97856 0.56511 1.6945</span></span>
<span><span class="co">#&gt; Z2  1.58315 0.50651 4.9483</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sessioninfo">SessionInfo<a class="anchor" aria-label="anchor" href="#sessioninfo"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.2.1 (2022-06-23)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 20.04.4 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0</span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] mets_1.3.0     lava_1.6.10    timereg_2.0.2  survival_3.3-1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] Rcpp_1.0.9          highr_0.9           bslib_0.4.0        </span></span>
<span><span class="co">#&gt;  [4] compiler_4.2.1      jquerylib_0.1.4     tools_4.2.1        </span></span>
<span><span class="co">#&gt;  [7] digest_0.6.29       jsonlite_1.8.0      evaluate_0.16      </span></span>
<span><span class="co">#&gt; [10] memoise_2.0.1       lattice_0.20-45     rlang_1.0.5        </span></span>
<span><span class="co">#&gt; [13] Matrix_1.4-1        cli_3.3.0           parallel_4.2.1     </span></span>
<span><span class="co">#&gt; [16] yaml_2.3.5          mvtnorm_1.1-3       pkgdown_2.0.6      </span></span>
<span><span class="co">#&gt; [19] xfun_0.32           fastmap_1.1.0       stringr_1.4.1      </span></span>
<span><span class="co">#&gt; [22] knitr_1.40          desc_1.4.1          fs_1.5.2           </span></span>
<span><span class="co">#&gt; [25] sass_0.4.2          systemfonts_1.0.4   globals_0.16.1     </span></span>
<span><span class="co">#&gt; [28] rprojroot_2.0.3     grid_4.2.1          listenv_0.8.0      </span></span>
<span><span class="co">#&gt; [31] R6_2.5.1            textshaping_0.3.6   parallelly_1.32.1  </span></span>
<span><span class="co">#&gt; [34] future.apply_1.9.0  rmarkdown_2.16      purrr_0.3.4        </span></span>
<span><span class="co">#&gt; [37] magrittr_2.0.3      codetools_0.2-18    htmltools_0.5.3    </span></span>
<span><span class="co">#&gt; [40] splines_4.2.1       future_1.28.0       numDeriv_2016.8-1.1</span></span>
<span><span class="co">#&gt; [43] ragg_1.2.2          stringi_1.7.8       cachem_1.0.6</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Klaus K. Holst, Thomas Scheike.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
