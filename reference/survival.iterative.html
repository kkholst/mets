<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Survival model for multivariate survival data — survival.iterative • mets</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Survival model for multivariate survival data — survival.iterative" />
<meta property="og:description" content="Fits additive gamma frailty model 
with additive hazard condtional on the random effects
$$
\lambda_{ij} = (V_{ij}^T Z) (X_{ij}^T \alpha(t)) 
$$
The baseline \(\alpha(t)\) is profiled out using
marginal modelling adjusted for the random effects structure as in Eriksson and Scheike (2015).
One advantage of the standard frailty model is that one can deal with competing risks 
for this model.
For all models the 
standard errors do not reflect this uncertainty of the baseline estimates, and might therefore be a bit to small.
To remedy this one can do bootstrapping.
If clusters contain more than two times, we use a composite likelihood
based on the pairwise bivariate models. Can also fit a additive gamma random
effects model described in detail below.
We allow a regression structure for the indenpendent gamma distributed 
random effects  and their variances that may depend on cluster covariates. So
$$
 \theta = z_j^T \alpha
$$
where \(z\) is specified by theta.des 
The reported standard errors are based on the estimated information from the 
likelihood assuming that the marginals are known.
Can also fit a structured additive gamma random effects model, such
as the ACE, ADE model for survival data.
Now random.design specificies the random effects for each subject within a cluster. This is
a matrix of 1's and 0's with dimension n x d.  With d random effects. 
For a cluster with two subjects, we let the random.design rows be 
 \(v_1\) and \(v_2\). 
Such that the random effects for subject 
1 is $$v_1^T (Z_1,...,Z_d)$$, for d random effects. Each random effect
has an associated parameter \((\lambda_1,...,\lambda_d)\). 
By construction subjects 1's random effect are Gamma distributed with 
mean \(\lambda_j/v_1^T \lambda\)
and variance \(\lambda_j/(v_1^T \lambda)^2\). Note that the random effect 
\(v_1^T (Z_1,...,Z_d)\) has mean 1 and variance \(1/(v_1^T \lambda)\).
It is here asssumed that  \(lamtot=v_1^T \lambda\) is fixed over all clusters
as it would be for the ACE model below.
The lamtot parameter may be specified separately for some sets of the parameter
is the additive.gamma.sum (ags) matrix is specified and then lamtot for the 
j'th random effect is \(ags_j^T \lambda\).
Based on these parameters the relative contribution (the heritability, h) is 
equivalent to  the expected values of the random effects  \(\lambda_j/v_1^T \lambda\)
The DEFAULT parametrization uses the variances of the random effecs 
$$
\theta_j  = \lambda_j/(v_1^T \lambda)^2
$$
For alternative parametrizations one can specify how the parameters relate to \(\lambda_j\)
with the function
Given the random effects the survival distributions with a cluster are independent and
on the form 
$$
P(T &amp;gt; t| x,z) = exp( -Z  A(t) \exp( Z^t beta))
$$
The parameters \((\lambda_1,...,\lambda_d)\)
are related to the parameters of the model
by a regression construction \(pard\) (d x k), that links the \(d\) 
\(\lambda\) parameters
with the (k) underlying \(\theta\) parameters 
$$
\lambda = theta.des  \theta 
$$
here using theta.des to specify these low-dimension association. Default is a diagonal matrix.
The case.control option that can be used with the pair specification of the pairwise parts
of the estimating equations. Here it is assumed that the second subject of each pair is the
proband." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mets</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/basic-dutils.html">dUtility data-frame manipulations</a>
    </li>
    <li>
      <a href="../articles/binomial-family.html">Analysis of multivariate binomial data: family analysis</a>
    </li>
    <li>
      <a href="../articles/binomial-twin.html">Analysis of bivariate binomial data: Twin analysis</a>
    </li>
    <li>
      <a href="../articles/cifreg.html">Cumulative Incidence Regression</a>
    </li>
    <li>
      <a href="../articles/marginal-cox.html">Marginal modelling of clustered survival data</a>
    </li>
    <li>
      <a href="../articles/quantitative-twin.html">Twin models</a>
    </li>
    <li>
      <a href="../articles/recurrent-events.html">Recurrent events</a>
    </li>
    <li>
      <a href="../articles/twostage-survival.html">Analysis of multivariate survival data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/kkholst/mets/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Survival model for multivariate survival data</h1>
    <small class="dont-index">Source: <a href='https://github.com/kkholst/mets/blob/master/R/twostage.R'><code>R/twostage.R</code></a></small>
    <div class="hidden name"><code>survival.iterative.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fits additive gamma frailty model 
with additive hazard condtional on the random effects
$$
\lambda_{ij} = (V_{ij}^T Z) (X_{ij}^T \alpha(t)) 
$$
The baseline \(\alpha(t)\) is profiled out using
marginal modelling adjusted for the random effects structure as in Eriksson and Scheike (2015).
One advantage of the standard frailty model is that one can deal with competing risks 
for this model.</p>
<p>For all models the 
standard errors do not reflect this uncertainty of the baseline estimates, and might therefore be a bit to small.
To remedy this one can do bootstrapping.</p>
<p>If clusters contain more than two times, we use a composite likelihood
based on the pairwise bivariate models. Can also fit a additive gamma random
effects model described in detail below.</p>
<p>We allow a regression structure for the indenpendent gamma distributed 
random effects  and their variances that may depend on cluster covariates. So
$$
 \theta = z_j^T \alpha
$$
where \(z\) is specified by theta.des 
The reported standard errors are based on the estimated information from the 
likelihood assuming that the marginals are known.</p>
<p>Can also fit a structured additive gamma random effects model, such
as the ACE, ADE model for survival data.</p>
<p>Now random.design specificies the random effects for each subject within a cluster. This is
a matrix of 1's and 0's with dimension n x d.  With d random effects. 
For a cluster with two subjects, we let the random.design rows be 
 \(v_1\) and \(v_2\). 
Such that the random effects for subject 
1 is $$v_1^T (Z_1,...,Z_d)$$, for d random effects. Each random effect
has an associated parameter \((\lambda_1,...,\lambda_d)\). 
By construction subjects 1's random effect are Gamma distributed with 
mean \(\lambda_j/v_1^T \lambda\)
and variance \(\lambda_j/(v_1^T \lambda)^2\). Note that the random effect 
\(v_1^T (Z_1,...,Z_d)\) has mean 1 and variance \(1/(v_1^T \lambda)\).
It is here asssumed that  \(lamtot=v_1^T \lambda\) is fixed over all clusters
as it would be for the ACE model below.
The lamtot parameter may be specified separately for some sets of the parameter
is the additive.gamma.sum (ags) matrix is specified and then lamtot for the 
j'th random effect is \(ags_j^T \lambda\).</p>
<p>Based on these parameters the relative contribution (the heritability, h) is 
equivalent to  the expected values of the random effects  \(\lambda_j/v_1^T \lambda\)</p>
<p>The DEFAULT parametrization uses the variances of the random effecs 
$$
\theta_j  = \lambda_j/(v_1^T \lambda)^2
$$
For alternative parametrizations one can specify how the parameters relate to \(\lambda_j\)
with the function</p>
<p>Given the random effects the survival distributions with a cluster are independent and
on the form 
$$
P(T &gt; t| x,z) = exp( -Z  A(t) \exp( Z^t beta))
$$</p>
<p>The parameters \((\lambda_1,...,\lambda_d)\)
are related to the parameters of the model
by a regression construction \(pard\) (d x k), that links the \(d\) 
\(\lambda\) parameters
with the (k) underlying \(\theta\) parameters 
$$
\lambda = theta.des  \theta 
$$
here using theta.des to specify these low-dimension association. Default is a diagonal matrix.</p>
<p>The case.control option that can be used with the pair specification of the pairwise parts
of the estimating equations. Here it is assumed that the second subject of each pair is the
proband.</p>
    </div>

    <pre class="usage"><span class='fu'>survival.iterative</span>(
  <span class='no'>margsurv</span>,
  <span class='kw'>data</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sys.parent.html'>sys.parent</a></span>(),
  <span class='kw'>score.method</span> <span class='kw'>=</span> <span class='st'>"nr"</span>,
  <span class='kw'>Nit</span> <span class='kw'>=</span> <span class='fl'>60</span>,
  <span class='kw'>detail</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>clusters</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>silent</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>control</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(),
  <span class='kw'>theta</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>theta.des</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>var.link</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>iid</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>step</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
  <span class='kw'>model</span> <span class='kw'>=</span> <span class='st'>"clayton.oakes"</span>,
  <span class='kw'>marginal.trunc</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>marginal.survival</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>marginal.status</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>strata</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>se.clusters</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>max.clust</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>numDeriv</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>random.design</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>pairs</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>pairs.rvs</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>numDeriv.method</span> <span class='kw'>=</span> <span class='st'>"simple"</span>,
  <span class='kw'>additive.gamma.sum</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>var.par</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>cr.models</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>case.control</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>ascertained</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>shut.up</span> <span class='kw'>=</span> <span class='fl'>0</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>margsurv</th>
      <td><p>Marginal model</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>data frame</p></td>
    </tr>
    <tr>
      <th>score.method</th>
      <td><p>Scoring method "nr", "nlminb", "optimize", "nlm"</p></td>
    </tr>
    <tr>
      <th>Nit</th>
      <td><p>Number of iterations</p></td>
    </tr>
    <tr>
      <th>detail</th>
      <td><p>Detail</p></td>
    </tr>
    <tr>
      <th>clusters</th>
      <td><p>Cluster variable</p></td>
    </tr>
    <tr>
      <th>silent</th>
      <td><p>Debug information</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>Weights</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>Optimization arguments</p></td>
    </tr>
    <tr>
      <th>theta</th>
      <td><p>Starting values for variance components</p></td>
    </tr>
    <tr>
      <th>theta.des</th>
      <td><p>design for dependence parameters, when pairs are given this is could be a
(pairs) x (numer of parameters)  x (max number random effects) matrix</p></td>
    </tr>
    <tr>
      <th>var.link</th>
      <td><p>Link function for variance</p></td>
    </tr>
    <tr>
      <th>iid</th>
      <td><p>Calculate i.i.d. decomposition</p></td>
    </tr>
    <tr>
      <th>step</th>
      <td><p>Step size</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>model</p></td>
    </tr>
    <tr>
      <th>marginal.trunc</th>
      <td><p>marginal left truncation probabilities</p></td>
    </tr>
    <tr>
      <th>marginal.survival</th>
      <td><p>optional vector of marginal survival probabilities</p></td>
    </tr>
    <tr>
      <th>marginal.status</th>
      <td><p>related to marginal survival probabilities</p></td>
    </tr>
    <tr>
      <th>strata</th>
      <td><p>strata for fitting, see example</p></td>
    </tr>
    <tr>
      <th>se.clusters</th>
      <td><p>for clusters for se calculation with iid</p></td>
    </tr>
    <tr>
      <th>max.clust</th>
      <td><p>max se.clusters for se calculation with iid</p></td>
    </tr>
    <tr>
      <th>numDeriv</th>
      <td><p>to get numDeriv version of second derivative, otherwise uses sum of squared score</p></td>
    </tr>
    <tr>
      <th>random.design</th>
      <td><p>random effect design for additive gamma model, when pairs are given this is
a (pairs) x (2) x (max number random effects) matrix, see pairs.rvs below</p></td>
    </tr>
    <tr>
      <th>pairs</th>
      <td><p>matrix with rows of indeces (two-columns) for the pairs considered in the pairwise
composite score, useful for case-control sampling when marginal is known.</p></td>
    </tr>
    <tr>
      <th>pairs.rvs</th>
      <td><p>for additive gamma model and random.design and theta.des are given as arrays,
this specifice number of random effects for each pair.</p></td>
    </tr>
    <tr>
      <th>numDeriv.method</th>
      <td><p>uses simple to speed up things and second derivative not so important.</p></td>
    </tr>
    <tr>
      <th>additive.gamma.sum</th>
      <td><p>for two.stage=0, this is specification of the lamtot in the models via
a matrix that is multiplied onto the parameters theta (dimensions=(number random effects x number
of theta parameters), when null then sums all parameters.</p></td>
    </tr>
    <tr>
      <th>var.par</th>
      <td><p>is 1 for the default parametrization with the variances of the random effects,
var.par=0 specifies that the \(\lambda_j\)'s are used as parameters.</p></td>
    </tr>
    <tr>
      <th>cr.models</th>
      <td><p>competing risks models for two.stage=0, should be given as a list with models for each cause</p></td>
    </tr>
    <tr>
      <th>case.control</th>
      <td><p>assumes case control structure for "pairs" with second column being the probands,
when this options is used the twostage model is profiled out via the paired estimating equations for the
survival model.</p></td>
    </tr>
    <tr>
      <th>ascertained</th>
      <td><p>if the pair are sampled only when there is an event. This is in contrast to
case.control sampling where a proband is given. This can be combined with control probands. Pair-call
of twostage is needed  and second column of pairs are the first jump time with an event for ascertained pairs,
or time of control proband.</p></td>
    </tr>
    <tr>
      <th>shut.up</th>
      <td><p>to make the program more silent in the context of iterative procedures for case-control
and ascertained sampling</p></td>
    </tr>
    </table>


  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Klaus K. Holst, Thomas Scheike.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


