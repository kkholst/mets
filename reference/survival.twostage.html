<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Twostage survival model for multivariate survival data — survival.twostage • mets</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Twostage survival model for multivariate survival data — survival.twostage"><meta property="og:description" content="Fits Clayton-Oakes or bivariate Plackett models for bivariate survival data
using marginals that are on Cox form. The dependence can be modelled via
Regression design on dependence parameter.
Random effects, additive gamma model.


If clusters contain more than two subjects, we use a composite likelihood
based on the pairwise bivariate models, for full MLE see twostageMLE.
The two-stage model is constructed such that
given the gamma distributed random effects it is assumed that the survival functions
are indpendent, and that the marginal survival functions are on Cox form (or additive form)
$$
P(T &amp;gt; t| x) = S(t|x)= exp( -exp(x^T \beta) A_0(t) )
$$
One possibility is to model the variance within clusters via a regression design, and
then one can specify a regression structure for the independent gamma distributed
random effect for each cluster, such that the variance is given by
$$
 \theta = h( z_j^T \alpha)
$$
where \(z\) is specified by theta.des, and a possible link function var.link=1 will
will use the exponential link \(h(x)=exp(x)\), and var.link=0 the identity link \(h(x)=x\).
The reported standard errors are based on the estimated information from the
likelihood assuming that the marginals are known (unlike the twostageMLE and for the
additive gamma model below).
Can also fit a structured additive gamma random effects model, such
as the ACE, ADE model for survival data.  In this case the
random.design specificies the random effects for each subject within a cluster. This is
a matrix of 1's and 0's with dimension n x d.  With d random effects.
For a cluster with two subjects, we let the random.design rows be
 \(v_1\) and \(v_2\).
Such that the random effects for subject
1 is $$v_1^T (Z_1,...,Z_d)$$, for d random effects. Each random effect
has an associated parameter \((\lambda_1,...,\lambda_d)\).
By construction subjects 1's random effect are Gamma distributed with
mean \(\lambda_j/v_1^T \lambda\)
and variance \(\lambda_j/(v_1^T \lambda)^2\). Note that the random effect
\(v_1^T (Z_1,...,Z_d)\) has mean 1 and variance \(1/(v_1^T \lambda)\).
It is here asssumed that  \(lamtot=v_1^T \lambda\) is fixed within clusters
as it would be for the ACE model below.
Based on these parameters the relative contribution (the heritability, h) is
equivalent to  the expected values of the random effects: \(\lambda_j/v_1^T \lambda\)
The DEFAULT parametrization (var.par=1) uses the variances of the random effecs
$$
\theta_j  = \lambda_j/(v_1^T \lambda)^2
$$
For alternative parametrizations one can specify how the parameters relate to \(\lambda_j\)
with the argument var.par=0.
For both types of models the basic model assumptions are that
given the random effects of the clusters the survival distributions within a cluster
are independent and ' on the form
$$
P(T &amp;gt; t| x,z) = exp( -Z \cdot Laplace^{-1}(lamtot,lamtot,S(t|x)) )
$$
with the inverse laplace of the gamma distribution with mean 1 and variance 1/lamtot.
The parameters \((\lambda_1,...,\lambda_d)\) are related to the parameters of the model
by a regression construction \(pard\) (d x k), that links the \(d\)
\(\lambda\) parameters
with the (k) underlying \(\theta\) parameters
$$
\lambda = theta.des  \theta
$$
here using theta.des to specify these low-dimension association. Default is a diagonal matrix.
This can be used to make structural assumptions about the variances of the random-effects
as is needed for the ACE model for example.
The case.control option that can be used with the pair specification of the pairwise parts
of the estimating equations. Here it is assumed that the second subject of each pair is the proband."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mets</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/basic-dutils.html">dUtility data-frame manipulations</a>
    </li>
    <li>
      <a href="../articles/binomial-family.html">Analysis of multivariate binomial data: family analysis</a>
    </li>
    <li>
      <a href="../articles/binomial-twin.html">Analysis of bivariate binomial data: Twin analysis</a>
    </li>
    <li>
      <a href="../articles/binreg-ate.html">Average treatment effect (ATE) for Competing risks and binary outcomes</a>
    </li>
    <li>
      <a href="../articles/binreg-TRS.html">Two-Stage Randomization for for Competing risks and Survival outcomes</a>
    </li>
    <li>
      <a href="../articles/binreg.html">Binomial Regression for Survival and Competing Risks Data</a>
    </li>
    <li>
      <a href="../articles/cifreg.html">Cumulative Incidence Regression</a>
    </li>
    <li>
      <a href="../articles/cooking-survival-data.html">WIP: Cooking survival data, 5 minute recipes</a>
    </li>
    <li>
      <a href="../articles/glm-utility.html">GEE cluster standard errors and predictions for glm objects</a>
    </li>
    <li>
      <a href="../articles/haplo-discrete-ttp.html">Haplotype Discrete Survival Models</a>
    </li>
    <li>
      <a href="../articles/interval-discrete-survival.html">Discrete Interval Censored Survival Models</a>
    </li>
    <li>
      <a href="../articles/marginal-cox.html">Marginal modelling of clustered survival data</a>
    </li>
    <li>
      <a href="../articles/mediation-survival.html">Mediation Analysis for survival data</a>
    </li>
    <li>
      <a href="../articles/phreg_rct.html">Two-Stage Randomization for Cox Type rate models </a>
    </li>
    <li>
      <a href="../articles/quantitative-twin.html">Twin models</a>
    </li>
    <li>
      <a href="../articles/recurrent-events.html">Recurrent events</a>
    </li>
    <li>
      <a href="../articles/rmst-ate.html">Average treatment effect (ATE) for Restricted mean survival and years lost of Competing risks</a>
    </li>
    <li>
      <a href="../articles/survival-ate.html">G-Computation or standardization for the Cox, Fine-Gray and binomial regression models for survival data</a>
    </li>
    <li>
      <a href="../articles/time-to-event-family-studies-arev.html">A practical guide to Human Genetics with Lifetime Data</a>
    </li>
    <li>
      <a href="../articles/twostage-survival.html">Analysis of multivariate survival data</a>
    </li>
    <li>
      <a href="../articles/while-alive.html">While Alive estimands for Recurrent Events</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/kkholst/mets/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Twostage survival model for multivariate survival data</h1>
    <small class="dont-index">Source: <a href="https://github.com/kkholst/mets/blob/main/R/twostage.R" class="external-link"><code>R/twostage.R</code></a></small>
    <div class="hidden name"><code>survival.twostage.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fits Clayton-Oakes or bivariate Plackett models for bivariate survival data
using marginals that are on Cox form. The dependence can be modelled via</p><ol><li><p>Regression design on dependence parameter.</p></li>
<li><p>Random effects, additive gamma model.</p></li>
</ol><p>If clusters contain more than two subjects, we use a composite likelihood
based on the pairwise bivariate models, for full MLE see twostageMLE.</p>
<p>The two-stage model is constructed such that
given the gamma distributed random effects it is assumed that the survival functions
are indpendent, and that the marginal survival functions are on Cox form (or additive form)
$$
P(T &gt; t| x) = S(t|x)= exp( -exp(x^T \beta) A_0(t) )
$$</p>
<p>One possibility is to model the variance within clusters via a regression design, and
then one can specify a regression structure for the independent gamma distributed
random effect for each cluster, such that the variance is given by
$$
 \theta = h( z_j^T \alpha)
$$
where \(z\) is specified by theta.des, and a possible link function var.link=1 will
will use the exponential link \(h(x)=exp(x)\), and var.link=0 the identity link \(h(x)=x\).
The reported standard errors are based on the estimated information from the
likelihood assuming that the marginals are known (unlike the twostageMLE and for the
additive gamma model below).</p>
<p>Can also fit a structured additive gamma random effects model, such
as the ACE, ADE model for survival data.  In this case the
random.design specificies the random effects for each subject within a cluster. This is
a matrix of 1's and 0's with dimension n x d.  With d random effects.
For a cluster with two subjects, we let the random.design rows be
 \(v_1\) and \(v_2\).
Such that the random effects for subject
1 is $$v_1^T (Z_1,...,Z_d)$$, for d random effects. Each random effect
has an associated parameter \((\lambda_1,...,\lambda_d)\).
By construction subjects 1's random effect are Gamma distributed with
mean \(\lambda_j/v_1^T \lambda\)
and variance \(\lambda_j/(v_1^T \lambda)^2\). Note that the random effect
\(v_1^T (Z_1,...,Z_d)\) has mean 1 and variance \(1/(v_1^T \lambda)\).
It is here asssumed that  \(lamtot=v_1^T \lambda\) is fixed within clusters
as it would be for the ACE model below.</p>
<p>Based on these parameters the relative contribution (the heritability, h) is
equivalent to  the expected values of the random effects: \(\lambda_j/v_1^T \lambda\)</p>
<p>The DEFAULT parametrization (var.par=1) uses the variances of the random effecs
$$
\theta_j  = \lambda_j/(v_1^T \lambda)^2
$$
For alternative parametrizations one can specify how the parameters relate to \(\lambda_j\)
with the argument var.par=0.</p>
<p>For both types of models the basic model assumptions are that
given the random effects of the clusters the survival distributions within a cluster
are independent and ' on the form
$$
P(T &gt; t| x,z) = exp( -Z \cdot Laplace^{-1}(lamtot,lamtot,S(t|x)) )
$$
with the inverse laplace of the gamma distribution with mean 1 and variance 1/lamtot.</p>
<p>The parameters \((\lambda_1,...,\lambda_d)\) are related to the parameters of the model
by a regression construction \(pard\) (d x k), that links the \(d\)
\(\lambda\) parameters
with the (k) underlying \(\theta\) parameters
$$
\lambda = theta.des  \theta
$$
here using theta.des to specify these low-dimension association. Default is a diagonal matrix.
This can be used to make structural assumptions about the variances of the random-effects
as is needed for the ACE model for example.</p>
<p>The case.control option that can be used with the pair specification of the pairwise parts
of the estimating equations. Here it is assumed that the second subject of each pair is the proband.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">survival.twostage</span><span class="op">(</span></span>
<span>  <span class="va">margsurv</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"nr"</span>,</span>
<span>  detail <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  clusters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  silent <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  theta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  theta.des <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  var.link <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  baseline.iid <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"clayton.oakes"</span>,</span>
<span>  marginal.trunc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  marginal.survival <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  strata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  se.clusters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  numDeriv <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  random.design <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pairs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dim.theta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  numDeriv.method <span class="op">=</span> <span class="st">"simple"</span>,</span>
<span>  additive.gamma.sum <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  var.par <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  no.opt <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-margsurv">margsurv<a class="anchor" aria-label="anchor" href="#arg-margsurv"></a></dt>
<dd><p>Marginal model</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>data frame</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Scoring method "nr", for lava NR optimizer</p></dd>


<dt id="arg-detail">detail<a class="anchor" aria-label="anchor" href="#arg-detail"></a></dt>
<dd><p>Detail</p></dd>


<dt id="arg-clusters">clusters<a class="anchor" aria-label="anchor" href="#arg-clusters"></a></dt>
<dd><p>Cluster variable</p></dd>


<dt id="arg-silent">silent<a class="anchor" aria-label="anchor" href="#arg-silent"></a></dt>
<dd><p>Debug information</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>Weights</p></dd>


<dt id="arg-theta">theta<a class="anchor" aria-label="anchor" href="#arg-theta"></a></dt>
<dd><p>Starting values for variance components</p></dd>


<dt id="arg-theta-des">theta.des<a class="anchor" aria-label="anchor" href="#arg-theta-des"></a></dt>
<dd><p>design for dependence parameters, when pairs are given the indeces of the
theta-design for this pair, is given in pairs as column 5</p></dd>


<dt id="arg-var-link">var.link<a class="anchor" aria-label="anchor" href="#arg-var-link"></a></dt>
<dd><p>Link function for variance:  exp-link.</p></dd>


<dt id="arg-baseline-iid">baseline.iid<a class="anchor" aria-label="anchor" href="#arg-baseline-iid"></a></dt>
<dd><p>to adjust for baseline estimation, using phreg function on same data.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>model</p></dd>


<dt id="arg-marginal-trunc">marginal.trunc<a class="anchor" aria-label="anchor" href="#arg-marginal-trunc"></a></dt>
<dd><p>marginal left truncation probabilities</p></dd>


<dt id="arg-marginal-survival">marginal.survival<a class="anchor" aria-label="anchor" href="#arg-marginal-survival"></a></dt>
<dd><p>optional vector of marginal survival probabilities</p></dd>


<dt id="arg-strata">strata<a class="anchor" aria-label="anchor" href="#arg-strata"></a></dt>
<dd><p>strata for fitting, see example</p></dd>


<dt id="arg-se-clusters">se.clusters<a class="anchor" aria-label="anchor" href="#arg-se-clusters"></a></dt>
<dd><p>for clusters for se calculation with iid</p></dd>


<dt id="arg-numderiv">numDeriv<a class="anchor" aria-label="anchor" href="#arg-numderiv"></a></dt>
<dd><p>to get numDeriv version of second derivative, otherwise uses sum of squared scores for each pair</p></dd>


<dt id="arg-random-design">random.design<a class="anchor" aria-label="anchor" href="#arg-random-design"></a></dt>
<dd><p>random effect design for additive gamma model, when pairs are given the
indeces of the pairs random.design rows are given as columns 3:4</p></dd>


<dt id="arg-pairs">pairs<a class="anchor" aria-label="anchor" href="#arg-pairs"></a></dt>
<dd><p>matrix with rows of indeces (two-columns) for the pairs considered in the pairwise
composite score, useful for case-control sampling when marginal is known.</p></dd>


<dt id="arg-dim-theta">dim.theta<a class="anchor" aria-label="anchor" href="#arg-dim-theta"></a></dt>
<dd><p>dimension of the theta parameter for pairs situation.</p></dd>


<dt id="arg-numderiv-method">numDeriv.method<a class="anchor" aria-label="anchor" href="#arg-numderiv-method"></a></dt>
<dd><p>uses simple to speed up things and second derivative not so important.</p></dd>


<dt id="arg-additive-gamma-sum">additive.gamma.sum<a class="anchor" aria-label="anchor" href="#arg-additive-gamma-sum"></a></dt>
<dd><p>for two.stage=0, this is specification of the lamtot in the models via
a matrix that is multiplied onto the parameters theta (dimensions=(number random effects x number
of theta parameters), when null then sums all parameters.</p></dd>


<dt id="arg-var-par">var.par<a class="anchor" aria-label="anchor" href="#arg-var-par"></a></dt>
<dd><p>is 1 for the default parametrization with the variances of the random effects,
var.par=0 specifies that the \(\lambda_j\)'s are used as parameters.</p></dd>


<dt id="arg-no-opt">no.opt<a class="anchor" aria-label="anchor" href="#arg-no-opt"></a></dt>
<dd><p>for not optimizng</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments to maximizer NR of lava.
and ascertained sampling</p></dd>

</dl></div>
    <div id="references">
    <h2>References</h2>
    <p>Twostage estimation of additive gamma frailty models for survival data.
Scheike (2019), work in progress</p>
<p>Shih and Louis (1995) Inference on the association parameter in copula models for bivariate
survival data, Biometrics, (1995).</p>
<p>Glidden (2000), A Two-Stage estimator of the dependence
parameter for the Clayton Oakes model, LIDA, (2000).</p>
<p>Measuring early or late dependence for bivariate twin data
Scheike, Holst, Hjelmborg (2015), LIDA</p>
<p>Estimating heritability for cause specific mortality based on twins studies
Scheike, Holst, Hjelmborg (2014), LIDA</p>
<p>Additive Gamma frailty models for competing risks data, Biometrics (2015)
Eriksson and Scheike (2015),</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Thomas Scheike</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">diabetes</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Marginal Cox model  with treat as covariate</span></span></span>
<span class="r-in"><span><span class="va">margph</span> <span class="op">&lt;-</span> <span class="fu"><a href="phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">treat</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">diabetes</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">### Clayton-Oakes, MLE</span></span></span>
<span class="r-in"><span><span class="va">fitco1</span><span class="op">&lt;-</span><span class="fu"><a href="twostageMLE.html">twostageMLE</a></span><span class="op">(</span><span class="va">margph</span>,data<span class="op">=</span><span class="va">diabetes</span>,theta<span class="op">=</span><span class="fl">1.0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitco1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dependence parameter for Clayton-Oakes model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Variance of Gamma distributed random effects </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $estimates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 Coef.        SE       z       P-val Kendall tau         SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence1 0.9526614 0.3543033 2.68883 0.007170289    0.322645 0.08127892</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "summary.mets.twostage"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### Plackett model</span></span></span>
<span class="r-in"><span><span class="va">mph</span> <span class="op">&lt;-</span> <span class="fu"><a href="phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">treat</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">diabetes</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitp</span> <span class="op">&lt;-</span> <span class="fu">survival.twostage</span><span class="op">(</span><span class="va">mph</span>,data<span class="op">=</span><span class="va">diabetes</span>,theta<span class="op">=</span><span class="fl">3.0</span>,Nit<span class="op">=</span><span class="fl">40</span>,</span></span>
<span class="r-in"><span>               clusters<span class="op">=</span><span class="va">diabetes</span><span class="op">$</span><span class="va">id</span>,var.link<span class="op">=</span><span class="fl">1</span>,model<span class="op">=</span><span class="st">"plackett"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dependence parameter for Odds-Ratio (Plackett) model </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> With log-link </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $estimates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             log-Coef.        SE        z        P-val Spearman Corr.         SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence1   1.14188 0.3026537 3.772891 0.0001613666      0.3648216 0.08869229</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $or</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Err  2.5% 97.5%   P-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence1    3.133  0.9481 1.274 4.991 0.0009528</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "plackett"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "summary.mets.twostage"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### Clayton-Oakes</span></span></span>
<span class="r-in"><span><span class="va">fitco2</span> <span class="op">&lt;-</span> <span class="fu">survival.twostage</span><span class="op">(</span><span class="va">mph</span>,data<span class="op">=</span><span class="va">diabetes</span>,theta<span class="op">=</span><span class="fl">0.0</span>,detail<span class="op">=</span><span class="fl">0</span>,</span></span>
<span class="r-in"><span>                 clusters<span class="op">=</span><span class="va">diabetes</span><span class="op">$</span><span class="va">id</span>,var.link<span class="op">=</span><span class="fl">1</span>,model<span class="op">=</span><span class="st">"clayton.oakes"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitco2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dependence parameter for Clayton-Oakes model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Variance of Gamma distributed random effects </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> With log-link </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $estimates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              log-Coef.        SE          z     P-val Kendall tau         SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence1 -0.0484957 0.3718487 -0.1304178 0.8962359    0.322645 0.08126576</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $vargam</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Err   2.5% 97.5%  P-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence1   0.9527  0.3542 0.2584 1.647 0.007161</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "clayton.oakes"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "summary.mets.twostage"</span>
<span class="r-in"><span><span class="va">fitco3</span> <span class="op">&lt;-</span> <span class="fu">survival.twostage</span><span class="op">(</span><span class="va">margph</span>,data<span class="op">=</span><span class="va">diabetes</span>,theta<span class="op">=</span><span class="fl">1.0</span>,detail<span class="op">=</span><span class="fl">0</span>,</span></span>
<span class="r-in"><span>                 clusters<span class="op">=</span><span class="va">diabetes</span><span class="op">$</span><span class="va">id</span>,var.link<span class="op">=</span><span class="fl">0</span>,model<span class="op">=</span><span class="st">"clayton.oakes"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitco3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dependence parameter for Clayton-Oakes model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Variance of Gamma distributed random effects </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $estimates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 Coef.     SE        z       P-val Kendall tau         SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence1 0.9526614 0.3543 2.688855 0.007169754    0.322645 0.08127816</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "clayton.oakes"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "summary.mets.twostage"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### without covariates but with stratafied</span></span></span>
<span class="r-in"><span><span class="va">marg</span> <span class="op">&lt;-</span> <span class="fu"><a href="phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">treat</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,data<span class="op">=</span><span class="va">diabetes</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitpa</span> <span class="op">&lt;-</span> <span class="fu">survival.twostage</span><span class="op">(</span><span class="va">marg</span>,data<span class="op">=</span><span class="va">diabetes</span>,theta<span class="op">=</span><span class="fl">1.0</span>,</span></span>
<span class="r-in"><span>                clusters<span class="op">=</span><span class="va">diabetes</span><span class="op">$</span><span class="va">id</span>,model<span class="op">=</span><span class="st">"clayton.oakes"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitpa</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dependence parameter for Clayton-Oakes model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Variance of Gamma distributed random effects </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> With log-link </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $estimates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               log-Coef.        SE          z     P-val Kendall tau         SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence1 -0.05684062 0.3721207 -0.1527478 0.8785971    0.320824 0.08108359</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $vargam</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Err   2.5% 97.5%  P-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence1   0.9447  0.3516 0.2557 1.634 0.007203</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "clayton.oakes"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "summary.mets.twostage"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fitcoa</span> <span class="op">&lt;-</span> <span class="fu">survival.twostage</span><span class="op">(</span><span class="va">marg</span>,data<span class="op">=</span><span class="va">diabetes</span>,theta<span class="op">=</span><span class="fl">1.0</span>,clusters<span class="op">=</span><span class="va">diabetes</span><span class="op">$</span><span class="va">id</span>,</span></span>
<span class="r-in"><span>                 model<span class="op">=</span><span class="st">"clayton.oakes"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitcoa</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dependence parameter for Clayton-Oakes model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Variance of Gamma distributed random effects </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> With log-link </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $estimates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               log-Coef.        SE          z     P-val Kendall tau         SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence1 -0.05684062 0.3721207 -0.1527478 0.8785971    0.320824 0.08108359</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $vargam</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Err   2.5% 97.5%  P-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence1   0.9447  0.3516 0.2557 1.634 0.007203</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "clayton.oakes"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "summary.mets.twostage"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### Piecewise constant cross hazards ratio modelling</span></span></span>
<span class="r-in"><span><span class="co">########################################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="simClaytonOakes.html">simClaytonOakes</a></span><span class="op">(</span><span class="fl">2000</span>,<span class="fl">2</span>,<span class="fl">0.5</span>,<span class="fl">0</span>,stoptime<span class="op">=</span><span class="fl">2</span>,left<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,<span class="op">!</span><span class="va">truncated</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">udp</span> <span class="op">&lt;-</span> <span class="fu"><a href="internal.html">piecewise.twostage</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span>,<span class="fl">2</span><span class="op">)</span>,data<span class="op">=</span><span class="va">d</span>,method<span class="op">=</span><span class="st">"optimize"</span>,</span></span>
<span class="r-in"><span>                          id<span class="op">=</span><span class="st">"cluster"</span>,timevar<span class="op">=</span><span class="st">"time"</span>,</span></span>
<span class="r-in"><span>                          status<span class="op">=</span><span class="st">"status"</span>,model<span class="op">=</span><span class="st">"clayton.oakes"</span>,silent<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data-set  1 out of  4 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Number of joint events: 503 of  2000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data-set  2 out of  4 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Number of joint events: 278 of  1228</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data-set  3 out of  4 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Number of joint events: 267 of  1214</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data-set  4 out of  4 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Number of joint events: 630 of  945</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">udp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dependence parameter for Clayton-Oakes model </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log-coefficient for dependence parameter (SE) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          0 - 0.5        0.5 - 2      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0 - 0.5  0.675 (0.070)  0.678 (0.094)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.5 - 2  0.593 (0.090)  0.638 (0.061)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kendall's tau (SE) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          0 - 0.5        0.5 - 2      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0 - 0.5  0.496 (0.018)  0.496 (0.023)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.5 - 2  0.475 (0.023)  0.486 (0.015)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co">## Reduce Ex.Timings</span></span></span>
<span class="r-in"><span><span class="co">### Same model using the strata option, a bit slower</span></span></span>
<span class="r-in"><span><span class="co">########################################################</span></span></span>
<span class="r-in"><span><span class="co">## makes the survival pieces for different areas in the plane</span></span></span>
<span class="r-in"><span><span class="co">##ud1=surv.boxarea(c(0,0),c(0.5,0.5),data=d,id="cluster",timevar="time",status="status")</span></span></span>
<span class="r-in"><span><span class="co">##ud2=surv.boxarea(c(0,0.5),c(0.5,2),data=d,id="cluster",timevar="time",status="status")</span></span></span>
<span class="r-in"><span><span class="co">##ud3=surv.boxarea(c(0.5,0),c(2,0.5),data=d,id="cluster",timevar="time",status="status")</span></span></span>
<span class="r-in"><span><span class="co">##ud4=surv.boxarea(c(0.5,0.5),c(2,2),data=d,id="cluster",timevar="time",status="status")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## everything done in one call</span></span></span>
<span class="r-in"><span><span class="va">ud</span> <span class="op">&lt;-</span> <span class="fu"><a href="internal.html">piecewise.data</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span>,<span class="fl">2</span><span class="op">)</span>,data<span class="op">=</span><span class="va">d</span>,timevar<span class="op">=</span><span class="st">"time"</span>,status<span class="op">=</span><span class="st">"status"</span>,id<span class="op">=</span><span class="st">"cluster"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ud</span><span class="op">$</span><span class="va">strata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ud</span><span class="op">$</span><span class="va">strata</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">ud</span><span class="op">$</span><span class="va">intstrata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ud</span><span class="op">$</span><span class="va">intstrata</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## makes strata specific id variable to identify pairs within strata</span></span></span>
<span class="r-in"><span><span class="co">## se's computed based on the id variable across strata "cluster"</span></span></span>
<span class="r-in"><span><span class="va">ud</span><span class="op">$</span><span class="va">idstrata</span> <span class="op">&lt;-</span> <span class="va">ud</span><span class="op">$</span><span class="va">id</span><span class="op">+</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ud</span><span class="op">$</span><span class="va">strata</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">2000</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">marg2</span> <span class="op">&lt;-</span> <span class="fu">timereg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/timereg/man/aalen.html" class="external-link">aalen</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">boxtime</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="op">-</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">num</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">intstrata</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               data<span class="op">=</span><span class="va">ud</span>,n.sim<span class="op">=</span><span class="fl">0</span>,robust<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tdes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="op">-</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">strata</span><span class="op">)</span>,data<span class="op">=</span><span class="va">ud</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitp2</span> <span class="op">&lt;-</span> <span class="fu">survival.twostage</span><span class="op">(</span><span class="va">marg2</span>,data<span class="op">=</span><span class="va">ud</span>,se.clusters<span class="op">=</span><span class="va">ud</span><span class="op">$</span><span class="va">cluster</span>,clusters<span class="op">=</span><span class="va">ud</span><span class="op">$</span><span class="va">idstrata</span>,</span></span>
<span class="r-in"><span>                model<span class="op">=</span><span class="st">"clayton.oakes"</span>,theta.des<span class="op">=</span><span class="va">tdes</span>,step<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitp2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dependence parameter for Clayton-Oakes model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Variance of Gamma distributed random effects </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> With log-link </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Variance parameters did not converge, allow more iterations.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Score: 2.07851247433916e-05   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Score: 6.06163248009772e-06   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Score: 8.83561233532004e-07   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Score: 0.000184876238419618   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $estimates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                           log-Coef.         SE         z        P-val</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(strata)0-0.5,0-0.5 0.8164420 0.07170780 11.385679 0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(strata)0-0.5,0.5-2 0.4687701 0.10363662  4.523209 6.090902e-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(strata)0.5-2,0-0.5 0.4244088 0.10440700  4.064946 4.804368e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(strata)0.5-2,0.5-2 0.5816431 0.06020659  9.660788 0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                           Kendall tau         SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(strata)0-0.5,0-0.5   0.5307847 0.01785899</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(strata)0-0.5,0.5-2   0.4441399 0.02558577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(strata)0.5-2,0-0.5   0.4332168 0.02563610</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(strata)0.5-2,0.5-2   0.4721528 0.01500496</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $vargam</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Err  2.5% 97.5%   P-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence1    2.262  0.1622 1.944 2.580 3.352e-44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence2    1.598  0.1656 1.273 1.923 4.959e-22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence3    1.529  0.1596 1.216 1.842 9.904e-22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence4    1.789  0.1077 1.578 2.000 5.951e-62</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "clayton.oakes"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "summary.mets.twostage"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### now fitting the model with symmetry, i.e. strata 2 and 3 same effect</span></span></span>
<span class="r-in"><span><span class="va">ud</span><span class="op">$</span><span class="va">stratas</span> <span class="op">&lt;-</span> <span class="va">ud</span><span class="op">$</span><span class="va">strata</span>;</span></span>
<span class="r-in"><span><span class="va">ud</span><span class="op">$</span><span class="va">stratas</span><span class="op">[</span><span class="va">ud</span><span class="op">$</span><span class="va">strata</span><span class="op">==</span><span class="st">"0.5-2,0-0.5"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"0-0.5,0.5-2"</span></span></span>
<span class="r-in"><span><span class="va">tdes2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="op">-</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stratas</span><span class="op">)</span>,data<span class="op">=</span><span class="va">ud</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitp3</span> <span class="op">&lt;-</span> <span class="fu">survival.twostage</span><span class="op">(</span><span class="va">marg2</span>,data<span class="op">=</span><span class="va">ud</span>,clusters<span class="op">=</span><span class="va">ud</span><span class="op">$</span><span class="va">idstrata</span>,se.cluster<span class="op">=</span><span class="va">ud</span><span class="op">$</span><span class="va">cluster</span>,</span></span>
<span class="r-in"><span>                model<span class="op">=</span><span class="st">"clayton.oakes"</span>,theta.des<span class="op">=</span><span class="va">tdes2</span>,step<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitp3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dependence parameter for Clayton-Oakes model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Variance of Gamma distributed random effects </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> With log-link </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Variance parameters did not converge, allow more iterations.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Score: 2.07851247433916e-05   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Score: 4.93197764087072e-06   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Score: 0.000184876238419618   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $estimates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                            log-Coef.         SE         z        P-val</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stratas)0-0.5,0-0.5 0.8164420 0.07170780 11.385679 0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stratas)0-0.5,0.5-2 0.4471547 0.08091328  5.526345 3.269712e-08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stratas)0.5-2,0.5-2 0.5816431 0.06020659  9.660788 0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                            Kendall tau         SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stratas)0-0.5,0-0.5   0.5307847 0.01785899</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stratas)0-0.5,0.5-2   0.4388101 0.01992536</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stratas)0.5-2,0.5-2   0.4721528 0.01500496</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $vargam</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Err  2.5% 97.5%   P-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence1    2.262  0.1622 1.944 2.580 3.352e-44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence2    1.564  0.1265 1.316 1.812 4.360e-35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence3    1.789  0.1077 1.578 2.000 5.951e-62</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "clayton.oakes"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "summary.mets.twostage"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### same model using strata option, a bit slower</span></span></span>
<span class="r-in"><span><span class="va">fitp4</span> <span class="op">&lt;-</span> <span class="fu">survival.twostage</span><span class="op">(</span><span class="va">marg2</span>,data<span class="op">=</span><span class="va">ud</span>,clusters<span class="op">=</span><span class="va">ud</span><span class="op">$</span><span class="va">cluster</span>,se.cluster<span class="op">=</span><span class="va">ud</span><span class="op">$</span><span class="va">cluster</span>,</span></span>
<span class="r-in"><span>                model<span class="op">=</span><span class="st">"clayton.oakes"</span>,theta.des<span class="op">=</span><span class="va">tdes2</span>,step<span class="op">=</span><span class="fl">0.5</span>,strata<span class="op">=</span><span class="va">ud</span><span class="op">$</span><span class="va">strata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitp4</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dependence parameter for Clayton-Oakes model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Variance of Gamma distributed random effects </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> With log-link </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Variance parameters did not converge, allow more iterations.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Score: 2.07851247433916e-05   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Score: 4.93197769805415e-06   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Score: 0.000184876238419618   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $estimates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                            log-Coef.         SE         z        P-val</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stratas)0-0.5,0-0.5 0.8164420 0.07170780 11.385679 0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stratas)0-0.5,0.5-2 0.4471547 0.08091328  5.526345 3.269712e-08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stratas)0.5-2,0.5-2 0.5816431 0.06020659  9.660788 0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                            Kendall tau         SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stratas)0-0.5,0-0.5   0.5307847 0.01785899</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stratas)0-0.5,0.5-2   0.4388101 0.01992536</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stratas)0.5-2,0.5-2   0.4721528 0.01500496</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $vargam</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Err  2.5% 97.5%   P-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence1    2.262  0.1622 1.944 2.580 3.352e-44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence2    1.564  0.1265 1.316 1.812 4.360e-35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence3    1.789  0.1077 1.578 2.000 5.951e-62</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "clayton.oakes"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "summary.mets.twostage"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co">## Reduce Ex.Timings</span></span></span>
<span class="r-in"><span><span class="co">### structured random effects model additive gamma ACE</span></span></span>
<span class="r-in"><span><span class="co">### simulate structured two-stage additive gamma ACE model</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="internal.html">simClaytonOakes.twin.ace</a></span><span class="op">(</span><span class="fl">4000</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="internal.html">twin.polygen.design</a></span><span class="op">(</span><span class="va">data</span>,id<span class="op">=</span><span class="st">"cluster"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pardes</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">pardes</span></span></span>
<span class="r-in"><span><span class="va">pardes</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  1.0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  0.5    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]  0.5    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]  0.5    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,]  0.0    1</span>
<span class="r-in"><span><span class="va">des.rv</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">des.rv</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">des.rv</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   MZ DZ DZns1 DZns2 env</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  1  0     0     0   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  1  0     0     0   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  1  0     0     0   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  1  0     0     0   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  1  0     0     0   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  1  0     0     0   1</span>
<span class="r-in"><span><span class="va">aa</span> <span class="op">&lt;-</span> <span class="fu"><a href="phreg.html">phreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">x</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span>,data<span class="op">=</span><span class="va">data</span>,robust<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ts</span> <span class="op">&lt;-</span> <span class="fu">survival.twostage</span><span class="op">(</span><span class="va">aa</span>,data<span class="op">=</span><span class="va">data</span>,clusters<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">cluster</span>,detail<span class="op">=</span><span class="fl">0</span>,</span></span>
<span class="r-in"><span>         theta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>,var.link<span class="op">=</span><span class="fl">0</span>,step<span class="op">=</span><span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>         random.design<span class="op">=</span><span class="va">des.rv</span>,theta.des<span class="op">=</span><span class="va">pardes</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dependence parameter for Clayton-Oakes model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Variance of Gamma distributed random effects </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $estimates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Coef.        SE         z P-val Kendall tau         SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence1 1.820301 0.1408732 12.921555     0   0.4764810 0.01930471</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dependence2 1.032414 0.1116103  9.250171     0   0.3404595 0.02427488</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "clayton.oakes"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $h</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Estimate Std.Err   2.5%  97.5%   P-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]   0.6381 0.04026 0.5592 0.7170 1.418e-56</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]   0.3619 0.04026 0.2830 0.4408 2.488e-19</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $vare</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $vartot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Estimate Std.Err  2.5% 97.5%    P-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p1    2.853 0.09167 2.673 3.032 1.256e-212</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "summary.mets.twostage"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Klaus K. Holst, Thomas Scheike.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

