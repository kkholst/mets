<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>GOF for Cox covariates in PH regression — gofM.phreg • mets</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="GOF for Cox covariates in PH regression — gofM.phreg"><meta name="description" content="Cumulative residuals after model matrix for Cox PH regression
p-values based on Lin, Wei, Ying resampling."><meta property="og:description" content="Cumulative residuals after model matrix for Cox PH regression
p-values based on Lin, Wei, Ying resampling."><meta property="og:image" content="http://kkholst.github.io/mets/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mets</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/basic-dutils.html">dUtility data-frame manipulations</a></li>
    <li><a class="dropdown-item" href="../articles/binomial-family.html">Analysis of multivariate binomial data: family analysis</a></li>
    <li><a class="dropdown-item" href="../articles/binomial-twin.html">Analysis of bivariate binomial data: Twin analysis</a></li>
    <li><a class="dropdown-item" href="../articles/binreg-ate.html">Average treatment effect (ATE) for Competing risks and binary outcomes</a></li>
    <li><a class="dropdown-item" href="../articles/binreg-TRS.html">Two-Stage Randomization for for Competing risks and Survival outcomes</a></li>
    <li><a class="dropdown-item" href="../articles/binreg.html">Binomial Regression for Survival and Competing Risks Data</a></li>
    <li><a class="dropdown-item" href="../articles/cifreg.html">Cumulative Incidence Regression</a></li>
    <li><a class="dropdown-item" href="../articles/cooking-survival-data.html">WIP: Cooking survival data, 5 minute recipes</a></li>
    <li><a class="dropdown-item" href="../articles/cumulative-cost.html">IPCW Cumulative Cost</a></li>
    <li><a class="dropdown-item" href="../articles/glm-utility.html">GEE cluster standard errors and predictions for glm objects</a></li>
    <li><a class="dropdown-item" href="../articles/haplo-discrete-ttp.html">Haplotype Discrete Survival Models</a></li>
    <li><a class="dropdown-item" href="../articles/interval-discrete-survival.html">Discrete Interval Censored Survival Models</a></li>
    <li><a class="dropdown-item" href="../articles/marginal-cox.html">Marginal modelling of clustered survival data</a></li>
    <li><a class="dropdown-item" href="../articles/mediation-survival.html">Mediation Analysis for survival data</a></li>
    <li><a class="dropdown-item" href="../articles/phreg_rct.html">Randomization for Cox Type rate models </a></li>
    <li><a class="dropdown-item" href="../articles/quantitative-twin.html">Twin models</a></li>
    <li><a class="dropdown-item" href="../articles/recurrent-events.html">Recurrent events</a></li>
    <li><a class="dropdown-item" href="../articles/rmst-ate.html">Average treatment effect (ATE) for Restricted mean survival and years lost of Competing risks</a></li>
    <li><a class="dropdown-item" href="../articles/survival-ate.html">G-Computation or standardization for the Cox, Fine-Gray and binomial regression models for survival data</a></li>
    <li><a class="dropdown-item" href="../articles/time-to-event-family-studies-arev.html">A practical guide to Human Genetics with Lifetime Data</a></li>
    <li><a class="dropdown-item" href="../articles/twostage-survival.html">Analysis of multivariate survival data</a></li>
    <li><a class="dropdown-item" href="../articles/while-alive.html">While Alive estimands for Recurrent Events</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kkholst/mets/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>GOF for Cox covariates in PH regression</h1>
      <small class="dont-index">Source: <a href="https://github.com/kkholst/mets/blob/main/R/gof-phreg.R" class="external-link"><code>R/gof-phreg.R</code></a></small>
      <div class="d-none name"><code>gofM.phreg.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Cumulative residuals after model matrix for Cox PH regression
p-values based on Lin, Wei, Ying resampling.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gofM.phreg</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  offset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  modelmatrix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n.sim <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  silent <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>formula for cox regression</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>data for model</p></dd>


<dt id="arg-offset">offset<a class="anchor" aria-label="anchor" href="#arg-offset"></a></dt>
<dd><p>offset</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>weights</p></dd>


<dt id="arg-modelmatrix">modelmatrix<a class="anchor" aria-label="anchor" href="#arg-modelmatrix"></a></dt>
<dd><p>matrix for cumulating residuals</p></dd>


<dt id="arg-n-sim">n.sim<a class="anchor" aria-label="anchor" href="#arg-n-sim"></a></dt>
<dd><p>number of simulations for score processes</p></dd>


<dt id="arg-silent">silent<a class="anchor" aria-label="anchor" href="#arg-silent"></a></dt>
<dd><p>to keep it absolutely silent, otherwise timing estimate will be prduced for longer jobs.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments to lower level funtions</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>That is, computes
$$
 U(t) = \int_0^t M^t d \hat M
$$
and resamples its asymptotic distribution.</p>
<p>This will show if the residuals are consistent with the model. Typically,
M will be a design matrix for the continous covariates that gives for example
the quartiles, and then the plot will show if for the different quartiles of the covariate the risk
prediction is consistent over time  (time x covariate interaction).</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Thomas Scheike and Klaus K. Holst</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kkholst.github.io/mets/" class="external-link">mets</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">TRACE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">TRACEsam</span> <span class="op">&lt;-</span> <span class="fu"><a href="blocksample.html">blocksample</a></span><span class="op">(</span><span class="va">TRACE</span>,idvar<span class="op">=</span><span class="st">"id"</span>,replace<span class="op">=</span><span class="cn">FALSE</span>,<span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="dcut.html">dcut</a></span><span class="op">(</span><span class="va">TRACEsam</span><span class="op">)</span>  <span class="op">&lt;-</span> <span class="op">~</span><span class="va">.</span> </span></span>
<span class="r-in"><span><span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="op">-</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">wmicat.4</span><span class="op">)</span>,data<span class="op">=</span><span class="va">TRACEsam</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">gofM.phreg</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">==</span><span class="fl">9</span><span class="op">)</span><span class="op">~</span><span class="va">vf</span><span class="op">+</span><span class="va">chf</span><span class="op">+</span><span class="va">wmi</span>,data<span class="op">=</span><span class="va">TRACEsam</span>,modelmatrix<span class="op">=</span><span class="va">mm</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative residuals versus modelmatrix :</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                            Sup_t |U(t)|  pval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(wmicat.4)[0.4,1.1]      5.788752 0.021</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(wmicat.4)(1.1,1.4]      2.633143 0.591</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(wmicat.4)(1.4,1.72]     5.657370 0.038</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(wmicat.4)(1.72,2]       1.227485 0.948</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative score process versus covariates (discrete z via model.matrix):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Sup_z |U(tau,z)|  pval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> matrixZ         1.801626 0.812</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">gofM.phreg</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">==</span><span class="fl">9</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">vf</span><span class="op">)</span><span class="op">+</span><span class="va">chf</span><span class="op">+</span><span class="va">wmi</span>,data<span class="op">=</span><span class="va">TRACEsam</span>,modelmatrix<span class="op">=</span><span class="va">mm</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative residuals versus modelmatrix :</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                            Sup_t |U(t)|  pval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(wmicat.4)[0.4,1.1]      5.679902 0.035</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(wmicat.4)(1.1,1.4]      2.557399 0.593</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(wmicat.4)(1.4,1.72]     5.411115 0.058</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(wmicat.4)(1.72,2]       1.384392 0.931</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative score process versus covariates (discrete z via model.matrix):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Sup_z |U(tau,z)|  pval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> matrixZ         1.771578 0.812</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## cumulative sums in covariates, via design matrix mm </span></span></span>
<span class="r-in"><span><span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="gofZ.phreg.html">cumContr</a></span><span class="op">(</span><span class="va">TRACEsam</span><span class="op">$</span><span class="va">wmi</span>,breaks<span class="op">=</span><span class="fl">10</span>,equi<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">gofM.phreg</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">==</span><span class="fl">9</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">vf</span><span class="op">)</span><span class="op">+</span><span class="va">chf</span><span class="op">+</span><span class="va">wmi</span>,data<span class="op">=</span><span class="va">TRACEsam</span>,</span></span>
<span class="r-in"><span>      modelmatrix<span class="op">=</span><span class="va">mm</span>,silent<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative score process test for modelmatrix:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        Sup_t |U(t)| pval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=0.56         0.88 0.33</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=0.72         2.25 0.28</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=0.88         5.28 0.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.04         2.68 0.55</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.2          4.12 0.20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.36         4.09 0.16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.52         3.34 0.27</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.68         1.78 0.84</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.84         1.17 0.85</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=2            0.00 1.00</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative residuals versus modelmatrix :</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        Sup_t |U(t)|  pval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=0.56    0.8821214 0.330</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=0.72    2.2521756 0.276</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=0.88    5.2766972 0.029</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.04    2.6807567 0.552</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.2     4.1217296 0.201</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.36    4.0926272 0.161</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.52    3.3447151 0.271</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.68    1.7766131 0.844</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.84    1.1652990 0.853</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=2       0.0000000 1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative score process versus covariates (discrete z via model.matrix):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Sup_z |U(tau,z)|  pval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> matrixZ         3.931466 0.225</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Klaus K. Holst, Thomas Scheike.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

