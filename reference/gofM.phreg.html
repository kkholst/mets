<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>GOF for Cox covariates in PH regression — gofM.phreg • mets</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="GOF for Cox covariates in PH regression — gofM.phreg"><meta property="og:description" content="Cumulative residuals after model matrix for Cox PH regression
p-values based on Lin, Wei, Ying resampling."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mets</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/basic-dutils.html">dUtility data-frame manipulations</a>
    </li>
    <li>
      <a href="../articles/binomial-family.html">Analysis of multivariate binomial data: family analysis</a>
    </li>
    <li>
      <a href="../articles/binomial-twin.html">Analysis of bivariate binomial data: Twin analysis</a>
    </li>
    <li>
      <a href="../articles/binreg-ate.html">Average treatment effect (ATE) for Competing risks and binary outcomes</a>
    </li>
    <li>
      <a href="../articles/binreg-TRS.html">Two-Stage Randomization for for Competing risks and Survival outcomes</a>
    </li>
    <li>
      <a href="../articles/binreg.html">Binomial Regression for Survival and Competing Risks Data</a>
    </li>
    <li>
      <a href="../articles/cifreg.html">Cumulative Incidence Regression</a>
    </li>
    <li>
      <a href="../articles/cooking-survival-data.html">WIP: Cooking survival data, 5 minute recipes</a>
    </li>
    <li>
      <a href="../articles/glm-utility.html">GEE cluster standard errors and predictions for glm objects</a>
    </li>
    <li>
      <a href="../articles/haplo-discrete-ttp.html">Haplotype Discrete Survival Models</a>
    </li>
    <li>
      <a href="../articles/interval-discrete-survival.html">Discrete Interval Censored Survival Models</a>
    </li>
    <li>
      <a href="../articles/marginal-cox.html">Marginal modelling of clustered survival data</a>
    </li>
    <li>
      <a href="../articles/mediation-survival.html">Mediation Analysis for survival data</a>
    </li>
    <li>
      <a href="../articles/phreg_rct.html">Two-Stage Randomization for Cox Type rate models </a>
    </li>
    <li>
      <a href="../articles/quantitative-twin.html">Twin models</a>
    </li>
    <li>
      <a href="../articles/recurrent-events.html">Recurrent events</a>
    </li>
    <li>
      <a href="../articles/rmst-ate.html">Average treatment effect (ATE) for Restricted mean survival and years lost of Competing risks</a>
    </li>
    <li>
      <a href="../articles/survival-ate.html">G-Computation or standardization for the Cox, Fine-Gray and binomial regression models for survival data</a>
    </li>
    <li>
      <a href="../articles/time-to-event-family-studies-arev.html">A practical guide to Human Genetics with Lifetime Data</a>
    </li>
    <li>
      <a href="../articles/twostage-survival.html">Analysis of multivariate survival data</a>
    </li>
    <li>
      <a href="../articles/while-alive.html">While Alive estimands for Recurrent Events</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/kkholst/mets/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>GOF for Cox covariates in PH regression</h1>
    <small class="dont-index">Source: <a href="https://github.com/kkholst/mets/blob/main/R/gof-phreg.R" class="external-link"><code>R/gof-phreg.R</code></a></small>
    <div class="hidden name"><code>gofM.phreg.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Cumulative residuals after model matrix for Cox PH regression
p-values based on Lin, Wei, Ying resampling.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gofM.phreg</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  offset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  modelmatrix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n.sim <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  silent <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>formula for cox regression</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>data for model</p></dd>


<dt id="arg-offset">offset<a class="anchor" aria-label="anchor" href="#arg-offset"></a></dt>
<dd><p>offset</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>weights</p></dd>


<dt id="arg-modelmatrix">modelmatrix<a class="anchor" aria-label="anchor" href="#arg-modelmatrix"></a></dt>
<dd><p>matrix for cumulating residuals</p></dd>


<dt id="arg-n-sim">n.sim<a class="anchor" aria-label="anchor" href="#arg-n-sim"></a></dt>
<dd><p>number of simulations for score processes</p></dd>


<dt id="arg-silent">silent<a class="anchor" aria-label="anchor" href="#arg-silent"></a></dt>
<dd><p>to keep it absolutely silent, otherwise timing estimate will be prduced for longer jobs.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments to lower level funtions</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>That is, computes
$$
 U(t) = \int_0^t M^t d \hat M
$$
and resamples its asymptotic distribution.</p>
<p>This will show if the residuals are consistent with the model. Typically,
M will be a design matrix for the continous covariates that gives for example
the quartiles, and then the plot will show if for the different quartiles of the covariate the risk
prediction is consistent over time  (time x covariate interaction).</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Thomas Scheike and Klaus K. Holst</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kkholst.github.io/mets/" class="external-link">mets</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">TRACE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">TRACEsam</span> <span class="op">&lt;-</span> <span class="fu"><a href="blocksample.html">blocksample</a></span><span class="op">(</span><span class="va">TRACE</span>,idvar<span class="op">=</span><span class="st">"id"</span>,replace<span class="op">=</span><span class="cn">FALSE</span>,<span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="dcut.html">dcut</a></span><span class="op">(</span><span class="va">TRACEsam</span><span class="op">)</span>  <span class="op">&lt;-</span> <span class="op">~</span><span class="va">.</span> </span></span>
<span class="r-in"><span><span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="op">-</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">wmicat.4</span><span class="op">)</span>,data<span class="op">=</span><span class="va">TRACEsam</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">gofM.phreg</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">==</span><span class="fl">9</span><span class="op">)</span><span class="op">~</span><span class="va">vf</span><span class="op">+</span><span class="va">chf</span><span class="op">+</span><span class="va">wmi</span>,data<span class="op">=</span><span class="va">TRACEsam</span>,modelmatrix<span class="op">=</span><span class="va">mm</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative residuals versus modelmatrix :</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                            Sup_t |U(t)|  pval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(wmicat.4)[0.4,1.1]      5.788752 0.021</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(wmicat.4)(1.1,1.4]      2.633143 0.591</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(wmicat.4)(1.4,1.72]     5.657370 0.038</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(wmicat.4)(1.72,2]       1.227485 0.948</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative score process versus covariates (discrete z via model.matrix):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Sup_z |U(tau,z)|  pval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> matrixZ         1.801626 0.812</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">gofM.phreg</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">==</span><span class="fl">9</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">vf</span><span class="op">)</span><span class="op">+</span><span class="va">chf</span><span class="op">+</span><span class="va">wmi</span>,data<span class="op">=</span><span class="va">TRACEsam</span>,modelmatrix<span class="op">=</span><span class="va">mm</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative residuals versus modelmatrix :</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                            Sup_t |U(t)|  pval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(wmicat.4)[0.4,1.1]      6.049754 0.022</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(wmicat.4)(1.1,1.4]      2.211031 0.757</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(wmicat.4)(1.4,1.72]     5.040704 0.085</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(wmicat.4)(1.72,2]       1.482109 0.890</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative score process versus covariates (discrete z via model.matrix):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Sup_z |U(tau,z)|  pval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> matrixZ         1.228032 0.934</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## cumulative sums in covariates, via design matrix mm </span></span></span>
<span class="r-in"><span><span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="gofZ.phreg.html">cumContr</a></span><span class="op">(</span><span class="va">TRACEsam</span><span class="op">$</span><span class="va">wmi</span>,breaks<span class="op">=</span><span class="fl">10</span>,equi<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">gofM.phreg</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">==</span><span class="fl">9</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">vf</span><span class="op">)</span><span class="op">+</span><span class="va">chf</span><span class="op">+</span><span class="va">wmi</span>,data<span class="op">=</span><span class="va">TRACEsam</span>,</span></span>
<span class="r-in"><span>      modelmatrix<span class="op">=</span><span class="va">mm</span>,silent<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative score process test for modelmatrix:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        Sup_t |U(t)| pval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=0.56         0.84 0.35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=0.72         1.93 0.39</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=0.88         5.06 0.04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.04         2.63 0.58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.2          4.27 0.17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.36         4.04 0.17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.52         3.20 0.29</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.68         1.83 0.81</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.84         1.25 0.82</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=2            0.00 1.00</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative residuals versus modelmatrix :</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        Sup_t |U(t)|  pval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=0.56    0.8423856 0.352</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=0.72    1.9258405 0.394</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=0.88    5.0552596 0.037</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.04    2.6334412 0.579</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.2     4.2747875 0.174</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.36    4.0393945 0.169</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.52    3.2004455 0.292</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.68    1.8330704 0.810</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=1.84    1.2509429 0.823</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;=2       0.0000000 1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative score process versus covariates (discrete z via model.matrix):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Sup_z |U(tau,z)|  pval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> matrixZ          3.73439 0.283</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Klaus K. Holst, Thomas Scheike.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

